backend/src/patients/dto/create-patient.dto.ts
------------------------------------------
// src/patients/dto/create-patient.dto.ts
import { ApiProperty } from '@nestjs/swagger';
import { IsNotEmpty, IsString, IsEnum, IsOptional, IsDateString } from 'class-validator';
import { GenderType } from '../patients.entity';

export class CreatePatientDto {
  @ApiProperty({ 
    example: '3352808440', 
    description: 'ID của User (UUID hoặc String ID tùy cấu hình)' 
  })
  @IsNotEmpty()
  @IsString()
  userId: string;

  @ApiProperty({ 
    example: 'Nguyễn Văn Bệnh', 
    description: 'Họ tên đầy đủ của bệnh nhân' 
  })
  @IsNotEmpty()
  @IsString()
  fullName: string;

  @ApiProperty({ 
    enum: GenderType, 
    example: 'man', // Sử dụng giá trị chuỗi thực tế trong DB để test nhanh
    description: 'Giới tính (man, woman, other)' 
  })
  @IsNotEmpty()
  @IsEnum(GenderType, {
    message: 'Giới tính phải là man, woman hoặc other'
  })
  gender: GenderType;

  @ApiProperty({ 
    example: '1990-01-01', 
    description: 'Ngày sinh định dạng YYYY-MM-DD' 
  })
  @IsNotEmpty()
  @IsDateString({}, { message: 'Ngày sinh không đúng định dạng (YYYY-MM-DD)' })
  dateOfBirth: Date;

  @ApiProperty({ example: '0901234567', description: 'Số điện thoại liên lạc' })
  @IsNotEmpty()
  @IsString()
  phone: string;

  @ApiProperty({ 
    example: '123 Đường ABC, Quận 1, TP.HCM', 
    required: false 
  })
  @IsOptional()
  @IsString()
  address?: string;

  @ApiProperty({ 
    example: 'BH123456789', 
    required: false,
    description: 'Số thẻ bảo hiểm y tế (nếu có)'
  })
  @IsOptional()
  @IsString()
  healthInsuranceNumber?: string;
}-e \n[END OF FILE]\n
backend/src/patients/dto/update-patient.dto.ts
------------------------------------------
// src/patients/dto/update-patient.dto.ts
import { PartialType } from '@nestjs/swagger';
import { CreatePatientDto } from './create-patient.dto';

export class UpdatePatientDto extends PartialType(CreatePatientDto) {}-e \n[END OF FILE]\n
backend/src/patients/patients.controller.ts
------------------------------------------
// src/patients/patients.controller.ts
import { Controller, Get, Post, Body, Patch, Param, UseGuards } from '@nestjs/common';
import { PatientsService } from './patients.service';
import { CreatePatientDto } from './dto/create-patient.dto';
import { UpdatePatientDto } from './dto/update-patient.dto';
import { ApiOperation, ApiTags } from '@nestjs/swagger';

@ApiTags('patients')
@Controller('patients')
export class PatientsController {
  constructor(private readonly patientsService: PatientsService) {}

  @Post()
  create(@Body() createPatientDto: CreatePatientDto) {
    return this.patientsService.create(createPatientDto);
  }

  @Get()
  findAll() {
    return this.patientsService.findAll();
  }

  @Get('user/:userId')
  findByUserId(@Param('userId') userId: string) {
    return this.patientsService.findByUserId(userId);
  }

  @Patch(':id')
  @ApiOperation({ summary: 'Cập nhật thông tin bệnh nhân' })
  update(
    @Param('id') id: string, 
    @Body() updatePatientDto: UpdatePatientDto // Sử dụng Class thay vì Partial type
  ) {
    return this.patientsService.update(id, updatePatientDto);
  }
}-e \n[END OF FILE]\n
backend/src/patients/patients.service.ts
------------------------------------------
// src/patients/patients.service.ts
import { Injectable, ConflictException, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Patient } from './patients.entity';
import { CreatePatientDto } from './dto/create-patient.dto';

@Injectable()
export class PatientsService {
  constructor(
    @InjectRepository(Patient)
    private readonly patientRepo: Repository<Patient>,
  ) {}

  async create(dto: CreatePatientDto) {
    // 1. Kiểm tra trùng số điện thoại
    const existingPhone = await this.patientRepo.findOne({ where: { phone: dto.phone } });
    if (existingPhone) throw new ConflictException('Số điện thoại đã tồn tại');

    // 2. Kiểm tra mã bảo hiểm y tế (nếu có)
    if (dto.healthInsuranceNumber) {
      const existingHI = await this.patientRepo.findOne({ 
        where: { healthInsuranceNumber: dto.healthInsuranceNumber } 
      });
      if (existingHI) throw new ConflictException('Mã bảo hiểm y tế đã tồn tại');
    }

    const patient = this.patientRepo.create(dto);
    return await this.patientRepo.save(patient);
  }

  async findAll() {
    return await this.patientRepo.find({
      relations: ['user'],
      order: { createdAt: 'DESC' }
    });
  }

  async findByUserId(userId: string) {
    const patient = await this.patientRepo.findOne({ 
      where: { userId },
      relations: ['user'] 
    });
    if (!patient) throw new NotFoundException('Không tìm thấy hồ sơ bệnh nhân');
    return patient;
  }

  async update(id: string, dto: Partial<CreatePatientDto>) {
    const patient = await this.patientRepo.findOne({ where: { id } });
    if (!patient) throw new NotFoundException('Bệnh nhân không tồn tại');
    
    Object.assign(patient, dto);
    return await this.patientRepo.save(patient);
  }
}-e \n[END OF FILE]\n
backend/src/patients/patients.entity.ts
------------------------------------------
// src/patients/patients.entity.ts
import { Entity, PrimaryColumn, Column, CreateDateColumn, OneToOne, JoinColumn } from 'typeorm';
import { User } from '../users/users.entity';

export enum GenderType {
  MALE = 'man',
  FEMALE = 'woman',
  OTHER = 'other',
}

@Entity('patients')
export class Patient {
  @PrimaryColumn({ type: 'bigint' })
  id: string; // TypeORM sẽ nhận bigint dưới dạng string để tránh mất độ chính xác

  @Column({ name: 'user_id' })
  userId: string;

  @OneToOne(() => User, { onDelete: 'CASCADE' })
  @JoinColumn({ name: 'user_id' })
  user: User;

  @Column({ name: 'full_name', length: 100 })
  fullName: string;

  @Column({ type: 'enum', enum: GenderType })
  gender: GenderType;

  @Column({ name: 'date_of_birth', type: 'date' })
  dateOfBirth: Date;

  @Column({ unique: true, length: 20 })
  phone: string;

  @Column({ type: 'text', nullable: true })
  address: string;

  @Column({ name: 'health_insurance_number', unique: true, nullable: true, length: 50 })
  healthInsuranceNumber: string;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;
}-e \n[END OF FILE]\n
backend/src/patients/patients.module.ts
------------------------------------------
// src/patients/patients.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { PatientsService } from './patients.service';
import { PatientsController } from './patients.controller';
import { Patient } from './patients.entity';
import { User } from '../users/users.entity'; // Quan trọng: Nếu Service cần truy cập bảng User

@Module({
  imports: [
    // Đăng ký các Entity để TypeORM tạo ra Repository tương ứng
    TypeOrmModule.forFeature([Patient, User]), 
  ],
  controllers: [PatientsController],
  providers: [PatientsService],
  exports: [PatientsService], // Export nếu bạn muốn module Appointments sử dụng PatientsService
})
export class PatientsModule {}-e \n[END OF FILE]\n
backend/src/database/typeorm.config.ts
------------------------------------------
import { TypeOrmModuleOptions } from '@nestjs/typeorm';
import { User } from '../users/users.entity';
import { Department } from 'src/departments/entities/department.entity';

export const typeOrmConfig: TypeOrmModuleOptions = {
  type: 'postgres',
  host: 'localhost',
  port: 5432,
  username: 'daongocthong', 
  password: '',         
  database: 'booking_db',
  autoLoadEntities: true,
  entities: [User,Department],
  synchronize: false,
};-e \n[END OF FILE]\n
backend/src/medicines/dto/update-medicine.dto.ts
------------------------------------------
import { PartialType } from '@nestjs/swagger';
import { CreateMedicineDto } from './create-medicine.dto';

export class UpdateMedicineDto extends PartialType(CreateMedicineDto) {}
-e \n[END OF FILE]\n
backend/src/medicines/dto/create-medicine.dto.ts
------------------------------------------
import { ApiProperty } from '@nestjs/swagger';
import { IsNotEmpty, IsString, IsOptional, MaxLength } from 'class-validator';

export class CreateMedicineDto {
  @ApiProperty({ example: 'Paracetamol' })
  @IsNotEmpty()
  @IsString()
  @MaxLength(255)
  name: string;

  @ApiProperty({ example: 'Panadol', required: false })
  @IsOptional()
  @IsString()
  @MaxLength(255)
  brand_name?: string;

  @ApiProperty({ example: 'Viên' })
  @IsNotEmpty()
  @IsString()
  @MaxLength(50)
  unit: string;

  @ApiProperty({ example: '500mg', required: false })
  @IsOptional()
  @IsString()
  @MaxLength(100)
  concentration: string;

  @ApiProperty({ example: 'Thuốc giảm đau hạ sốt', required: false })
  @IsOptional()
  @IsString()
  description: string;
}-e \n[END OF FILE]\n
backend/src/medicines/medicines.controller.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { MedicinesController } from './medicines.controller';
import { MedicinesService } from './medicines.service';

describe('MedicinesController', () => {
  let controller: MedicinesController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [MedicinesController],
      providers: [MedicinesService],
    }).compile();

    controller = module.get<MedicinesController>(MedicinesController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/medicines/medicines.service.ts
------------------------------------------
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository, Like } from 'typeorm';
import { Medicine } from './entities/medicine.entity';
import { UpdateMedicineDto } from './dto/update-medicine.dto';

@Injectable()
export class MedicinesService {
  constructor(
    @InjectRepository(Medicine)
    private readonly medicineRepo: Repository<Medicine>,
  ) {}

  // Các hàm Controller đang gọi:
  async findOne(id: string) {
    const medicine = await this.medicineRepo.findOne({ where: { id } });
    if (!medicine) throw new NotFoundException('Không tìm thấy thuốc');
    return medicine;
  }

  async update(id: string, updateMedicineDto: UpdateMedicineDto) {
    // 1. Tìm bản ghi hiện tại
    const medicine = await this.medicineRepo.findOne({ where: { id } });
    if (!medicine) throw new NotFoundException('Không tìm thấy thuốc');

    // 2. Ghi đè dữ liệu mới (Nếu updateMedicineDto có brand_name, nó sẽ đè lên cái cũ)
    Object.assign(medicine, updateMedicineDto);

    // 3. Lưu lại
    return await this.medicineRepo.save(medicine);
  }

  async remove(id: string) {
    const medicine = await this.findOne(id);
    await this.medicineRepo.remove(medicine);
    return { message: 'Đã xóa thuốc' };
  }

  // Tìm kiếm thuốc theo tên (Dùng cho ô gợi ý khi kê đơn)
  async search(name: string) {
    return await this.medicineRepo.find({
      where: { name: Like(`%${name}%`) },
      take: 10, // Chỉ lấy 10 kết quả gợi ý
    });
  }

  findAll() {
    return this.medicineRepo.find({ order: { name: 'ASC' } });
  }

  create(dto: any) {
    const medicine = this.medicineRepo.create(dto);
    return this.medicineRepo.save(medicine);
  }
}
-e \n[END OF FILE]\n
backend/src/medicines/medicines.service.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { MedicinesService } from './medicines.service';

describe('MedicinesService', () => {
  let service: MedicinesService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [MedicinesService],
    }).compile();

    service = module.get<MedicinesService>(MedicinesService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/medicines/medicines.controller.ts
------------------------------------------
import { Controller, Get, Post, Body, Patch, Param, Delete } from '@nestjs/common';
import { MedicinesService } from './medicines.service';
import { CreateMedicineDto } from './dto/create-medicine.dto';
import { UpdateMedicineDto } from './dto/update-medicine.dto';

@Controller('medicines')
export class MedicinesController {
  constructor(private readonly medicinesService: MedicinesService) {}

  @Post()
  create(@Body() createMedicineDto: CreateMedicineDto) {
    return this.medicinesService.create(createMedicineDto);
  }

  @Get()
  findAll() {
    return this.medicinesService.findAll();
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.medicinesService.findOne(id);
  }

  @Patch(':id')
  update(@Param('id') id: string, @Body() updateMedicineDto: UpdateMedicineDto) {
    return this.medicinesService.update(id, updateMedicineDto);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.medicinesService.remove(id);
  }
}
-e \n[END OF FILE]\n
backend/src/medicines/entities/medicine.entity.ts
------------------------------------------
import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, UpdateDateColumn } from 'typeorm';

@Entity('medicines')
export class Medicine {
  @PrimaryGeneratedColumn({ type: 'bigint' })
  id: string;

  @Column({ type: 'varchar', length: 255 })
  name: string;

  @Column({ name: 'brand_name', type: 'varchar', length: 255, nullable: true })
  brand_name: string;

  @Column({ type: 'varchar', length: 50 })
  unit: string;

  @Column({ type: 'varchar', length: 100, nullable: true })
  concentration: string;

  @Column({ type: 'text', nullable: true })
  description: string;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;

  @UpdateDateColumn({ name: 'updated_at' })
  updatedAt: Date;
}-e \n[END OF FILE]\n
backend/src/medicines/medicines.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { MedicinesService } from './medicines.service';
import { MedicinesController } from './medicines.controller';
import { Medicine } from './entities/medicine.entity';

@Module({
  imports: [
    // BẮT BUỘC: Thêm dòng này để MedicineRepository có sẵn cho Service
    TypeOrmModule.forFeature([Medicine])
  ],
  controllers: [MedicinesController],
  providers: [MedicinesService],
  exports: [TypeOrmModule, MedicinesService], // Export TypeOrmModule để module Prescriptions có thể dùng Medicine
})
export class MedicinesModule {}-e \n[END OF FILE]\n
backend/src/main.ts
------------------------------------------
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';
import { ValidationPipe } from '@nestjs/common/pipes/validation.pipe';
import { join } from 'path';
import { NestExpressApplication } from '@nestjs/platform-express';

async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule);

  app.enableCors({
    origin: '*', // Cho phép tất cả các nguồn (hoặc điền http://127.0.0.1:5500 nếu bạn dùng Live Server)
    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',
    credentials: true,
  });

  app.useStaticAssets(join(process.cwd(), 'src/avatar'), {
    prefix: '/avatar/', 
  });

  const config = new DocumentBuilder()
    .setTitle('Hệ thống Đặt lịch khám Online')
    .setDescription('Tài liệu API cho dự án đặt lịch')
    .setVersion('1.0')
    .addBearerAuth()
    .build();

  app.useGlobalPipes(
    new ValidationPipe({
      whitelist: true,
      forbidNonWhitelisted: true,
      transform: true,
    }),
  );

  app.setGlobalPrefix('api');

  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, document);

  await app.listen(3000, '0.0.0.0');
  console.log(`Ứng dụng đang chạy tại: http://localhost:3000/api`);
}
bootstrap();
-e \n[END OF FILE]\n
backend/src/appointments/dto/update-appointment.dto.ts
------------------------------------------
// src/appointments/dto/update-appointment.dto.ts
import { AppointmentStatus } from '../appointments.entity';
import { ApiPropertyOptional } from '@nestjs/swagger';
import { IsEnum, IsOptional, IsString } from 'class-validator';

export class UpdateAppointmentDto {
  @ApiPropertyOptional({ description: 'ID bệnh nhân' })
  @IsOptional()
  @IsString()
  patient_id?: string;

  @ApiPropertyOptional({ description: 'ID bác sĩ' })
  @IsOptional()
  @IsString()
  doctor_id?: string;

  @ApiPropertyOptional({ description: 'Ngày hẹn yyyy-mm-dd' })
  @IsOptional()
  @IsString()
  appointment_date?: string;

  @ApiPropertyOptional({ description: 'Giờ hẹn HH:mm:ss' })
  @IsOptional()
  @IsString()
  appointment_time?: string;

  @ApiPropertyOptional({ enum: AppointmentStatus, description: 'Trạng thái hẹn' })
  @IsOptional()
  @IsEnum(AppointmentStatus) // Quan trọng: Để chặn lỗi 400 nếu gửi status sai
  status?: AppointmentStatus;

  @ApiPropertyOptional({ description: 'Ghi chú' })
  @IsOptional()
  @IsString()
  note?: string;

  @ApiPropertyOptional({ description: 'Địa điểm' })
  @IsOptional()
  @IsString()
  location?: string;
}-e \n[END OF FILE]\n
backend/src/appointments/dto/create-appointment.dto.ts
------------------------------------------
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';
import { IsEnum, IsNotEmpty, IsOptional, IsString } from 'class-validator';
import { AppointmentStatus } from '../appointments.entity';

export class CreateAppointmentDto {
  @ApiProperty({ description: 'ID bệnh nhân', type: String })
  @IsNotEmpty()
  @IsString()
  patient_id: string;

  @ApiProperty({ description: 'ID bác sĩ', type: String })
  @IsNotEmpty()
  @IsString()
  doctor_id: string;

  @ApiProperty({ description: 'Ngày hẹn yyyy-mm-dd', type: String })
  @IsNotEmpty()
  @IsString()
  appointment_date: string;

  @ApiProperty({ description: 'Giờ hẹn HH:mm:ss', type: String })
  @IsNotEmpty()
  @IsString()
  appointment_time: string;

  @ApiPropertyOptional({ enum: AppointmentStatus, description: 'Trạng thái hẹn' })
  @IsOptional()
  @IsEnum(AppointmentStatus)
  status?: AppointmentStatus;

  @ApiPropertyOptional({ description: 'Ghi chú hẹn' })
  @IsOptional()
  @IsString()
  note?: string;

  @ApiPropertyOptional({ description: 'Địa điểm hẹn' })
  @IsOptional()
  @IsString()
  location?: string;
}
-e \n[END OF FILE]\n
backend/src/appointments/appointments.service.ts
------------------------------------------
// src/appointments/appointments.service.ts
import {
  Injectable,
  NotFoundException,
  BadRequestException,
} from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Appointment, AppointmentStatus } from './appointments.entity';
import { CreateAppointmentDto } from './dto/create-appointment.dto';
import { UpdateAppointmentDto } from './dto/update-appointment.dto';
import { NotificationsService } from '../notifications/notifications.service';
import { NotificationType } from '../notifications/notifications.entity';
import { Doctor } from '../doctors/doctors.entity';
import { Patient } from '../patients/patients.entity';

@Injectable()
export class AppointmentsService {
  constructor(
    @InjectRepository(Appointment)
    private readonly appointmentRepo: Repository<Appointment>,

    @InjectRepository(Doctor)
    private readonly doctorRepo: Repository<Doctor>,

    @InjectRepository(Patient)
    private readonly patientRepo: Repository<Patient>,

    private readonly notificationsService: NotificationsService,
  ) {}

  async create(dto: CreateAppointmentDto): Promise<Appointment> {
    // 1. Kiểm tra sự tồn tại trong bảng patients và doctors (không phải users)
    const patient = await this.patientRepo.findOne({
      where: { id: dto.patient_id },
      relations: ['user'], // Lấy thêm quan hệ user để lấy tên gửi thông báo
    });
    if (!patient) throw new NotFoundException('Hồ sơ bệnh nhân không tồn tại');

    const doctor = await this.doctorRepo.findOne({
      where: { id: dto.doctor_id },
      relations: ['user'],
    });
    if (!doctor) throw new NotFoundException('Hồ sơ bác sĩ không tồn tại');

    // 2. Tạo đối tượng và lưu
    // TypeORM sẽ tự hiểu gán id của object patient/doctor vào cột patient_id/doctor_id
    const appointment = this.appointmentRepo.create({
      patient,
      doctor,
      appointment_date: dto.appointment_date,
      appointment_time: dto.appointment_time,
      status: dto.status || AppointmentStatus.PENDING,
      note: dto.note,
      location: dto.location,
    });

    try {
      const savedAppointment = await this.appointmentRepo.save(appointment);

      // 3. Gửi thông báo cho bác sĩ (Dùng userId của bác sĩ)
      await this.notificationsService.createNotification({
        userId: doctor.userId, // ID từ bảng Users để nhận tin nhắn
        title: 'Lịch hẹn mới',
        content: `Bệnh nhân ${patient.fullName || patient.user.username} đã đặt lịch khám vào ngày ${dto.appointment_date}`,
        type: NotificationType.APPOINTMENT,
        targetUrl: `/appointments/${savedAppointment.id}`,
      });

      return savedAppointment;
    } catch (error) {
      // Bắt lỗi Unique Constraint (trùng lịch) từ Database
      if (error.code === '23505') {
        throw new BadRequestException(
          'Bác sĩ hoặc bệnh nhân đã có lịch vào khung giờ này',
        );
      }
      throw error;
    }
  }

  async findAll(): Promise<Appointment[]> {
    return this.appointmentRepo.find({
      // Load thông tin lồng nhau: Appointment -> Doctor -> User
      relations: ['patient.user', 'doctor.user', 'doctor.department'],
      order: { appointment_date: 'DESC', appointment_time: 'DESC' },
    });
  }

  async findOne(id: string): Promise<Appointment> {
    const appointment = await this.appointmentRepo.findOne({
      where: { id },
      relations: ['patient.user', 'doctor.user', 'doctor.department'],
    });
    if (!appointment) throw new NotFoundException('Không tìm thấy lịch hẹn');
    return appointment;
  }

  // src/appointments/appointments.service.ts

  // src/appointments/appointments.service.ts

  async update(id: string, dto: UpdateAppointmentDto): Promise<Appointment> {
    const appointment = await this.appointmentRepo.findOne({
      where: { id },
      relations: ['patient', 'doctor'], // Đảm bảo đã load cả patient và doctor
    });

    if (!appointment) {
      throw new NotFoundException('Không tìm thấy lịch hẹn');
    }

    const oldStatus = appointment.status;

    // Cập nhật các trường dữ liệu
    if (dto.appointment_date) appointment.appointment_date = dto.appointment_date;
    if (dto.appointment_time) appointment.appointment_time = dto.appointment_time;
    if (dto.status) appointment.status = dto.status;
    if (dto.note) appointment.note = dto.note;
    if (dto.location) appointment.location = dto.location;

    const updatedAppointment = await this.appointmentRepo.save(appointment);

    // KIỂM TRA CHUYỂN TRẠNG THÁI SANG CANCELLED
    if (dto.status === AppointmentStatus.CANCELLED && oldStatus !== AppointmentStatus.CANCELLED) {
      try {
        const commonTitle = 'Cập nhật lịch hẹn';
        const commonContent = `Lịch hẹn lúc ${updatedAppointment.appointment_time} ngày ${updatedAppointment.appointment_date} đã bị huỷ.`;
        const commonType = NotificationType.APPOINTMENT;
        const commonUrl = `/appointments/${updatedAppointment.id}`;

        // 1. Tạo thông báo cho Bệnh nhân
        await this.notificationsService.createNotification({
          userId: updatedAppointment.patient.userId,
          title: commonTitle,
          content: commonContent,
          type: commonType,
          targetUrl: commonUrl,
        });

        // 2. Tạo thông báo cho Bác sĩ
        await this.notificationsService.createNotification({
          userId: updatedAppointment.doctor.userId,
          title: commonTitle,
          content: commonContent,
          type: commonType,
          targetUrl: commonUrl,
        });

        console.log('Đã gửi thông báo hủy lịch cho cả bệnh nhân và bác sĩ');
      } catch (error) {
        console.error('Lỗi gửi thông báo hủy lịch:', error);
      }
    }
    // Gửi thông báo thông thường cho các trạng thái khác (nếu cần)
    else if (dto.status && dto.status !== oldStatus) {
      try {
        await this.notificationsService.createNotification({
          userId: updatedAppointment.patient.userId,
          title: 'Lịch hẹn mới',
          content: `Bệnh nhân ${updatedAppointment.patient.fullName} đã đặt lịch khám vào ${updatedAppointment.appointment_time} ngày ${updatedAppointment.appointment_date}  ${dto.status.toUpperCase()}`,
          type: NotificationType.APPOINTMENT,
          targetUrl: `/appointments/${updatedAppointment.id}`,
        });
      } catch (error) {
        console.error('Lỗi gửi thông báo trạng thái:', error);
      }
    }

    return updatedAppointment;
  }

  async remove(id: string): Promise<void> {
    const result = await this.appointmentRepo.delete(id);
    if (result.affected === 0)
      throw new NotFoundException('Không tìm thấy lịch hẹn để xóa');
  }
}
-e \n[END OF FILE]\n
backend/src/appointments/appointments.entity.ts
------------------------------------------
// src/appointments/appointments.entity.ts
import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, ManyToOne, JoinColumn } from 'typeorm';
import { Doctor } from '../doctors/doctors.entity'; // Import Entity Doctor
import { Patient } from '../patients/patients.entity'; // Import Entity Patient

export enum AppointmentStatus {
  PENDING = 'pending',
  CONFIRMED = 'confirmed',
  CANCELLED = 'cancelled',
  COMPLETED = 'completed',
}

@Entity('appointments')
export class Appointment {
  @PrimaryGeneratedColumn({ type: 'bigint' })
  id: string;

  @Column({ name: 'patient_id', type: 'bigint' })
  patientId: string;

  @Column({ name: 'doctor_id', type: 'bigint' })
  doctorId: string;

  @ManyToOne(() => Patient)
  @JoinColumn({ name: 'patient_id' })
  patient: Patient;

  @ManyToOne(() => Doctor)
  @JoinColumn({ name: 'doctor_id' })
  doctor: Doctor;

  @Column({ type: 'date' })
  appointment_date: string;

  @Column({ type: 'time' })
  appointment_time: string;

  @Column({ type: 'enum', enum: ['pending', 'confirmed', 'cancelled', 'completed'] }) // Khớp với enum trong DB
  status: string;

  @Column({ type: 'text', nullable: true })
  note: string;

  @Column({ type: 'text', nullable: true })
  location: string;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;
}-e \n[END OF FILE]\n
backend/src/appointments/appointments.module.ts
------------------------------------------
// src/appointments/appointments.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { AppointmentsService } from './appointments.service';
import { AppointmentsController } from './appointments.controller';
import { Appointment } from './appointments.entity';
import { UsersModule } from '../users/users.module';
import { NotificationsModule } from 'src/notifications/notifications.module';
import { Doctor } from '../doctors/doctors.entity'; // Import Entity Doctor
import { Patient } from '../patients/patients.entity';

@Module({
  imports: [
    TypeOrmModule.forFeature([Appointment, Doctor, Patient]),
    UsersModule,
    NotificationsModule,
  ],
  controllers: [AppointmentsController],
  providers: [AppointmentsService],
})
export class AppointmentsModule {}
-e \n[END OF FILE]\n
backend/src/appointments/appointments.controller.ts
------------------------------------------
// src/appointments/appointments.controller.ts
import {
  Controller,
  Get,
  Post,
  Put,
  Delete,
  Body,
  Param,
  Patch,
} from '@nestjs/common';
import { AppointmentsService } from './appointments.service';
import { CreateAppointmentDto } from './dto/create-appointment.dto';
import { UpdateAppointmentDto } from './dto/update-appointment.dto';
import { Appointment } from './appointments.entity';
import { ApiTags } from '@nestjs/swagger';

@ApiTags('appointments')
@Controller('appointments')
export class AppointmentsController {
  constructor(private readonly appointmentsService: AppointmentsService) {}

  @Post()
  create(@Body() dto: CreateAppointmentDto): Promise<Appointment> {
    return this.appointmentsService.create(dto);
  }

  @Get()
  findAll(): Promise<Appointment[]> {
    return this.appointmentsService.findAll();
  }

  @Get(':id')
  findOne(@Param('id') id: string): Promise<Appointment> {
    return this.appointmentsService.findOne(id);
  }

  @Delete(':id')
  remove(@Param('id') id: string): Promise<void> {
    return this.appointmentsService.remove(id);
  }

  @Patch(':id')
  async update(
    @Param('id') id: string,
    @Body() updateDto: UpdateAppointmentDto,
  ) {
    return this.appointmentsService.update(id, updateDto);
  }
}
-e \n[END OF FILE]\n
backend/src/auth/dto/login.dto.ts
------------------------------------------
import { IsString, MinLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class LoginDto {
  @ApiProperty({ example: 'testuser5' }) // username
  @IsString()
  username: string;

  @ApiProperty({ example: '123456' })
  @IsString()
  @MinLength(6)
  password: string;
  static username: any;
}
-e \n[END OF FILE]\n
backend/src/auth/dto/register.dto.ts
------------------------------------------
import { IsEmail, IsString, MinLength } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class RegisterDto {
  @ApiProperty({ example: 'test@gmail.com' })
  @IsEmail()
  email: string;

  @ApiProperty({ example: 'testuser123' })
  @IsString()
  username: string;

  @ApiProperty({ example: '123456' })
  @IsString()
  @MinLength(6)
  password: string;

  @ApiProperty({ example: 'Nguyen Van A' })
  @IsString()
  fullName: string;
}
-e \n[END OF FILE]\n
backend/src/auth/auth.controller.ts
------------------------------------------
import { Controller, Post, Body } from '@nestjs/common';
import { AuthService } from './auth.service';
import { LoginDto } from './dto/login.dto';
import { RegisterDto } from './dto/register.dto';
import { ApiTags } from '@nestjs/swagger';

@ApiTags('Auth')
@Controller('auth')
export class AuthController {
  constructor(private authService: AuthService) {}

  @Post('login')
  async login(@Body() dto: LoginDto) {
  
  const user = await this.authService.validateUser(dto.username, dto.password);
  console.log(`[Auth] Có yêu cầu đăng nhập từ user: ${dto.username}`);
  return this.authService.login(user);
  }

  @Post('register')
  register(@Body() dto: RegisterDto) {
    return this.authService.register(dto);
  }
}
-e \n[END OF FILE]\n
backend/src/auth/jwt.strategy.ts
------------------------------------------
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { Strategy, ExtractJwt } from 'passport-jwt';
import { UsersService } from '../users/users.service';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor(private usersService: UsersService) {
    super({
      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
      secretOrKey: 'SECRET_KEY',
    });
  }

  async validate(payload: any) {
    const user = await this.usersService.findOne(payload.sub.toString());
    if (!user) throw new UnauthorizedException('User không tồn tại');
    return user; 
  }
}
-e \n[END OF FILE]\n
backend/src/auth/auth.service.ts
------------------------------------------
// src/auth/auth.service.ts
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { UsersService } from '../users/users.service';
import { JwtService } from '@nestjs/jwt';
import * as bcrypt from 'bcrypt';
import { CreateUserDto } from '../users/dto/create-user.dto';
import { DoctorsService } from '../doctors/doctors.service';

@Injectable()
export class AuthService {
  constructor(
    private readonly usersService: UsersService,
    private readonly jwtService: JwtService,
    private readonly doctorsService: DoctorsService,
  ) {}

  async validateUser(username: string, password: string) {
    const user = await this.usersService.findByUsername(username);

    if (!user) {
      throw new UnauthorizedException('Username không tồn tại');
    }

    // --- CHỐT CHẶN TRẠNG THÁI TÀI KHOẢN ---
    // Nếu tài khoản đã bị set is_active = false trong DoctorsService, chặn ở đây.
    if (user.is_active === false) {
      throw new UnauthorizedException(
        'Tài khoản của bạn đã bị vô hiệu hóa hoặc bị khóa',
      );
    }
    // --------------------------------------

    const isMatch = await bcrypt.compare(password, user.password);

    if (!isMatch) {
      throw new UnauthorizedException('Sai mật khẩu');
    }

    return user;
  }

  async login(user: any) {
    const doctor = await this.doctorsService.findByUserId(user.id);
    // Payload lưu thêm is_active nếu bạn muốn kiểm tra ở Guard sau này
    const payload = {
      sub: user.id,
      username: user.username,
      role: user.role,
      doctorId: doctor ? doctor.id: null,
    };

    return {
      access_token: this.jwtService.sign(payload),
      user: {
        id: user.id,
        username: user.username,
        role: user.role,
        is_active: user.is_active, // Trả về để Frontend biết trạng thái
      },
      doctorId: doctor ? doctor.id : null,
    };
  }

  async register(dto: CreateUserDto) {
    const hashed = await bcrypt.hash(dto.password, 10);
    const newUser = await this.usersService.create({
      ...dto,
      password: hashed,
    });
    return newUser;
  }
}
-e \n[END OF FILE]\n
backend/src/auth/jwt-auth.guard.ts
------------------------------------------
import { Injectable } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {}
-e \n[END OF FILE]\n
backend/src/auth/auth.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { AuthService } from './auth.service';
import { AuthController } from './auth.controller';
import { JwtModule } from '@nestjs/jwt';
import { PassportModule } from '@nestjs/passport';
import { JwtStrategy } from './jwt.strategy';
import { UsersModule } from '../users/users.module';
import { DoctorsModule } from 'src/doctors/doctors.module';

@Module({
  imports: [
    UsersModule,
    PassportModule,
    DoctorsModule,
    JwtModule.register({
      secret: 'SECRET_KEY', 
      signOptions: { expiresIn: '1d' },
    }),
  ],
  controllers: [AuthController],
  providers: [AuthService, JwtStrategy],
})
export class AuthModule {}
-e \n[END OF FILE]\n
backend/src/app.service.ts
------------------------------------------
import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  getHello(): string {
    return 'Dao Ngoc Thong';
  }
}
-e \n[END OF FILE]\n
backend/src/departments/dto/create-department.dto.ts
------------------------------------------
import { IsString, IsNotEmpty, IsOptional } from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';

export class CreateDepartment {
  @ApiProperty({ example: 'Khoa Nội' })
  @IsString()
  @IsNotEmpty()
  name: string;

  @ApiProperty({ example: 'Chuyên điều trị các bệnh nội khoa tổng quát' })
  @IsString()
  @IsOptional()
  description?: string;
}-e \n[END OF FILE]\n
backend/src/departments/dto/update-department.dto.ts
------------------------------------------
import { PartialType } from '@nestjs/swagger';
import { CreateDepartment } from './create-department.dto';

export class UpdateDepartmentDto extends PartialType(CreateDepartment) {}
-e \n[END OF FILE]\n
backend/src/departments/departments.service.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { DepartmentsService } from './departments.service';

describe('DepartmentsService', () => {
  let service: DepartmentsService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [DepartmentsService],
    }).compile();

    service = module.get<DepartmentsService>(DepartmentsService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/departments/departments.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { DepartmentsService } from './departments.service';
import { DepartmentsController } from './departments.controller';
import { Department } from './entities/department.entity';
import { TypeOrmModule } from '@nestjs/typeorm';

@Module({
  imports: [TypeOrmModule.forFeature([Department])],
  controllers: [DepartmentsController],
  providers: [DepartmentsService],
  exports: [DepartmentsService], // Export để các module khác (như Doctors) có thể dùng
})
export class DepartmentsModule {}
-e \n[END OF FILE]\n
backend/src/departments/departments.service.ts
------------------------------------------
import { Injectable, ConflictException, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Department } from './entities/department.entity';
import { CreateDepartment } from './dto/create-department.dto';
import { UpdateDepartmentDto } from './dto/update-department.dto';

@Injectable()
export class DepartmentsService {
  constructor(
    @InjectRepository(Department)
    private readonly repo: Repository<Department>,
  ) {}

  async create(dto: CreateDepartment) {
    const existing = await this.repo.findOne({ where: { name: dto.name } });
    if (existing) throw new ConflictException('Tên phòng ban đã tồn tại');
    
    const dept = this.repo.create(dto);
    return await this.repo.save(dept);
  }

  findAll() {
    return this.repo.find();
  }

  async findOne(id: number) { 
    const dept = await this.repo.findOne({ 
      where: { id: id },

    });
    if (!dept) throw new NotFoundException('Không tìm thấy phòng ban');
    return dept;
  }

  async remove(id: number) {
    const dept = await this.findOne(id); 
    return await this.repo.remove(dept);
  }

  async update(id: number, dto: UpdateDepartmentDto) {

    const dept = await this.findOne(id);
  

    if (dto.name && dto.name !== dept.name) {
      const existing = await this.repo.findOne({ where: { name: dto.name } });
      if (existing) throw new ConflictException('Tên phòng ban mới đã tồn tại');
    }

    const updatedDept = this.repo.merge(dept, dto);
  

    return await this.repo.save(updatedDept);
  }
}-e \n[END OF FILE]\n
backend/src/departments/departments.controller.ts
------------------------------------------
import { Controller, Get, Post, Body, Param, ParseIntPipe, Delete, Patch } from '@nestjs/common'; // Thêm ParseIntPipe
import { DepartmentsService } from './departments.service';
import { CreateDepartment } from './dto/create-department.dto';
import { ApiTags, ApiOperation } from '@nestjs/swagger';
import { UpdateDepartmentDto } from './dto/update-department.dto';

@ApiTags('Departments')
@Controller('departments')
export class DepartmentsController {
  constructor(private readonly departmentsService: DepartmentsService) {}

  @Post()
  @ApiOperation({ summary: 'Tạo mới một phòng ban' })
  create(@Body() createDepartmentDto: CreateDepartment) {
    return this.departmentsService.create(createDepartmentDto);
  }

  @Get()
  @ApiOperation({ summary: 'Lấy danh sách tất cả phòng ban' })
  findAll() {
    return this.departmentsService.findAll();
  }

  @Get(':id')
  findOne(@Param('id', ParseIntPipe) id: number) { 
    return this.departmentsService.findOne(id);
  }

  @Delete(':id')
  @ApiOperation({ summary: 'Xóa một phòng ban' })
  remove(@Param('id', ParseIntPipe) id: number) {
    return this.departmentsService.remove(id);
}

@Patch(':id') 
@ApiOperation({ summary: 'Cập nhật một phần thông tin phòng ban' })
async update(
  @Param('id', ParseIntPipe) id: number, 
  @Body() updateDto: UpdateDepartmentDto
) {
  return await this.departmentsService.update(id, updateDto);
}
}-e \n[END OF FILE]\n
backend/src/departments/departments.controller.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { DepartmentsController } from './departments.controller';
import { DepartmentsService } from './departments.service';

describe('DepartmentsController', () => {
  let controller: DepartmentsController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [DepartmentsController],
      providers: [DepartmentsService],
    }).compile();

    controller = module.get<DepartmentsController>(DepartmentsController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/departments/entities/department.entity.ts
------------------------------------------
import { Entity, Column, PrimaryGeneratedColumn, CreateDateColumn } from 'typeorm';

@Entity('departments')
export class Department {
  @PrimaryGeneratedColumn({ type: 'bigint' }) 
  id: number;

  @Column({ name: 'name_department', length: 100, unique: true }) 
  name: string; 

  @Column({ type: 'text', nullable: true })
  description: string;

  @CreateDateColumn({ name: 'created_at', type: 'timestamp without time zone' })
  created_at: Date;
}-e \n[END OF FILE]\n
backend/src/app.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { typeOrmConfig } from './database/typeorm.config';
import { UsersModule } from './users/users.module';
import { AuthModule } from './auth/auth.module';
import { ProfileModule } from './profile/profile.module';
import { DepartmentsModule } from './departments/departments.module';
import { DoctorsModule } from './doctors/doctors.module';
import { PatientsModule } from './patients/patients.module';
import { AppointmentsModule } from './appointments/appointments.module';
import { MedicalRecordsModule } from './medical-records/medical-records.module';
import { PrescriptionsModule } from './prescriptions/prescriptions.module';
import { MedicinesModule } from './medicines/medicines.module';

@Module({
  imports: [
    TypeOrmModule.forRoot(typeOrmConfig),
    UsersModule,
    AuthModule, 
    ProfileModule,
    DepartmentsModule,
    DoctorsModule,
    PatientsModule,
    AppointmentsModule,
    MedicalRecordsModule,
    PrescriptionsModule,
    MedicinesModule
  ],
})
export class AppModule {}
-e \n[END OF FILE]\n
backend/src/profile/profile.controller.ts
------------------------------------------
import { Controller, Get, Put, Body, Req, UseGuards } from '@nestjs/common';
import { ProfileService } from './profile.service';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';
import { UpdateUserDto } from '../users/dto/update-user.dto';
import { ApiTags, ApiBearerAuth } from '@nestjs/swagger';

@ApiTags('Profile')
@Controller('profile')
@UseGuards(JwtAuthGuard)
@ApiBearerAuth()
export class ProfileController {
  constructor(private profileService: ProfileService) {}

  @Get()
  async getProfile(@Req() req) {
    return req.user;
  }

  @Put()
  async updateProfile(@Req() req, @Body() dto: UpdateUserDto) {
    return this.profileService.updateProfile(req.user.id, dto);
  }
}
-e \n[END OF FILE]\n
backend/src/profile/profile.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { ProfileService } from './profile.service';
import { ProfileController } from './profile.controller';
import { UsersModule } from '../users/users.module';

@Module({
  imports: [UsersModule],
  providers: [ProfileService],
  controllers: [ProfileController],
})
export class ProfileModule {}
-e \n[END OF FILE]\n
backend/src/profile/profile.service.ts
------------------------------------------
import { Injectable } from '@nestjs/common';
import { UsersService } from '../users/users.service';
import { UpdateUserDto } from '../users/dto/update-user.dto';

@Injectable()
export class ProfileService {
  constructor(private usersService: UsersService) {}

  async getProfile(userId: string) {
    return this.usersService.findOne(userId);
  }

  async updateProfile(userId: string, dto: UpdateUserDto) {
    return this.usersService.update(userId, dto);
  }
}
-e \n[END OF FILE]\n
backend/src/medical-records/dto/update-medical-record.dto.ts
------------------------------------------
// src/medical-records/dto/update-medical-record.dto.ts
import { PartialType } from '@nestjs/swagger';
import { CreateMedicalRecordDto } from './create-medical-record.dto';

export class UpdateMedicalRecordDto extends PartialType(CreateMedicalRecordDto) {}-e \n[END OF FILE]\n
backend/src/medical-records/dto/create-medical-record.dto.ts
------------------------------------------
// src/medical-records/dto/create-medical-record.dto.ts
import { ApiProperty } from '@nestjs/swagger';
import { IsNotEmpty, IsString, IsOptional } from 'class-validator';

export class CreateMedicalRecordDto {
  @ApiProperty({ example: '1', description: 'ID của lịch hẹn' })
  @IsNotEmpty()
  appointment_id: string;

  @ApiProperty({ example: 'Ho, sốt, đau họng', description: 'Triệu chứng bệnh' })
  @IsNotEmpty()
  @IsString()
  symptoms: string;

  @ApiProperty({ example: 'Viêm họng cấp', description: 'Chẩn đoán của bác sĩ' })
  @IsNotEmpty()
  @IsString()
  diagnosis: string;

  @ApiProperty({ example: 'Uống thuốc đúng liều, tránh nước đá', description: 'Lời khuyên/Kết luận' })
  @IsOptional()
  @IsString()
  conclusion: string;
}-e \n[END OF FILE]\n
backend/src/medical-records/medical-records.controller.ts
------------------------------------------
import { Controller, Post, Body, Get, Param, Patch } from '@nestjs/common';
import { MedicalRecordsService } from './medical-records.service';
import { CreateMedicalRecordDto } from './dto/create-medical-record.dto';
import { ApiTags, ApiOperation } from '@nestjs/swagger';
import { UpdateMedicalRecordDto } from './dto/update-medical-record.dto';

@ApiTags('medical-records')
@Controller('medical-records')
export class MedicalRecordsController {
  constructor(private readonly medicalRecordsService: MedicalRecordsService) {}

  @Post()
  @ApiOperation({ summary: 'Bác sĩ tạo bệnh án cho lịch hẹn' })
  create(@Body() dto: CreateMedicalRecordDto) {
    return this.medicalRecordsService.create(dto);
  }

  @Get('patient/:id')
  @ApiOperation({ summary: 'Lấy lịch sử bệnh án của một bệnh nhân' })
  findByPatient(@Param('id') id: string) {
    return this.medicalRecordsService.findByPatient(id);
  }

  @Get()
  findAll() {
    return this.medicalRecordsService.findAll();
  }

  @Patch(':id')
  async update(@Param('id') id: string, @Body() dto: UpdateMedicalRecordDto) {
    return this.medicalRecordsService.update(id, dto);
  }
}
-e \n[END OF FILE]\n
backend/src/medical-records/medical-records.service.ts
------------------------------------------
import { Injectable, NotFoundException, BadRequestException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { MedicalRecord } from '../medical-records/entities/medical-record.entity';
import { CreateMedicalRecordDto } from './dto/create-medical-record.dto';
import { Appointment } from '../appointments/appointments.entity';
import { UpdateMedicalRecordDto } from './dto/update-medical-record.dto';

@Injectable()
export class MedicalRecordsService {
  constructor(
    @InjectRepository(MedicalRecord)
    private readonly recordRepo: Repository<MedicalRecord>,
    
    @InjectRepository(Appointment)
    private readonly appointmentRepo: Repository<Appointment>,
  ) {}

  async create(dto: CreateMedicalRecordDto) {
    // 1. Kiểm tra lịch hẹn
    const appointment = await this.appointmentRepo.findOne({
      where: { id: dto.appointment_id },
      relations: ['patient', 'doctor']
    });

    if (!appointment) throw new NotFoundException('Không tìm thấy lịch hẹn');

    // 2. Chặn nếu lịch hẹn này đã có bệnh án
    const existing = await this.recordRepo.findOne({ where: { appointmentId: dto.appointment_id } });
    if (existing) throw new BadRequestException('Lịch hẹn này đã được lập bệnh án trước đó');

    // 3. Tạo record (Lấy thẳng doctor_id/patient_id từ lịch hẹn)
    const record = this.recordRepo.create({
      appointment,
      patient: appointment.patient,
      doctor: appointment.doctor,
      symptoms: dto.symptoms,
      diagnosis: dto.diagnosis,
      conclusion: dto.conclusion,
    });

    const savedRecord = await this.recordRepo.save(record);

    // 4. Update trạng thái Appointment thành completed
    await this.appointmentRepo.update(appointment.id, { status: 'completed' as any });

    return savedRecord;
  }

  async findAll() {
    return await this.recordRepo.find({
      relations: ['patient.user', 'doctor.user', 'appointment'],
      order: { createdAt: 'DESC' }
    });
  }

  async findByPatient(patientId: string) {
    return await this.recordRepo.find({
      where: { patientId },
      relations: ['doctor.user', 'appointment'],
    });
  }

  async findOne(id: string) {
    const record = await this.recordRepo.findOne({
      where: { id },
      relations: ['patient.user', 'doctor.user', 'appointment'],
    });
    if (!record) throw new NotFoundException('Không tìm thấy hồ sơ bệnh án');
    return record;
  }

  async update(id: string, dto: UpdateMedicalRecordDto) {
    // 1. Kiểm tra tồn tại
    const record = await this.findOne(id);

    // 2. Cập nhật các trường (không cho phép sửa appointment_id để đảm bảo tính nhất quán)
    if (dto.symptoms) record.symptoms = dto.symptoms;
    if (dto.diagnosis) record.diagnosis = dto.diagnosis;
    if (dto.conclusion) record.conclusion = dto.conclusion;
    
    // Nếu bạn có các trường khác như treatment_plan, medications thì thêm ở đây
    
    // 3. Lưu bản ghi
    return await this.recordRepo.save(record);
  }

  async remove(id: string) {
    const record = await this.findOne(id);
    return await this.recordRepo.remove(record);
  }
}-e \n[END OF FILE]\n
backend/src/medical-records/medical-records.service.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { MedicalRecordsService } from './medical-records.service';

describe('MedicalRecordsService', () => {
  let service: MedicalRecordsService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [MedicalRecordsService],
    }).compile();

    service = module.get<MedicalRecordsService>(MedicalRecordsService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/medical-records/medical-records.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { MedicalRecord } from '../medical-records/entities/medical-record.entity';
import { MedicalRecordsService } from './medical-records.service';
import { MedicalRecordsController } from './medical-records.controller';
import { Appointment } from '../appointments/appointments.entity';

@Module({
  imports: [
    // Phải có cả MedicalRecord và Appointment vì Service dùng cả 2 Repository
    TypeOrmModule.forFeature([MedicalRecord, Appointment])
  ],
  controllers: [MedicalRecordsController],
  providers: [MedicalRecordsService],
})
export class MedicalRecordsModule {}-e \n[END OF FILE]\n
backend/src/medical-records/medical-records.controller.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { MedicalRecordsController } from './medical-records.controller';
import { MedicalRecordsService } from './medical-records.service';

describe('MedicalRecordsController', () => {
  let controller: MedicalRecordsController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [MedicalRecordsController],
      providers: [MedicalRecordsService],
    }).compile();

    controller = module.get<MedicalRecordsController>(MedicalRecordsController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/medical-records/entities/medical-record.entity.ts
------------------------------------------
import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, ManyToOne, JoinColumn } from 'typeorm';
import { Appointment } from '../../appointments/appointments.entity';
import { Doctor } from '../../doctors/doctors.entity';
import { Patient } from '../../patients/patients.entity';

@Entity('medical_records')
export class MedicalRecord {
  @PrimaryGeneratedColumn({ type: 'bigint' })
  id: string;

  @Column({ name: 'appointment_id', type: 'bigint' })
  appointmentId: string;

  @ManyToOne(() => Appointment)
  @JoinColumn({ name: 'appointment_id' })
  appointment: Appointment;

  @Column({ name: 'patient_id', type: 'bigint' })
  patientId: string;

  @ManyToOne(() => Patient)
  @JoinColumn({ name: 'patient_id' })
  patient: Patient;

  @Column({ name: 'doctor_id', type: 'bigint' })
  doctorId: string;

  @ManyToOne(() => Doctor)
  @JoinColumn({ name: 'doctor_id' })
  doctor: Doctor;

  @Column({ type: 'text' })
  symptoms: string;

  @Column({ type: 'text' })
  diagnosis: string;

  @Column({ type: 'text', nullable: true })
  conclusion: string;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;
}-e \n[END OF FILE]\n
backend/src/doctors/dto/update-doctor.dto.ts
------------------------------------------
// src/doctors/dto/update-doctor.dto.ts
import { PartialType } from '@nestjs/swagger';
import { CreateDoctorDto } from './create-doctor.dto';

export class UpdateDoctorDto extends PartialType(CreateDoctorDto) {}-e \n[END OF FILE]\n
backend/src/doctors/dto/create-doctor.dto.ts
------------------------------------------
// src/doctors/dto/create-doctor.dto.ts
import {
  IsString,
  IsNotEmpty,
  IsInt,
  Min,
  IsOptional,
  IsDateString,
  MaxLength,
  IsEnum,
} from 'class-validator';
import { ApiProperty } from '@nestjs/swagger';
import { Column } from 'typeorm';

export class CreateDoctorDto {
  // Xóa bỏ phần @Column cũ ở đây, chỉ giữ lại Validation
  @ApiProperty({
    enum: ['male', 'female', 'other'],
    example: 'male',
    description: 'Giới tính của bác sĩ',
  })
  @IsOptional()
  @IsEnum(['male', 'female', 'other'], {
    message: 'Giới tính phải là male, female hoặc other',
  })
  gender?: string; // Chỉ khai báo một lần duy nhất

  @ApiProperty({
    example: '3352808440',
    description: 'ID của User từ bảng users',
  })
  @IsString()
  @IsNotEmpty()
  userId: string;

  @ApiProperty({ example: 'BS. Nguyễn Văn Thông' })
  @IsString()
  @IsNotEmpty()
  @MaxLength(100)
  fullName: string;

  @ApiProperty({ example: '0912345678' })
  @IsString()
  @IsNotEmpty()
  @MaxLength(20)
  phone: string;

  // THAY ĐỔI TẠI ĐÂY: Sử dụng departmentId thay vì tên khoa
  @ApiProperty({
    example: '1',
    description: 'ID của phòng ban từ bảng departments',
  })
  @IsString()
  @IsNotEmpty()
  departmentId: string;

  @ApiProperty({ example: 10 })
  @IsInt()
  @Min(0)
  experienceYear: number;

  @ApiProperty({ example: '1985-05-20' })
  @IsDateString()
  dateOfBirth: string;

  @ApiProperty({ required: false })
  @IsOptional()
  @IsString()
  description?: string;

  @ApiProperty({ required: false })
  @IsOptional()
  @IsString()
  address?: string;
}
-e \n[END OF FILE]\n
backend/src/doctors/doctors.service.ts
------------------------------------------
import {
  Injectable,
  ConflictException,
  NotFoundException,
} from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Doctor } from './doctors.entity';
import { User } from '../users/users.entity';
import { CreateDoctorDto } from './dto/create-doctor.dto';

@Injectable()
export class DoctorsService {
  constructor(
    @InjectRepository(Doctor)
    private readonly doctorRepository: Repository<Doctor>,

    @InjectRepository(User)
    private readonly userRepo: Repository<User>,
  ) {}

  async create(dto: CreateDoctorDto) {
    const user = await this.userRepo.findOne({ where: { id: dto.userId } });
    if (!user) throw new NotFoundException('Người dùng không tồn tại');

    const existingDoctor = await this.doctorRepository.findOne({
      where: { userId: dto.userId },
    });
    if (existingDoctor)
      throw new ConflictException('Người dùng này đã có hồ sơ bác sĩ');

    if (dto.phone) {
      const existingPhone = await this.doctorRepository.findOne({
        where: { phone: dto.phone },
      });
      if (existingPhone)
        throw new ConflictException('Số điện thoại này đã được đăng ký');
    }

    const doctor = this.doctorRepository.create(dto);
    return await this.doctorRepository.save(doctor);
  }

  // Cập nhật avatar vào bảng Users (khuyên dùng)
  // src/doctors/doctors.service.ts
  async updateAvatar(id: string, avatarUrl: string) {
    const doctor = await this.findOne(id);

    // Sửa tên thuộc tính thành 'avatar'
    await this.userRepo.update(doctor.userId, {
      avatar: avatarUrl,
    });

    return { avatar: avatarUrl };
  }

  async findOne(id: string) {
    const numericId = !isNaN(Number(id)) ? Number(id) : undefined;

    let doctor = await this.doctorRepository.findOne({
      where: [
        { userId: id },
        ...(numericId ? [{ id: numericId as any }] : []), // Thêm 'as any' ở đây
      ],
      relations: ['user', 'department'],
    });

    if (!doctor) throw new NotFoundException('Không tìm thấy bác sĩ');
    return doctor;
  }

  async findByUserId(userId: string): Promise<Doctor | null> {
    return await this.doctorRepository.findOne({
      where: { userId: userId },
      relations: ['user', 'department'],
    });
  }

  async findOneByUserId(userId: string) {
    const doctor = await this.findByUserId(userId);
    if (!doctor)
      throw new NotFoundException(
        `Không tìm thấy hồ sơ bác sĩ cho User ID: ${userId}`,
      );
    return doctor;
  }

  async findAll(status?: boolean) {
    const query: any = {
      relations: ['user', 'department'],
      order: { createdAt: 'DESC' },
    };
    if (status !== undefined) {
      query.where = { user: { is_active: status } };
    }
    return await this.doctorRepository.find(query);
  }

  async update(id: string, dto: Partial<CreateDoctorDto>) {
    const doctor = await this.findOne(id);
    if (dto.phone && dto.phone !== doctor.phone) {
      const existingPhone = await this.doctorRepository.findOne({
        where: { phone: dto.phone },
      });
      if (existingPhone) throw new ConflictException('Số điện thoại bị trùng');
    }
    Object.assign(doctor, dto);
    return await this.doctorRepository.save(doctor);
  }

  async deactivate(userId: string) {
    await this.userRepo.update(userId, { is_active: false });
    return { message: `Tài khoản bác sĩ đã bị vô hiệu hóa.` };
  }

  async activate(userId: string) {
    await this.userRepo.update(userId, { is_active: true });
    return { message: 'Đã khôi phục trạng thái hoạt động.' };
  }
}
-e \n[END OF FILE]\n
backend/src/doctors/doctors.controller.ts
------------------------------------------
// src/doctors/doctors.controller.ts
import {
  Controller,
  Post,
  Get,
  Body,
  Patch,
  Delete,
  Param,
  Query,
  UseInterceptors,
  BadRequestException,
  UploadedFile,
} from '@nestjs/common';
import { DoctorsService } from './doctors.service';
import { CreateDoctorDto } from './dto/create-doctor.dto';
import { UpdateDoctorDto } from './dto/update-doctor.dto';
import { ApiTags, ApiOperation, ApiConsumes, ApiBody } from '@nestjs/swagger';
import { FileInterceptor } from '@nestjs/platform-express';
import { diskStorage } from 'multer';
import { extname } from 'path';
import { UsersService } from '../users/users.service';

@ApiTags('doctors')
@Controller('doctors')
export class DoctorsController {
  constructor(
    private readonly doctorsService: DoctorsService,
    private readonly usersService: UsersService,
  ) {}

  @Post()
  @ApiOperation({ summary: 'Tạo thông tin chi tiết bác sĩ' })
  create(@Body() dto: CreateDoctorDto) {
    return this.doctorsService.create(dto);
  }

  @Post('upload-avatar/:id')
  @ApiConsumes('multipart/form-data') // Báo cho Swagger đây là form gửi file
  @ApiBody({
    schema: {
      type: 'object',
      properties: {
        file: {
          // Tên key ở đây phải là 'file'
          type: 'string',
          format: 'binary',
        },
      },
    },
  })
  @UseInterceptors(
    FileInterceptor('file', {
      storage: diskStorage({
        destination: './src/avatar', // Lưu vào src/avatar như bạn muốn
        filename: (req, file, callback) => {
          const doctorId = req.params.id;
          const fileExtName = extname(file.originalname);
          callback(null, `doctor_${doctorId}${fileExtName}`);
        },
      }),
    }),
  )
  async uploadFile(
    @Param('id') id: string,
    @UploadedFile() file: Express.Multer.File,
  ) {
    if (!file) {
      throw new BadRequestException(
        'Không nhận được file! Hãy kiểm tra lại nút chọn file trong Swagger.',
      );
    }

    const doctor = await this.doctorsService.findOne(id);
    await this.usersService.updateAvatar(doctor.userId, file.filename);

    return {
      message: 'Upload thành công',
      avatar: file.filename,
    };
  }

  @Get('active')
  @ApiOperation({ summary: 'Danh sách bác sĩ đang làm việc (Cho Bệnh nhân)' })
  findActive() {
    return this.doctorsService.findAll(true);
  }

  // 2. API cho Admin: Lấy tất cả, có thể lọc theo trạng thái
  @Get('admin/all')
  // @UseGuards(RolesGuard) // Sau này bạn sẽ thêm bảo mật ở đây
  @ApiOperation({ summary: 'Quản lý danh sách bác sĩ (Cho Admin)' })
  findAllForAdmin(@Query('onlyActive') onlyActive?: boolean) {
    return this.doctorsService.findAll(onlyActive);
  }

  @Get('user/:userId')
  findOneByUserId(@Param('userId') userId: string) {
    return this.doctorsService.findOneByUserId(userId);
  }

  @Get(':id')
  @ApiOperation({ summary: 'Lấy thông tin chi tiết một bác sĩ theo ID' })
  findOne(@Param('id') id: string) {
    return this.doctorsService.findOne(id);
  }

  @Patch(':id')
  update(
    @Param('id') id: string,
    @Body() updateDoctorDto: UpdateDoctorDto, // Đổi từ Partial<CreateDoctorDto> sang Class này
  ) {
    return this.doctorsService.update(id, updateDoctorDto);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.doctorsService.deactivate(id);
  }
}
-e \n[END OF FILE]\n
backend/src/doctors/doctors.module.ts
------------------------------------------
// src/doctors/doctors.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { DoctorsService } from './doctors.service';
import { DoctorsController } from './doctors.controller';
import { Doctor } from './doctors.entity';
import { User } from '../users/users.entity';
import { UsersModule } from 'src/users/users.module';

@Module({
  imports: [TypeOrmModule.forFeature([Doctor,User]), UsersModule], // Đăng ký Entity Doctor tại đây
  controllers: [DoctorsController],
  providers: [DoctorsService],
  exports: [DoctorsService], 
})
export class DoctorsModule {}-e \n[END OF FILE]\n
backend/src/doctors/doctors.entity.ts
------------------------------------------
// src/doctors/entities/doctor.entity.ts
import {
  Entity,
  Column,
  PrimaryGeneratedColumn,
  CreateDateColumn,
  OneToOne,
  ManyToOne,
  JoinColumn,
} from 'typeorm';
import { User } from '../users/users.entity';
import { Department } from '../departments/entities/department.entity'; // <-- Đảm bảo bạn đã có file này

@Entity('doctors')
export class Doctor {
  @Column({ type: 'enum', enum: ['male', 'female', 'other'], default: 'male' })
  gender: string;
  @PrimaryGeneratedColumn({ type: 'bigint' })
  id: string;

  @Column({ name: 'user_id' })
  userId: string;

  @OneToOne(() => User)
  @JoinColumn({ name: 'user_id' })
  user: User;

  @Column({ name: 'full_name', length: 100 })
  fullName: string;

  @Column({ unique: true, length: 20 })
  phone: string;

  // 1. Lưu ID của phòng ban vào cột này
  @Column({ name: 'department_id', type: 'bigint' })
  departmentId: string;

  // 2. Thiết lập mối quan hệ Many-To-One (Nhiều bác sĩ - Một phòng ban)
  @ManyToOne(() => Department)
  @JoinColumn({ name: 'department_id' })
  department: Department;

  @Column({ name: 'experience_year' })
  experienceYear: number;

  @Column({ type: 'text', nullable: true })
  description: string;

  @Column({ type: 'text', nullable: true })
  address: string;

  @Column({ name: 'patients_seen', default: 0 })
  patientsSeen: number;

  @Column({ name: 'date_of_birth', type: 'date' })
  dateOfBirth: Date;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;
}
-e \n[END OF FILE]\n
backend/src/app.controller.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { AppController } from './app.controller';
import { AppService } from './app.service';
 
describe('AppController', () => {
  let appController: AppController;

  beforeEach(async () => {
    const app: TestingModule = await Test.createTestingModule({
      controllers: [AppController],
      providers: [AppService],
    }).compile();

    appController = app.get<AppController>(AppController);
  });

  describe('root', () => {
    it('should return "Hello World!"', () => {
      expect(appController.getHello()).toBe('Hello World!');
    });
  });
});
-e \n[END OF FILE]\n
backend/src/users/users.entity.ts
------------------------------------------
import {
  Entity,
  Column,
  PrimaryGeneratedColumn,
  CreateDateColumn,
} from 'typeorm';

export enum UserRole {
  ADMIN = 'admin',
  DOCTOR = 'doctor',
  PATIENT = 'patient',
}

@Entity('users')
export class User {
  @PrimaryGeneratedColumn('uuid') // tự generate id
  id: string;

  @Column({ type: 'varchar', length: 255, unique: true })
  email: string;

  @Column({ type: 'varchar', length: 255 })
  password: string;

  @Column({ type: 'varchar', length: 50, unique: true })
  username: string;

  // src/users/users.entity.ts
  @Column({ nullable: true })
  avatar: string; // Đổi từ avatar_url thành avatar

  @Column({
    type: 'enum',
    enum: UserRole,
    default: UserRole.PATIENT,
  })
  role: UserRole;

  @Column({ type: 'boolean', default: true })
  is_active: boolean;

  @CreateDateColumn({ type: 'timestamptz' })
  created_at: Date;
}
-e \n[END OF FILE]\n
backend/src/users/dto/update-user.dto.ts
------------------------------------------
import { IsEnum, IsOptional, IsString } from 'class-validator';
import { UserRole } from '../users.entity';
import { ApiPropertyOptional } from '@nestjs/swagger';

export class UpdateUserDto {
  @ApiPropertyOptional({ example: 'Nguyễn Phương Ngân' })
  @IsOptional()
  @IsString()
  fullName?: string;

  @ApiPropertyOptional({ description: 'Đường dẫn avatar' })
  @IsOptional()
  @IsString()
  avatar?: string;

  // Thêm cập nhật Role ở đây
  @ApiPropertyOptional({ 
    enum: UserRole, 
    example: UserRole.PATIENT,
    description: 'Vai trò của người dùng trong hệ thống'
  })
  @IsOptional()
  @IsEnum(UserRole)
  role?: UserRole;

  @ApiPropertyOptional({ example: true })
  @IsOptional()
  is_active?: boolean;
}-e \n[END OF FILE]\n
backend/src/users/dto/create-user.dto.ts
------------------------------------------
import { IsEmail, IsEnum, IsNotEmpty, IsOptional, IsString } from 'class-validator';
import { UserRole } from '../users.entity';

export class CreateUserDto {
  @IsEmail()
  email: string;

  @IsString()
  @IsNotEmpty()
  password: string;

  @IsString()
  @IsNotEmpty()
  username: string;

  @IsOptional()
  @IsEnum(UserRole)
  role?: UserRole;
}
-e \n[END OF FILE]\n
backend/src/users/users.service.ts
------------------------------------------
// src/users/users.service.ts
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { User } from './users.entity';
import { CreateUserDto } from './dto/create-user.dto';
import { UpdateUserDto } from './dto/update-user.dto';

@Injectable()
export class UsersService {
  constructor(
    @InjectRepository(User)
    private readonly userRepository: Repository<User>,
  ) {}

  async create(dto: CreateUserDto): Promise<User> {
    const user = this.userRepository.create(dto);
    return this.userRepository.save(user);
  }

  findAll(): Promise<User[]> {
    return this.userRepository.find();
  }

  async updateAvatar(userId: string, avatarUrl: string) {
    const user = await this.userRepository.findOne({ where: { id: userId } });
    if (!user) {
      throw new NotFoundException('Người dùng không tồn tại');
    }
  
    // Cập nhật trường avatar trong database
    await this.userRepository.update(userId, { avatar: avatarUrl });
    
    return { 
      message: 'Cập nhật avatar thành công',
      avatar_url: avatarUrl 
    };
  }

  async findOne(id: string): Promise<User> {
    const user = await this.userRepository.findOne({ where: { id } });
    if (!user) throw new NotFoundException('User not found');
    return user;
  }

  async findByUsername(username: string): Promise<User | null> {
    return this.userRepository.findOne({
      where: { username },
      // QUAN TRỌNG: Phải lấy 'is_active' ra để validate ở AuthService
      select: ['id', 'username', 'password', 'role', 'is_active'],
    });
  }

  async findByEmail(email: string): Promise<User | null> {
    return this.userRepository.findOne({ where: { email } });
  }

  async update(id: string, updateUserDto: UpdateUserDto) {
    // 1. Kiểm tra user có tồn tại không
    const user = await this.userRepository.findOne({ where: { id } });
    if (!user) {
      throw new NotFoundException(`Không tìm thấy người dùng với ID: ${id}`);
    }

    // 2. Ghi đè dữ liệu mới vào dữ liệu cũ
    Object.assign(user, updateUserDto);

    // 3. Lưu lại
    return await this.userRepository.save(user);
  }

  async remove(id: string): Promise<void> {
    const result = await this.userRepository.delete(id);
    if (result.affected === 0) throw new NotFoundException('User not found');
  }
}
-e \n[END OF FILE]\n
backend/src/users/users.controller.ts
------------------------------------------
import {
  Controller,
  Get,
  Post,
  Body,
  Param,
  Put,
  Delete,
  UploadedFile,
  UseInterceptors,
  Patch,
  BadRequestException,
} from '@nestjs/common';
import { UsersService } from './users.service';
import { CreateUserDto } from './dto/create-user.dto';
import { UpdateUserDto } from './dto/update-user.dto';
import { FileInterceptor } from '@nestjs/platform-express';
import { diskStorage } from 'multer';
import { extname, join } from 'path';
import { ApiBody, ApiConsumes, ApiOperation } from '@nestjs/swagger';
import * as fs from 'fs';

@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Post()
  create(@Body() dto: CreateUserDto) {
    return this.usersService.create(dto);
  }

  @Patch(':id')
  @ApiOperation({ summary: 'Cập nhật thông tin người dùng' })
  // Nếu chỉ cập nhật JSON bình thường, Swagger sẽ tự nhận diện qua DTO
  async update(@Param('id') id: string, @Body() updateUserDto: UpdateUserDto) {
    return this.usersService.update(id, updateUserDto);
  }

  @Get()
  findAll() {
    return this.usersService.findAll();
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.usersService.findOne(id);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.usersService.remove(id);
  }

  // users.controller.ts
  @Post('upload-avatar/:userId')
  @ApiOperation({ summary: 'Upload avatar cho người dùng' })
  @ApiConsumes('multipart/form-data') // Bắt buộc để Swagger hiện nút upload
  @ApiBody({
    schema: {
      type: 'object',
      properties: {
        file: {
          // Tên field này phải khớp với FileInterceptor('file')
          type: 'string',
          format: 'binary',
        },
      },
    },
  })
  @UseInterceptors(
    FileInterceptor('file', {
      storage: diskStorage({
        destination: './src/avatar', // Lưu vào src/avatar như bạn muốn
        filename: (req, file, callback) => {
          const userId = req.params.userId;
          const fileExtName = extname(file.originalname);
          const fileName = `user_${userId}${fileExtName}`;
          const fullPath = join('./src/avatar', fileName);

          // Nếu file đã tồn tại, xóa nó đi trước khi Multer ghi file mới
          if (fs.existsSync(fullPath)) {
            try {
              fs.unlinkSync(fullPath);
            } catch (e) {
              // Đôi khi file bị lock bởi hệ thống, có thể bỏ qua hoặc log lỗi
            }
          }
          callback(null, fileName);
        },
      }),
    }),
  )
  async uploadUserAvatar(
    @Param('userId') userId: string,
    @UploadedFile() file: Express.Multer.File,
  ) {
    if (!file) {
      throw new Error('File upload thất bại!');
    }
    const avatarUrl = `/avatar/${file.filename}`;
    await this.usersService.updateAvatar(userId, avatarUrl);
    return {
      message: 'Upload thành công',
      path: avatarUrl,
    };
  }

  // Thêm vào users.controller.ts

  @Patch('avatar/:userId')
  @ApiOperation({ summary: 'Cập nhật avatar người dùng và ghi đè file cũ' })
  @ApiConsumes('multipart/form-data') // 1. Khai báo kiểu dữ liệu là multipart
  @ApiBody({
    // 2. Định nghĩa cấu trúc body cho Swagger
    schema: {
      type: 'object',
      properties: {
        file: {
          // Tên này phải khớp với FileInterceptor('file')
          type: 'string',
          format: 'binary', // binary sẽ kích hoạt ô Upload file trong Swagger
        },
      },
    },
  })
  @UseInterceptors(
    FileInterceptor('file', {
      storage: diskStorage({
        destination: './src/avatar',
        filename: (req, file, callback) => {
          const userId = req.params.userId;
          const fileExtName = extname(file.originalname);
          const fileName = `user_${userId}${fileExtName}`;

          const fullPath = join('./src/avatar', fileName);
          if (fs.existsSync(fullPath)) {
            try {
              fs.unlinkSync(fullPath);
            } catch (err) {
              console.error('Lỗi khi xóa file cũ:', err);
            }
          }
          callback(null, fileName);
        },
      }),
    }),
  )
  async patchAvatar(
    @Param('userId') userId: string,
    @UploadedFile() file: Express.Multer.File,
  ) {
    if (!file) throw new BadRequestException('Vui lòng chọn ảnh');
    const avatarPath = `/src/avatar/${file.filename}`;
    return this.usersService.updateAvatar(userId, avatarPath);
  }
}
-e \n[END OF FILE]\n
backend/src/users/users.module.ts
------------------------------------------
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { UsersService } from './users.service';
import { UsersController } from './users.controller';
import { User } from './users.entity';

@Module({
  imports: [TypeOrmModule.forFeature([User])],
  controllers: [UsersController],
  providers: [UsersService],
  exports: [UsersService],
})
export class UsersModule {}
-e \n[END OF FILE]\n
backend/src/app.controller.ts
------------------------------------------
import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}
-e \n[END OF FILE]\n
backend/src/prescriptions/dto/update-prescription.dto.ts
------------------------------------------
// src/prescriptions/dto/update-prescription.dto.ts
import { PartialType } from '@nestjs/swagger';
import { CreatePrescriptionDto } from './create-prescription.dto';

export class UpdatePrescriptionDto extends PartialType(CreatePrescriptionDto) {}-e \n[END OF FILE]\n
backend/src/prescriptions/dto/create-prescription.dto.ts
------------------------------------------
import { ApiProperty } from '@nestjs/swagger';
import { IsNotEmpty, IsString, IsOptional ,MaxLength } from 'class-validator';

export class CreatePrescriptionDto {
  @ApiProperty({ example: '1' })
  @IsNotEmpty()
  medical_record_id: string;
  
  @ApiProperty({ example: '1', required: false, description: 'ID từ bảng medicines' })
  @IsOptional()
  medicine_id?: string;

  @ApiProperty({ example: 'Augmentin 625mg' })
  @IsNotEmpty()
  @IsString()
  @MaxLength(100)
  medicine_name: string;

  @ApiProperty({ example: '14 viên' })
  @IsNotEmpty()
  @IsString()
  @MaxLength(100)
  dosage: string;

  @ApiProperty({ example: 'Uống 1 viên mỗi 12 giờ, sau khi ăn.' })
  @IsNotEmpty()
  @IsString()
  usage: string;
}-e \n[END OF FILE]\n
backend/src/prescriptions/prescriptions.service.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { PrescriptionsService } from './prescriptions.service';

describe('PrescriptionsService', () => {
  let service: PrescriptionsService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [PrescriptionsService],
    }).compile();

    service = module.get<PrescriptionsService>(PrescriptionsService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/prescriptions/prescriptions.controller.ts
------------------------------------------
import { Controller, Post, Body, Get, Param, Patch } from '@nestjs/common';
import { PrescriptionsService } from './prescriptions.service';
import { CreatePrescriptionDto } from './dto/create-prescription.dto';
import { ApiOperation, ApiTags } from '@nestjs/swagger';
import { UpdatePrescriptionDto } from './dto/update-prescription.dto';

@ApiTags('prescriptions')
@Controller('prescriptions')
export class PrescriptionsController {
  constructor(private readonly prescriptionsService: PrescriptionsService) {}

  @Post()
  create(@Body() dto: CreatePrescriptionDto) {
    return this.prescriptionsService.create(dto);
  }

  @Get('record/:recordId')
  findAllByRecord(@Param('recordId') recordId: string) {
    return this.prescriptionsService.findAllByRecord(recordId);
  }

  @Patch(':id')
  @ApiOperation({ summary: 'Cập nhật thông tin một loại thuốc trong đơn' })
  update(@Param('id') id: string, @Body() dto: UpdatePrescriptionDto) {
    return this.prescriptionsService.update(id, dto);
  }
}
-e \n[END OF FILE]\n
backend/src/prescriptions/prescriptions.service.ts
------------------------------------------
import { Injectable, NotFoundException, ConflictException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Prescription } from './entities/prescription.entity';
import { CreatePrescriptionDto } from './dto/create-prescription.dto';
import { MedicalRecord } from '../medical-records/entities/medical-record.entity';
import { UpdatePrescriptionDto } from './dto/update-prescription.dto';
import { Medicine } from '../medicines/entities/medicine.entity'; // Thêm import này

@Injectable()
export class PrescriptionsService {
  constructor(
    @InjectRepository(Prescription)
    private readonly prescriptionRepo: Repository<Prescription>,

    @InjectRepository(MedicalRecord)
    private readonly recordRepo: Repository<MedicalRecord>,

    @InjectRepository(Medicine) // Inject thêm Repository thuốc
    private readonly medicineRepo: Repository<Medicine>,
  ) {}

  async create(dto: CreatePrescriptionDto) {
    // 1. Kiểm tra sự tồn tại của bệnh án
    const record = await this.recordRepo.findOne({ where: { id: dto.medical_record_id } });
    if (!record) throw new NotFoundException('Hồ sơ bệnh án không tồn tại');

    // 2. Logic thông minh cho tên thuốc:
    let finalMedicineName = dto.medicine_name;
    
    // Nếu có medicine_id, ưu tiên lấy tên chuẩn từ danh mục thuốc
    if (dto.medicine_id) {
      const medicine = await this.medicineRepo.findOne({ where: { id: dto.medicine_id } });
      if (medicine) {
        finalMedicineName = `${medicine.name} ${medicine.concentration || ''}`.trim();
      }
    }

    // 3. Tạo bản ghi
    const prescription = this.prescriptionRepo.create({
      medicalRecord: record,
      medicineId: dto.medicine_id, // Lưu ID để liên kết (nếu có)
      medicine_name: finalMedicineName, // Lưu text để hiển thị tĩnh
      dosage: dto.dosage,
      usage: dto.usage,
    });

    try {
      return await this.prescriptionRepo.save(prescription);
    } catch (error) {
      if (error.code === '23505') { 
        throw new ConflictException('Loại thuốc này đã có trong đơn thuốc của bệnh án này rồi');
      }
      throw error;
    }
  }

  async update(id: string, dto: UpdatePrescriptionDto) {
    const prescription = await this.prescriptionRepo.findOne({ where: { id } });
    if (!prescription) {
      throw new NotFoundException(`Không tìm thấy đơn thuốc với ID ${id}`);
    }
  
    if (dto.medical_record_id) {
      const record = await this.recordRepo.findOne({ where: { id: dto.medical_record_id } });
      if (!record) throw new NotFoundException('Hồ sơ bệnh án mới không tồn tại');
    }

    // Cập nhật dữ liệu
    Object.assign(prescription, dto);
  
    try {
      return await this.prescriptionRepo.save(prescription);
    } catch (error) {
      if (error.code === '23505') {
        throw new ConflictException('Tên thuốc này đã tồn tại trong đơn thuốc này rồi');
      }
      throw error;
    }
  }

  async findAllByRecord(recordId: string) {
    return await this.prescriptionRepo.find({
      where: { medicalRecordId: recordId },
      relations: ['medicine'] // Để lấy được cả thông tin gốc của thuốc nếu cần
    });
  }

  async remove(id: string) {
    const result = await this.prescriptionRepo.delete(id);
    if (result.affected === 0) throw new NotFoundException('Không tìm thấy đơn thuốc để xóa');
    return { message: 'Đã xóa thuốc khỏi đơn' };
  }
}-e \n[END OF FILE]\n
backend/src/prescriptions/prescriptions.controller.spec.ts
------------------------------------------
import { Test, TestingModule } from '@nestjs/testing';
import { PrescriptionsController } from './prescriptions.controller';
import { PrescriptionsService } from './prescriptions.service';

describe('PrescriptionsController', () => {
  let controller: PrescriptionsController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [PrescriptionsController],
      providers: [PrescriptionsService],
    }).compile();

    controller = module.get<PrescriptionsController>(PrescriptionsController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});
-e \n[END OF FILE]\n
backend/src/prescriptions/entities/prescription.entity.ts
------------------------------------------
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, JoinColumn, Unique } from 'typeorm';
import { MedicalRecord } from '../../medical-records/entities/medical-record.entity';
import { Medicine } from '../../medicines/entities/medicine.entity'; // Import Medicine Entity mới tạo

@Entity('prescriptions')
@Unique('unique_medicine_per_record', ['medicalRecordId', 'medicine_name'])
export class Prescription {
  @PrimaryGeneratedColumn({ type: 'bigint' })
  id: string;

  @Column({ name: 'medical_record_id', type: 'bigint' })
  medicalRecordId: string;

  @ManyToOne(() => MedicalRecord, { onDelete: 'CASCADE' })
  @JoinColumn({ name: 'medical_record_id' })
  medicalRecord: MedicalRecord;

  // Link tới bảng danh sách thuốc (Optional - Nếu thuốc có trong danh mục)
  @Column({ name: 'medicine_id', type: 'bigint', nullable: true })
  medicineId: string;

  @ManyToOne(() => Medicine, { nullable: true })
  @JoinColumn({ name: 'medicine_id' })
  medicine: Medicine;

  // Tên thuốc hiển thị (Lưu tên thuốc chuẩn từ bảng Medicine hoặc tên thuốc bác sĩ tự gõ)
  @Column({ type: 'varchar', length: 100 })
  medicine_name: string;

  @Column({ type: 'varchar', length: 100 })
  dosage: string;

  @Column({ type: 'text' })
  usage: string;
}-e \n[END OF FILE]\n
backend/src/prescriptions/prescriptions.module.ts
------------------------------------------
// src/prescriptions/prescriptions.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { PrescriptionsService } from './prescriptions.service';
import { PrescriptionsController } from './prescriptions.controller';
import { Prescription } from './entities/prescription.entity'; // Đảm bảo đúng đường dẫn
import { MedicalRecord } from '../medical-records/entities/medical-record.entity'; // Đảm bảo đúng đường dẫn
import { Medicine } from 'src/medicines/entities/medicine.entity';

@Module({
  imports: [
    // BỔ SUNG: Phải có cả Prescription và MedicalRecord trong mảng này
    TypeOrmModule.forFeature([Prescription, MedicalRecord, Medicine]),
  ],
  controllers: [PrescriptionsController],
  providers: [PrescriptionsService],
  exports: [PrescriptionsService], // Export nếu bạn muốn module khác sử dụng
})
export class PrescriptionsModule {}-e \n[END OF FILE]\n
backend/src/notifications/dto/create-notification.dto.ts
------------------------------------------
-e \n[END OF FILE]\n
backend/src/notifications/dto/update-notification.dto.ts
------------------------------------------
-e \n[END OF FILE]\n
backend/src/notifications/notifications.module.ts
------------------------------------------
// src/notifications/notifications.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { Notification } from './notifications.entity';
import { NotificationsService } from './notifications.service';
import { NotificationsController } from './notifications.controller';

@Module({
  imports: [TypeOrmModule.forFeature([Notification])],
  providers: [NotificationsService],
  controllers: [NotificationsController],
  exports: [NotificationsService], // QUAN TRỌNG: Để module khác có thể sử dụng
})
export class NotificationsModule {}-e \n[END OF FILE]\n
backend/src/notifications/notifications.controller.ts
------------------------------------------
// src/notifications/notifications.controller.ts
import { Controller, Get, Patch, Param, ParseIntPipe } from '@nestjs/common';
import { NotificationsService } from './notifications.service';
import { ApiTags, ApiOperation } from '@nestjs/swagger';

@ApiTags('notifications')
@Controller('notifications')
export class NotificationsController {
  constructor(private readonly notificationsService: NotificationsService) {}

  @Get('user/:userId')
  @ApiOperation({ summary: 'Lấy tất cả thông báo của một người dùng' })
  findByUser(@Param('userId') userId: string) {
    return this.notificationsService.findAllByUser(userId);
  }

  @Patch(':id/read')
  @ApiOperation({ summary: 'Đánh dấu thông báo đã đọc' })
  markAsRead(@Param('id') id: string) {
    return this.notificationsService.markAsRead(id);
  }
}-e \n[END OF FILE]\n
backend/src/notifications/notifications.service.ts
------------------------------------------
// src/notifications/notifications.service.ts
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Notification } from './notifications.entity';

@Injectable()
export class NotificationsService {
  constructor(
    @InjectRepository(Notification)
    private readonly notificationRepo: Repository<Notification>,
  ) {}

  // Hàm để các module khác gọi
  async createNotification(data: Partial<Notification>) {
    const notif = this.notificationRepo.create(data);
    return await this.notificationRepo.save(notif);
  }

  // Lấy danh sách thông báo của user
  async findAllByUser(userId: string) {
    return await this.notificationRepo.find({
      where: { userId },
      order: { createdAt: 'DESC' },
    });
  }

  // Đánh dấu đã đọc
  async markAsRead(id: string) {
    const notif = await this.notificationRepo.findOneBy({ id });
    if (!notif) throw new NotFoundException('Notification not found');
    notif.isRead = true;
    return await this.notificationRepo.save(notif);
  }
}
-e \n[END OF FILE]\n
backend/src/notifications/notifications.entity.ts
------------------------------------------
// src/notifications/notifications.entity.ts
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  ManyToOne,
  JoinColumn,
  Index,
} from 'typeorm';
import { User } from '../users/users.entity';

export enum NotificationType {
  APPOINTMENT = 'appointment',
  MEDICAL_RECORD = 'medical_record',
  SYSTEM = 'system',
}

@Entity('notifications')
@Index('idx_notifications_user_unread', ['userId', 'isRead', 'createdAt'])
export class Notification {
  @PrimaryGeneratedColumn({ type: 'bigint' })
  id: string;

  @Column({ name: 'user_id' })
  userId: string;

  @ManyToOne(() => User, { onDelete: 'CASCADE' })
  @JoinColumn({ name: 'user_id' })
  user: User;

  @Column({ length: 255 })
  title: string;

  @Column({ type: 'text' })
  content: string;

  @Column({ name: 'is_read', default: false })
  isRead: boolean;

  @Column({ type: 'enum', enum: NotificationType })
  type: NotificationType;

  @Column({ name: 'target_url', type: 'text', nullable: true })
  targetUrl: string;

  @CreateDateColumn({ name: 'created_at', type: 'timestamp with time zone' })
  createdAt: Date;
}
-e \n[END OF FILE]\n
backend/src/reports/dto/report-query.dto.ts
------------------------------------------
-e \n[END OF FILE]\n
backend/src/reports/reports.service.ts
------------------------------------------
-e \n[END OF FILE]\n
backend/src/reports/reports.module.ts
------------------------------------------
-e \n[END OF FILE]\n
backend/src/reports/reports.controller.ts
------------------------------------------
-e \n[END OF FILE]\n
frontend/src/App.tsx
------------------------------------------
import { Routes, Route, Navigate } from 'react-router-dom';
import Login from './pages/Login';
import DoctorLayout from './layouts/DoctorLayout';
import Dashboard from './pages/doctor/Dashboard';
import Appointments from './pages/doctor/Appointments';
import Request from './pages/doctor/Request';
import AppointmentHistory from './pages/doctor/History';
import Notifications from './pages/doctor/Notifications';
import DoctorProfile from './pages/doctor/Profile';
import PatientAppointment from "./pages/patient/PatientAppointment";
import ProfilePatient from './pages/patient/ProfilePatient';
import SignUp from './pages/SignUp';

// IMPORT CHO PATIENT
import PatientDashboard from './pages/patient/PatientDashboard';
import PatientNotification from './pages/patient/PatientNotification';
import PatientLayout from './layouts/PatientLayout';
// Giả sử sau này bạn tạo thêm:
// import PatientAppointments from './pages/patient/PatientAppointments';

function App() {
  return (
    <Routes>
      {/* 1. ĐIỀU HƯỚNG MẶC ĐỊNH */}
      <Route path="/" element={<Navigate to="/login" replace />} />

      {/* 2. TRANG LOGIN */}
      <Route path="/login" element={<Login />} />
      <Route path="/register" element={<SignUp />} />

      {/* 3. NHÓM TRANG DOCTOR (Màu xanh Mint) */}
      <Route path="/doctor" element={<DoctorLayout />}>
        <Route index element={<Dashboard />} />
        <Route path="dashboard" element={<Dashboard />} />
        <Route path="appointments" element={<Appointments />} />
        <Route path="request" element={<Request />} />
        <Route path="history" element={<AppointmentHistory />} />
        <Route path="notification" element={<Notifications />} />
        <Route path="profile" element={<DoctorProfile />} />
      </Route>

      {/* 4. NHÓM TRANG PATIENT (Màu xanh Blue) */}
      {/* Nếu bạn chưa tạo PatientLayout, bạn có thể gọi trực tiếp Dashboard có chứa Header */}
      <Route path="/patient" element={<PatientLayout />}>
        <Route index element={<PatientDashboard />} />
        <Route path="dashboard" element={<PatientDashboard />} />
        <Route path="/patient/appointments" element={<PatientAppointment />} />
        <Route path="/patient/notifications" element={<PatientNotification />} />
        <Route path="profile" element={<ProfilePatient />} />
        
        {/* Sau này thêm các trang con cho Patient tại đây:
        <Route path="appointments" element={<PatientAppointments />} />
        <Route path="notifications" element={<PatientNotifications />} />
        <Route path="profile" element={<PatientProfile />} /> 
        */}
      </Route>

      {/* 5. TRANG 404 */}
      <Route path="*" element={<Navigate to="/login" replace />} />
    </Routes>
  );
}

export default App;-e \n[END OF FILE]\n
frontend/src/main.tsx
------------------------------------------
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom'; // Import bộ điều hướng
import App from './App.tsx';
import './index.css'; // File CSS tổng của toàn dự án

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    {/* BrowserRouter phải bao bọc toàn bộ App để các Route hoạt động */}
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </StrictMode>,
);-e \n[END OF FILE]\n
frontend/src/App.css
------------------------------------------
/* Đổi màu chữ khi hover và active */
.ant-menu-horizontal > .ant-menu-item-selected {
    color: #4cc9b0 !important;
}

.ant-menu-horizontal > .ant-menu-item-selected::after {
    border-bottom-color: #4cc9b0 !important;
    border-bottom-width: 3px !important;
}

.ant-menu-item:hover {
    color: #4cc9b0 !important;
}

.user-profile-wrapper {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 8px;
}

.user-profile-wrapper:hover {
    background-color: rgba(76, 201, 176, 0.1);
}

/* Khối chứa 2 dòng text */
.user-info-text {
    display: flex;
    flex-direction: column;
    justify-content: center;
    line-height: 1.2; /* Kiểm soát khoảng cách giữa các dòng */
}

.user-name {
    font-size: 14px;
    margin-bottom: 0 !important; /* Xóa margin mặc định của Typography */
    display: block;
}

.user-role {
    font-size: 11px;
    color: #888;
    margin-top: -2px; /* Kéo dòng role gần lại dòng tên nếu cần */
    display: block;
}-e \n[END OF FILE]\n
frontend/src/index.css
------------------------------------------
-e \n[END OF FILE]\n
frontend/src/components/PatientHeader.css
------------------------------------------
/* Kế thừa toàn bộ khung từ HeaderDoctor */
@import "./HeaderDoctor.css";

/* Thay đổi màu sắc chủ đạo sang xanh dương cho Patient */
.header-patient .header-menu .ant-menu-item-selected {
  color: #3b82f6 !important; 
}

.header-patient .header-menu .ant-menu-item-selected::after {
  border-bottom-color: #3b82f6 !important;
}

.header-patient .header-menu .ant-menu-item:hover::after {
  border-bottom-color: #3b82f6 !important;
}

/* Border Profile màu xanh dương */
.patient-profile-border {
  border: 1px solid #3b82f6 !important; 
}

.patient-profile-border:hover {
  background-color: rgba(59, 130, 246, 0.1) !important;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15) !important;
}

.patient-profile-border:hover .user-name {
  color: #3b82f6 !important;
}

/* Đồng bộ kích thước font menu với Doctor */
.patient-menu {
  font-size: 18px !important;
  font-weight: 550 !important;
}

/* Điều chỉnh khoảng cách icon và text trong menu */
.patient-menu .ant-menu-title-content {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Tùy chỉnh nhỏ để menu patient trông cân đối hơn */
.header-menu {
  justify-content: center;
  flex: 1;
}

/* Đảm bảo màu chữ và hiệu ứng hover giống hệt doctor (#4cc9b0) */
.ant-menu-item-selected {
  color: #4cc9b0 !important;
}

.ant-menu-horizontal > .ant-menu-item-selected::after {
  border-bottom-color: #4cc9b0 !important;
}

.user-name {
  color: #141619 !important; /* Màu chữ tên giống doctor */
}

.user-role {
  color: #abb2bf !important; /* Màu chữ role giống doctor */
  font-size: 12px;
}

/* Container chứa tên và role */
.user-info-text {
  display: flex;
  flex-direction: column; /* Xếp dọc thay vì dùng thẻ <br /> */
  line-height: 1.2; /* Thu hẹp chiều cao dòng mặc định */
}

/* Chỉnh tên người dùng */
.user-info-text .user-name {

  display: block;
  font-size: 14px;
}

/* Chỉnh dòng Patient Account */
.user-info-text .user-role {
  font-size: 12px;
  color: #6b7280; /* Màu xám nhẹ cho role */
  display: block;
}-e \n[END OF FILE]\n
frontend/src/components/CustomInput.tsx
------------------------------------------
-e \n[END OF FILE]\n
frontend/src/components/PatientHeader.tsx
------------------------------------------
import React, { useEffect, useState } from "react";
import { Layout, Menu, Avatar, Space, Typography } from "antd";
import { UserOutlined } from "@ant-design/icons";
import { Link, useLocation, useNavigate } from "react-router-dom";
import axios from "axios";
import logoMedi from "../assets/logos/MediBookLogo.svg";
import "./PatientHeader.css";

const { Header } = Layout;
const { Text } = Typography;

const PatientHeader: React.FC = () => {
  const location = useLocation();
  const navigate = useNavigate();
  const [fullName, setFullName] = useState<string>("Bệnh nhân");
  const [avatar, setAvatar] = useState<string | null>(null);

  useEffect(() => {
    const fetchPatientProfile = async () => {
      try {
        const userId = localStorage.getItem("userId");
        const token = localStorage.getItem("token");
        if (userId) {
          const res = await axios.get(
            `http://localhost:3000/api/patients/user/${userId}`,
            {
              headers: { Authorization: `Bearer ${token}` },
            }
          );
          if (res.data) {
            setFullName(res.data.fullName);
            setAvatar(res.data.avatar);
          }
        }
      } catch (error) {
        console.error("Lỗi lấy thông tin bệnh nhân:", error);
      }
    };
    fetchPatientProfile();
  }, []);

  // Đã loại bỏ thuộc tính 'icon' ở đây
  const menuItems = [
    {
      key: "/patient/dashboard",
      label: <Link to="/patient/dashboard">Home</Link>,
    },
    {
      key: "/patient/appointments",
      label: <Link to="/patient/appointments">Appointments</Link>,
    },
    {
      key: "/patient/notifications",
      label: <Link to="/patient/notifications">Notification</Link>,
    },
  ];

  return (
    <Header className="header-doctor">
      {" "}
      {/* Kế thừa class header-doctor để đồng bộ 100% layout */}
      <div className="logo-container">
        <Link to="/patient/dashboard">
          <img src={logoMedi} alt="MediBook" />
        </Link>
      </div>
      <Menu
        mode="horizontal"
        selectedKeys={[location.pathname]}
        items={menuItems}
        className="header-menu"
      />
      <div
        className="user-profile-wrapper"
        onClick={() => navigate("/patient/profile")}
      >
        <Space size={10} align="center">
          <Avatar
            style={{ backgroundColor: "#4cc9b0" }} // Màu xanh Mint đồng bộ với Doctor
            icon={<UserOutlined />}
            src={avatar}
            size={38}
          />
          <div className="user-info-text">
            <Text strong className="user-name">
              {fullName}
            </Text>
            <Text
              className="user-role"
              style={{
                display: "block",
                marginTop: "-2px", // Đây là khoảng cách bạn muốn thêm (tăng/giảm tùy ý)
                fontSize: "12px",
              }}
            >
              Patient Account
            </Text>
          </div>
        </Space>
      </div>
    </Header>
  );
};

export default PatientHeader;
-e \n[END OF FILE]\n
frontend/src/components/PrimaryButton.tsx
------------------------------------------
-e \n[END OF FILE]\n
frontend/src/components/HeaderDoctor.css
------------------------------------------
/* Khung Header chính */
.header-doctor {
  background-color: #fff !important;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 40px;
  height: 80px;
  position: sticky;
  top: 0;
  z-index: 1000;
  width: 100%;
}

/* Container bao quanh logo */
.logo-container {
  display: flex;
  align-items: center;
  /* Chiếm khoảng 15% chiều rộng header, tối thiểu 120px, tối đa 250px */
  width: clamp(180px, 20vw, 300px);
  height: 100%;
  margin-top: 20px;
}

.logo-container a {
  display: flex;
  align-items: center;
  width: 100%;
}

/* Icon MediBook */
.logo-container img {
  /* Scale theo chiều rộng của container bao quanh */
  width: 100%;
  max-height: 80px; /* Giới hạn độ cao tối đa để không làm vỡ header */
  object-fit: contain; /* Giữ nguyên tỷ lệ ảnh */
  transition: transform 0.3s ease; /* Hiệu ứng mượt khi scale */
}

/* Hiệu ứng khi di chuột vào logo */
.logo-container img:hover {
  transform: scale(1.05);
}

/* Responsive cho màn hình nhỏ (Mobile/Tablet) */
@media (max-width: 768px) {
  .logo-container {
    width: 100px; /* Nhỏ lại khi trên điện thoại */
  }
  .header-doctor {
    padding: 0 15px; /* Giảm padding header trên mobile */
  }
}

/* Tùy chỉnh Menu Ant Design */
.header-menu {
  flex: 1;
  border-bottom: none !important;
  font-size: 18px;
  font-weight: 550;
  padding-right: 50px;
}

/* Tăng khoảng cách giữa các mục Menu */
.header-menu .ant-menu-item {
  /* Tăng khoảng cách trái phải của mỗi từ */
  padding: 0 3vw !important;
  /* margin: 0 5px; */ /* Bạn cũng có thể dùng margin nếu muốn khoảng cách xa hơn nữa */
  color: #484848 !important;
  transition: all 0.3s ease;
}

/* Nếu bạn muốn tăng khoảng cách giữa các chữ cái trong cùng một từ (ví dụ: H o m e) */
.header-menu .ant-menu-item .ant-menu-title-content {
  letter-spacing: 0.5px; /* Khoảng cách giữa các chữ cái */
}

/* Đảm bảo Menu dàn hàng ngang đều nhau */
.header-menu {
  display: flex;
  justify-content: flex-end;
  gap: 10px; /* Chỉ hoạt động với một số phiên bản Ant Design mới */
}

/* Đổi màu khi hover và khi mục đang được chọn */
.header-menu .ant-menu-item-selected {
  font-size: 25px !important; /* Tăng cỡ chữ lên 18px hoặc to hơn tùy bạn */
  font-weight: 700 !important; /* Làm chữ đậm hẳn lên */
  color: #4cc9b0 !important; /* Đảm bảo đúng màu xanh MediBook */
}

.header-menu .ant-menu-item-selected::after {
  border-bottom-color: #4cc9b0 !important;
  border-bottom-width: 3px !important;
}

.header-menu .ant-menu-item:hover::after {
  border-bottom-color: #4cc9b0 !important;
}

/* Khung Profile bên phải - Đã dọn dẹp và sửa lỗi trùng lặp */
.user-profile-wrapper {
    display: inline-flex !important;
    align-items: center;
    
    /* 1. KHỐNG CHẾ KÍCH THƯỚC */
    height: 48px !important;    /* Chiều cao vừa vặn */
    padding-left: 5px !important;
    padding-right: 20px !important; /* TĂNG MẠNH: Tạo khoảng trống lớn bên phải */
    min-width: 200px;           /* Đảm bảo ô luôn dài kể cả tên ngắn */
    
    /* 2. STYLE */
    border: 1px solid #4cc9b0 !important; 
    border-radius: 50px !important;
    background-color: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    
    /* 3. VỊ TRÍ */
    align-self: center; 
    margin-left: 20px; 
}

/* Hiệu ứng HOVER */
.user-profile-wrapper:hover {
    background-color: rgba(76, 201, 176, 0.1);
    box-shadow: 0 4px 12px rgba(76, 201, 176, 0.15);
    transform: translateY(-1px);
}

.user-info-text {
    display: flex;
    flex-direction: column;
    text-align: left;
    line-height: 1 !important;
    /* margin-left: 1px; Khoảng cách giữa Avatar và chữ */
}

.user-name {
    font-size: 15px;
    font-weight: 700;
    color: #1a1a1a;
    white-space: nowrap; /* Bắt buộc tên không xuống dòng */
    margin-bottom: 0 !important;
    padding-right: 12px;
}

.user-role {
    font-size: 11px;
    color: #8c8c8c;
    margin-top: -16px;
}

/* Đổi màu chữ tên khi hover */
.user-profile-wrapper:hover .user-name {
    color: #4cc9b0;
}
/* Xóa gạch chân khi item được chọn (Active) */
.ant-menu-horizontal > .ant-menu-item-selected::after {
    border-bottom: none !important;
  }
  
  /* Xóa gạch chân khi di chuột vào (Hover) */
  .ant-menu-horizontal > .ant-menu-item:hover::after {
    border-bottom: none !important;
  }
  
  /* Xóa hiệu ứng bóng nếu có ở một số phiên bản Ant Design */
  .ant-menu-horizontal {
    border-bottom: none !important;
    box-shadow: none !important;
  }-e \n[END OF FILE]\n
frontend/src/components/HeaderDoctor.tsx
------------------------------------------
import React, { useEffect, useState } from "react";
import { Layout, Menu, Avatar, Space, Typography } from "antd";
import { UserOutlined } from "@ant-design/icons";
import { Link, useLocation, useNavigate } from "react-router-dom"; // Thêm useNavigate nếu muốn điều hướng bằng hàm
import { doctorApi } from "../api/DoctorApi";
import logoMedi from "../assets/logos/MediBookLogo.svg";
import "./HeaderDoctor.css";

const { Header } = Layout;
const { Text } = Typography;

const HeaderDoctor: React.FC = () => {
  const location = useLocation();
  const navigate = useNavigate(); // Hook để điều hướng
  const [fullName, setFullName] = useState<string>("Bác sĩ");

  useEffect(() => {
    const fetchDoctorName = async () => {
      try {
        const userId = localStorage.getItem("doctorId");
        if (userId) {
          const data = await doctorApi.getProfile(userId);
          if (data && data.fullName) {
            setFullName(data.fullName);
          }
        }
      } catch (error) {
        console.error("Lỗi lấy tên bác sĩ tại Header:", error);
      }
    };
    fetchDoctorName();
  }, []);

  const menuItems = [
    { key: "/doctor/dashboard", label: <Link to="/doctor/dashboard">Home</Link> },
    { key: "/doctor/appointments", label: <Link to="/doctor/appointments">Appointments</Link> },
    { key: "/doctor/request", label: <Link to="/doctor/request">Booking</Link> },
    { key: "/doctor/notification", label: <Link to="/doctor/notification">Notification</Link> },
  ];

  return (
    <Header className="header-doctor">
      {/* Logo bên trái */}
      <div className="logo-container">
        <Link to="/doctor/dashboard">
          <img src={logoMedi} alt="MediBook" />
        </Link>
      </div>

      {/* Menu ở giữa */}
      <Menu
        mode="horizontal"
        selectedKeys={[location.pathname]}
        items={menuItems}
        className="header-menu"
      />

      {/* User Profile bên phải - Thêm onClick để điều hướng */}
      <div 
        className="user-profile-wrapper" 
        onClick={() => navigate("/doctor/profile")}
        style={{ cursor: "pointer" }} // Thêm con trỏ tay để người dùng biết có thể click
      >
        <Space size={10} align="center">
          <Avatar
            style={{ backgroundColor: "#4cc9b0" }}
            icon={<UserOutlined />}
            size={38}
          />

          <div className="user-info-text">
            <Text strong className="user-name">
              Dr. {fullName}
            </Text>
            <br /> {/* Đảm bảo role nằm dưới tên */}
            <Text className="user-role">Doctor Account</Text>
          </div>
        </Space>
      </div>
    </Header>
  );
};

export default HeaderDoctor;-e \n[END OF FILE]\n
frontend/src/layouts/PatientLayout.tsx
------------------------------------------
import { Outlet } from 'react-router-dom';
import PatientHeader from '../components/PatientHeader';

const PatientLayout = () => {
  return (
    <div className="patient-app-layout">
      <PatientHeader />
      <main className="patient-content">
        <Outlet /> {/* Đây là nơi nội dung các trang con sẽ hiển thị */}
      </main>
    </div>
  );
};

export default PatientLayout;-e \n[END OF FILE]\n
frontend/src/layouts/DoctorLayout.tsx
------------------------------------------
import React from 'react';
import { Layout } from 'antd';
import { Outlet } from 'react-router-dom';
import HeaderDoctor from '../components/HeaderDoctor';

const { Content } = Layout;

const DoctorLayout: React.FC = () => {
  return (
    <Layout style={{ minHeight: '100vh', backgroundColor: '#fff' }}>
      <HeaderDoctor />
      <Content style={{ padding: '0 50px', marginTop: 20 }}>
        <div style={{ background: '#fff', minHeight: '100%' }}>
          {/* Outlet sẽ render Dashboard, Appointment, v.v. tại đây */}
          <Outlet />
        </div>
      </Content>
    </Layout>
  );
};

export default DoctorLayout;-e \n[END OF FILE]\n
frontend/src/api/DoctorApi.ts
------------------------------------------
import axiosClient from './axiosClient';

export interface Doctor {
    id: string;
    userId: string;
    fullName: string;
    phone: string;
    experienceYear: number;
    description: string;
    address: string;
    patientsSeen: number;
    dateOfBirth: string;
    createdAt: string;
    department?: {
      id: string;
      name: string;
      description: string;
    };
    user?: {
      email: string;
      username: string;
    };
  }

export const doctorApi = {
  getProfile: (id: string): Promise<Doctor> => {
    return axiosClient.get(`/doctors/${id}`);
  },
};-e \n[END OF FILE]\n
frontend/src/api/authApi.ts
------------------------------------------
import axiosClient from './axiosClient';

export const authApi = {
  login: (credentials: any) => {
    return axiosClient.post('/auth/login', credentials);
  },
};-e \n[END OF FILE]\n
frontend/src/api/axiosClient.ts
------------------------------------------
import axios, { type AxiosInstance, type AxiosResponse, AxiosError } from 'axios';

// 1. Khởi tạo instance
const axiosClient: AxiosInstance = axios.create({
  baseURL: 'http://localhost:3000/api', // Thay bằng URL Backend của bạn
  headers: {
    'Content-Type': 'application/json',
  },
  timeout: 10000, // Ngắt kết nối sau 10 giây nếu server không phản hồi
});

// 2. Cấu hình Interceptor cho Request (Gửi đi)
// Tự động lấy Token từ LocalStorage và gắn vào Header
axiosClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 3. Cấu hình Interceptor cho Response (Trả về)
// Xử lý dữ liệu trả về hoặc bắt lỗi tập trung (ví dụ: Token hết hạn)
axiosClient.interceptors.response.use(
  (response: AxiosResponse) => {
    // Trả về thẳng dữ liệu (data), không cần gọi .data ở Page nữa
    return response.data;
  },
  (error: AxiosError) => {
    if (error.response?.status === 401) {
      // Ví dụ: Nếu lỗi 401 (Hết hạn Token) thì đá ra trang Login
      // localStorage.removeItem('token');
      // window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default axiosClient;-e \n[END OF FILE]\n
frontend/src/pages/Login.tsx
------------------------------------------
import { useState, type ChangeEvent, type FormEvent } from "react";
import { authApi } from "../api/authApi";
import "./Login.css";
import { useNavigate } from "react-router-dom";

import logoMedi from "../assets/logos/MediBookLogo.svg";
import doctorImg from "../assets/images/login-banner.jpg";
import userIcon from "../assets/icons/person.svg";

const Login = () => {
  const navigate = useNavigate();
  const [formData, setFormData] = useState({
    username: "",
    password: "",
  });
  const [loading, setLoading] = useState<boolean>(false);
  const [errorMsg, setErrorMsg] = useState<string | null>(null);

  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,
    });
  };

  const handleLogin = async (e: FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setErrorMsg(null);

    try {
      const data = (await authApi.login(formData)) as any;

      if (data.access_token) {
        localStorage.setItem("token", data.access_token);
      }

      if (data.user && data.user.id) {
        const userId = data.user.id;
        const role = data.user.role;

        localStorage.setItem("userId", userId);

        if (role === "doctor") {
          localStorage.setItem("doctorId", userId);
          navigate("/doctor/dashboard");
        } else if (role === "patient") {
          navigate("/patient/dashboard");
        } else {
          navigate("/");
        }
      }
    } catch (error: any) {
      console.error("Login Error:", error);
      setErrorMsg(
        error.response?.data?.message || "Invalid username or password!"
      );
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="page-wrapper">
      <div className="login-card">
        {/* Left Side: Form */}
        <div className="login-left">
          <div className="content-box">
            <img src={logoMedi} alt="MediBook Logo" className="logo" />

            <div className="welcome-text">
              <h1>Welcome back 👋</h1>
              <p>Please enter your details to login</p>
            </div>

            {errorMsg && (
              <div
                className="error-alert"
                style={{ color: "#ff4d4f", marginBottom: "10px" }}
              >
                {errorMsg}
              </div>
            )}

            <form onSubmit={handleLogin}>
              <div className="input-group">
                <label>Username</label>
                <div className="input-field">
                  <img src={userIcon} alt="user" />
                  <input
                    type="text"
                    name="username"
                    placeholder="Enter your username"
                    value={formData.username}
                    onChange={handleChange}
                    required
                  />
                </div>
              </div>

              <div className="input-group">
                <label>Password</label>
                <div className="input-field">
                  <input
                    type="password"
                    name="password"
                    placeholder="**********"
                    value={formData.password}
                    onChange={handleChange}
                    required
                  />
                </div>
              </div>

              <button type="submit" className="btn-login" disabled={loading}>
                {loading ? "Processing..." : "Login"}
              </button>

              <div className="divider">Or</div>

              <button
                type="button"
                className="btn-signup"
                onClick={() => navigate("/register")} // Link này phải khớp với path trong App.tsx
              >
                Sign up
              </button>
            </form>
          </div>
        </div>

        {/* Right Side: Banner Image */}
        <div className="login-right">
          <img src={doctorImg} alt="Doctors" className="banner-img" />
        </div>
      </div>
    </div>
  );
};

export default Login;
-e \n[END OF FILE]\n
frontend/src/pages/doctor/Dashboard.tsx
------------------------------------------
import React, { useEffect, useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom"; // 1. Import useNavigate
import "./Dashboard.css";

// Import icons
import heartIcon from "../../assets/icons/heart_doctor.svg";
import kitIcon from "../../assets/icons/first_aid_kit_doctor.svg";
import breatheIcon from "../../assets/icons/breathe_doctor.svg";
import appointIcon from "../../assets/icons/appointment_doctor.svg";
import oclockIcon from "../../assets/icons/oclock_doctor.svg";

const DoctorDashboard: React.FC = () => {
  const [doctor, setDoctor] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const navigate = useNavigate(); // 2. Khởi tạo hàm navigate

  useEffect(() => {
    const fetchDoctorData = async () => {
      try {
        setLoading(true);
        const doctorId = localStorage.getItem("doctorId");
        const token = localStorage.getItem("token");
        if (doctorId) {
          const response = await axios.get(`http://localhost:3000/api/doctors/${doctorId}`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          setDoctor(response.data);
        }
      } catch (err) {
        console.error("Lỗi fetch dữ liệu:", err);
      } finally {
        setLoading(false);
      }
    };
    fetchDoctorData();
  }, []);

  if (loading) return <div className="loading-screen">Đang tải dữ liệu...</div>;

  const displayDoctor = {
    full_name: doctor?.full_name || doctor?.fullName || "No Find",
    department: doctor?.department?.name_department || "KHOA NỘI TỔNG QUÁT",
    description: doctor?.description || "CHUYÊN GIA PHẪU THUẬT CHỈNH HÌNH VỚI 10 NĂM KINH NGHIỆM",
    phone: doctor?.phone || "0977-958-514",
    avatar: doctor?.user?.avatar || "doctor_7.jpg",
  };

  return (
    <div className="dashboard-wrapper">
      <div className="main-portal-card">
        {/* TOP SECTION */}
        <div className="upper-layout">
          <div className="text-header">
            <h1 className="welcome-heading">
              Welcome <span className="highlight-green">Dr. {displayDoctor.full_name}</span> 👋
            </h1>
            <h2 className="dept-heading">{displayDoctor.department}</h2>
            <p className="desc-subtext">{displayDoctor.description}</p>

            <div className="status-icons">
              {[heartIcon, kitIcon, breatheIcon].map((icon, i) => (
                <div key={i} className="icon-circle-box">
                  <img src={icon} alt="status-icon" />
                </div>
              ))}
            </div>
          </div>

          <div className="avatar-portal">
            <div className="avatar-skew-shadow"></div>
            <img
              src={`http://localhost:3000/avatar/${displayDoctor.avatar}`}
              alt="Doctor Profile"
              className="portal-img"
              onError={(e) => (e.currentTarget.src = "https://via.placeholder.com/600x800?text=No+Image")}
            />
          </div>
        </div>

        {/* STATS SECTION */}
        <div className="stats-row-container">
          <div className="stat-rect side-rect">
            <span className="phone-display">{displayDoctor.phone}</span>
            <h3 className="rect-title">EMERGENCY SERVICE</h3>
            <p className="rect-p">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
            <button className="rect-btn">See More</button>
          </div>

          <div className="stat-rect center-rect center-tall">
            <img src={appointIcon} className="rect-icon" alt="apt" />
            <h3 className="rect-title">YOU HAVE 34 APPOINTMENT TODAY</h3>
            <p className="rect-p">Duis aute irure dolor in reprehenderit in voluptate.</p>
            {/* 3. Thêm sự kiện onClick để chuyển trang */}
            <button 
              className="rect-btn" 
              onClick={() => navigate("/doctor/appointments")}
            >
              Get examined
            </button>
          </div>

          <div className="stat-rect side-rect">
            <img src={oclockIcon} className="rect-icon" alt="time" />
            <h3 className="rect-title">OPENING HOURS</h3>
            <p className="rect-p">Monday - Friday<br />07:00 AM - 17:30 PM</p>
            <button className="rect-btn">See More</button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default DoctorDashboard;-e \n[END OF FILE]\n
frontend/src/pages/doctor/MedicalExamModal.tsx
------------------------------------------
import React, { useState, useEffect, useMemo } from "react";
import axios from "axios";
import {
  X,
  Plus,
  Trash2,
  Pill,
  CheckCircle,
  Download,
  User,
  Search,
} from "lucide-react";
import "./MedicalExam.css";

interface Props {
  appointment: any;
  onClose: (isUpdated?: boolean) => void;
}

const MedicalExamModal: React.FC<Props> = ({ appointment, onClose }) => {
  const [medicines, setMedicines] = useState<any[]>([]);
  const [showMedList, setShowMedList] = useState(false);
  const [medSearchTerm, setMedSearchTerm] = useState("");

  const [record, setRecord] = useState({
    diagnosis: "",
    conclusion: "",
  });

  const [prescriptionList, setPrescriptionList] = useState<any[]>([]);

  useEffect(() => {
    const fetchMedicines = async () => {
      try {
        const token = localStorage.getItem("token");
        const res = await axios.get("http://localhost:3000/api/medicines", {
          headers: { Authorization: `Bearer ${token}` },
        });
        setMedicines(res.data);
      } catch (error) {
        console.error("Không thể lấy danh sách thuốc", error);
      }
    };
    fetchMedicines();
  }, []);

  const filteredMedicines = useMemo(() => {
    return medicines.filter(
      (m) =>
        m.name.toLowerCase().includes(medSearchTerm.toLowerCase()) ||
        m.strength.toLowerCase().includes(medSearchTerm.toLowerCase())
    );
  }, [medicines, medSearchTerm]);

  const addMedicine = (med: any) => {
    console.log("Thuốc được chọn:", med);
    const actualId = med.id || med.medicine_id || med.medicineId;

    if (!actualId) {
      alert("Lỗi: Thuốc này không có ID hợp lệ!");
      return;
    }

    const exists = prescriptionList.find((p) => p.medicineId === med.id);
    if (exists) return;

    setPrescriptionList([
      ...prescriptionList,
      {
        medicine_id: actualId,
        name: med.name,
        concentration: med.concentration || "", // Lưu trữ concentration/strength
        dosage: "",
        usage: "",
      },
    ]);
    setShowMedList(false);
    setMedSearchTerm("");
  };

  const removeMedicineRow = (index: number) => {
    const newList = [...prescriptionList];
    newList.splice(index, 1);
    setPrescriptionList(newList);
  };

  const handleComplete = async () => {
    try {
      const token = localStorage.getItem("token");
      const config = { headers: { Authorization: `Bearer ${token}` } };

      // BƯỚC 1: Tạo Medical Record
      const recordPayload = {
        appointment_id: Number(appointment.id),
        diagnosis: record.diagnosis,
        conclusion: record.conclusion,
        symptoms: appointment.symptoms || "Khám bệnh định kỳ",
      };

      const resRecord = await axios.post(
        "http://localhost:3000/api/medical-records",
        recordPayload,
        config
      );
      const newRecordId = resRecord.data.id;

      // BƯỚC 2: Tạo Prescriptions
      if (newRecordId && prescriptionList.length > 0) {
        const prescriptionPromises = prescriptionList.map((p) => {
          // PAYLOAD PHẢI KHỚP CHÍNH XÁC VỚI CreatePrescriptionDto
          const payload = {
            medical_record_id: String(newRecordId), // Phải là snake_case
            medicine_id: String(p.medicine_id), // Phải là snake_case
            medicine_name: p.concentration
              ? `${p.name} ${p.concentration}`
              : p.name,
            dosage: String(p.dosage || "1 đơn vị"),
            usage: String(p.usage || "Uống theo chỉ định"),
          };

          console.log("Gửi đơn thuốc tới API:", payload);
          return axios.post(
            "http://localhost:3000/api/prescriptions",
            payload,
            config
          );
        });

        await Promise.all(prescriptionPromises);
      }

      alert("Hoàn thành và lưu đơn thuốc thành công!");
      onClose(true);
    } catch (error: any) {
      console.error("Lỗi Network:", error.response?.data || error.message);
      const serverMsg = error.response?.data?.message;
      // Hiển thị lỗi chi tiết từ ValidationPipe để bác sĩ biết trường nào sai
      alert(
        "Lỗi: " +
          (Array.isArray(serverMsg)
            ? serverMsg.join(", ")
            : serverMsg || "Không thể lưu đơn thuốc")
      );
    }
  };

  return (
    <div className="exam-overlay">
      <div className="exam-card">
        <div className="exam-header">
          <h2 className="main-title">Medical Examination</h2>
          <button className="btn-close-transparent" onClick={() => onClose()}>
            <X size={24} />
          </button>
        </div>

        <div className="exam-body">
          {/* PATIENT INFO SECTION */}
          <div className="patient-summary-card">
            <div className="p-main-info">
              <div className="p-avatar-large">
                {appointment.patient?.user?.avatar ? (
                  <img
                    src={`http://localhost:3000${appointment.patient.user.avatar}`}
                    alt="avatar"
                  />
                ) : (
                  <User size={32} color="#28BF96" />
                )}
              </div>
              <div className="p-details">
                <h3>{appointment.patient?.fullName}</h3>
                <div className="p-grid-info">
                  <span>
                    <strong>Gender:</strong> {appointment.patient?.gender}
                  </span>
                  <span>
                    <strong>DOB:</strong>{" "}
                    {appointment.patient?.dateOfBirth || "N/A"}
                  </span>
                  <span>
                    <strong>Age:</strong> {appointment.patient?.age || "20"}{" "}
                    Years
                  </span>
                  <span>
                    <strong>Phone:</strong>{" "}
                    {appointment.patient?.phone || "N/A"}
                  </span>
                  <span>
                    <strong>Insurance:</strong>{" "}
                    {appointment.patient?.healthInsuranceNumber || "N/A"}
                  </span>
                  <span className="full-width">
                    <strong>Address:</strong>{" "}
                    {appointment.patient?.address || "N/A"}
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* DIAGNOSIS SECTION */}
          <div className="exam-section">
            <div className="section-title">
              <CheckCircle size={18} /> Diagnosis & Conclusion
            </div>
            <div className="diagnosis-grid">
              <textarea
                className="exam-textarea small"
                value={record.diagnosis}
                onChange={(e) =>
                  setRecord({ ...record, diagnosis: e.target.value })
                }
                placeholder="Enter diagnosis..."
              />
              <textarea
                className="exam-textarea small"
                value={record.conclusion}
                onChange={(e) =>
                  setRecord({ ...record, conclusion: e.target.value })
                }
                placeholder="Final conclusion/advice..."
              />
            </div>
          </div>

          <div className="prescription-section">
            <div className="prescription-header">
              <div className="section-title">
                <Pill size={18} /> Prescription
              </div>
              <div className="med-search-container">
                <button
                  className="btn-add-med"
                  onClick={() => setShowMedList(!showMedList)}
                >
                  <Plus size={16} /> Add Medicine
                </button>

                {showMedList && (
                  <div className="med-dropdown-card">
                    <div className="med-search-box">
                      <Search size={14} />
                      <input
                        type="text"
                        placeholder="Search medicine name..."
                        autoFocus
                        value={medSearchTerm}
                        onChange={(e) => setMedSearchTerm(e.target.value)}
                      />
                    </div>
                    <div className="med-list-items">
                      {filteredMedicines.map((m) => (
                        <div
                          key={m.id}
                          className="med-item"
                          onClick={() => addMedicine(m)}
                        >
                          {m.name} - <small>{m.concentration}</small>
                        </div>
                      ))}
                      {filteredMedicines.length === 0 && (
                        <div className="med-no-result">No medicines found</div>
                      )}
                    </div>
                  </div>
                )}
              </div>
            </div>

            <table className="med-table">
              <thead>
                <tr>
                  <th>Medicine Name</th>
                  <th>Dosage</th>
                  <th>Usage</th>
                  <th style={{ textAlign: "right" }}>Action</th>
                </tr>
              </thead>
              <tbody>
                {prescriptionList.map((item, index) => (
                  <tr key={index}>
                    <td>
                      <div className="med-name-cell">
                        {/* CHỈNH SỬA: Hiển thị Tên thuốc - Nồng độ */}
                        <strong>
                          {item.name} - {item.concentration}
                        </strong>
                      </div>
                    </td>
                    <td>
                      <input
                        className="table-input"
                        value={item.dosage}
                        onChange={(e) => {
                          const newList = [...prescriptionList];
                          newList[index].dosage = e.target.value;
                          setPrescriptionList(newList);
                        }}
                        placeholder="e.g. 10 pills"
                      />
                    </td>
                    <td>
                      <input
                        className="table-input"
                        value={item.usage}
                        onChange={(e) => {
                          const newList = [...prescriptionList];
                          newList[index].usage = e.target.value;
                          setPrescriptionList(newList);
                        }}
                        placeholder="e.g. 2 times/day"
                      />
                    </td>
                    <td style={{ textAlign: "right" }}>
                      <button
                        className="btn-icon-delete"
                        onClick={() => removeMedicineRow(index)}
                      >
                        <Trash2 size={16} />
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>

        <div className="exam-footer">
          <button className="btn-export" type="button">
            <Download size={18} /> Export PDF
          </button>
          <div className="right-btns">
            <button
              className="btn-cancel-exam"
              type="button"
              onClick={() => onClose(false)}
            >
              Cancel
            </button>
            <button
              className="btn-complete-exam"
              type="button"
              onClick={handleComplete}
            >
              <CheckCircle size={18} /> Complete Examination
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default MedicalExamModal;
-e \n[END OF FILE]\n
frontend/src/pages/doctor/Dashboard.css
------------------------------------------
/* Layout chính */
.dashboard-wrapper {
    background-color: #f0f4f3;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 60px 20px;
  }
  
  .main-portal-card {
    background-color: #ffffff;
    border-radius: 60px;
    width: 100%;
    max-width: 1300px;
    padding: 80px 100px 120px 100px; /* Padding dưới lớn để bù trừ ô giữa */
    box-shadow: 0 40px 100px rgba(0,0,0,0.05);
    position: relative;
  }
  
  /* Typography */
  .upper-layout {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
  }
  
  .welcome-heading {
    font-size: 58px;
    font-weight: 800; /* Đậm */
    margin-top: 30px;
    letter-spacing: -1px;
  }
  
  .highlight-green {
    color: #28BF96;
  }
  
  .dept-heading {
    font-size: 50px; /* To gần bằng Welcome */
    font-weight: 900;
    margin: 5px 0 20px 0;
    text-transform: uppercase;
    color: #1a1a1a;
  }
  
  .desc-subtext {
    font-size: 18px;
    color: #b5b5b5; /* Nhạt */
    font-weight: 400; /* Mảnh */
    text-transform: uppercase;
    letter-spacing: 1px;
    max-width: 500px;
  }
  
  /* Icons màu 37D3A9 */
  .status-icons {
    display: flex;
    gap: 15px;
    margin-top: 40px;
  }
  
  .icon-circle-box {
    width: 65px;
    height: 65px;
    background-color: #37D3A9;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .icon-circle-box img {
    width: 30px;
    filter: brightness(0) invert(1);
  }
  
  /* Avatar to và bóng nghiêng */
  .avatar-portal {
    position: relative;
    margin-top: -20px;
  }
  
  .portal-img {
    width: 480px;
    height: 600px;
    object-fit: cover;
    border-radius: 50px;
    position: relative;
    z-index: 5;
    box-shadow: 0 20px 50px rgba(0,0,0,0.1);
  }
  
  .avatar-skew-shadow {
    position: absolute;
    width: 115%;
    height: 100%;
    background-color: #e8f7f4;
    border-radius: 60px;
    transform: rotate(-5deg); /* Nghiêng bóng */
    top: -30px;
    left: -30px;
    z-index: 1;
  }
  
  /* Stats Row: SÁT NHAU */
  .stats-row-container {
    display: flex;
    align-items: stretch; /* Để các ô side cao bằng nhau */
    margin-top: -120px; /* Đè lên ảnh */
    position: relative;
    z-index: 10;
  }
  
  .stat-rect {
    flex: 1;
    padding: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    color: #064e3b;
  }
  
  /* Màu 2 bên 74DDC1 */
  .side-rect {
    background-color: #74DDC1;
    min-height: 280px;
  }
  
  .stat-rect:first-child { border-radius: 40px 0 0 40px; }
  .stat-rect:last-child { border-radius: 0 40px 40px 0; }
  
  /* Màu giữa 91EBD2 */
  .center-rect {
    background-color: #91EBD2;
    box-shadow: 0 0 40px rgba(0,0,0,0.08);
  }
  
  /* Ô giữa kéo dài cả trên cả dưới */
  .center-tall {
    min-height: 420px; /* Cao vượt trội */
    transform: translateY(-40px); /* Nhô lên trên */
    margin-bottom: -80px; /* Kéo xuống dưới */
    border-radius: 40px;
    z-index: 11;
  }
  
  .phone-display { font-size: 24px; font-weight: 900; }
  .rect-title { font-size: 22px; font-weight: 800; margin: 15px 0; line-height: 1.2; }
  .rect-p { font-size: 15px; opacity: 0.7; }
  .rect-icon { width: 50px; margin-bottom: 20px; }
  
  .rect-btn {
    background: #ffffff;
    border: none;
    padding: 12px 35px;
    border-radius: 20px;
    font-weight: 800;
    width: fit-content;
    margin-top: 30px;
    cursor: pointer;
    color: #28BF96;
    transition: 0.3s;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
  }
  
  .rect-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  .rect-btn:active {
    transform: scale(0.95);
  }-e \n[END OF FILE]\n
frontend/src/pages/doctor/MedicalRecorđetailModal.tsx
------------------------------------------
import React, { useEffect, useState } from "react";
import axios from "axios";
import {
  X,
  Pill,
  Download,
  User,
  FileText,
  Calendar as CalendarIcon,
} from "lucide-react";
import "./MedicalExam.css";

interface Props {
  appointment: any;
  onClose: () => void;
}

const MedicalRecordDetailModal: React.FC<Props> = ({
  appointment,
  onClose,
}) => {
  const [record, setRecord] = useState<any>(null);
  const [prescriptions, setPrescriptions] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchFullData = async () => {
      try {
        setLoading(true);
        const token = localStorage.getItem("token");
        const config = { headers: { Authorization: `Bearer ${token}` } };

        // 1. Lấy tất cả bệnh án
        const resRecords = await axios.get(
          `http://localhost:3000/api/medical-records`,
          config
        );

        // 2. Tìm bệnh án của cuộc hẹn này (Lưu ý: Backend dùng appointment_id hoặc appointmentId tùy version)
        const foundRecord = resRecords.data.find(
          (r: any) =>
            Number(r.appointmentId) === Number(appointment.id) ||
            Number(r.appointment_id) === Number(appointment.id)
        );

        if (foundRecord) {
          setRecord(foundRecord);

          // 3. Gọi API lấy đơn thuốc riêng theo recordId
          // Dùng endpoint: /api/prescriptions/record/:recordId
          const resPrescriptions = await axios.get(
            `http://localhost:3000/api/prescriptions/record/${foundRecord.id}`,
            config
          );
          setPrescriptions(resPrescriptions.data);
        }
      } catch (error) {
        console.error("Lỗi khi lấy chi tiết bệnh án:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchFullData();
  }, [appointment.id]);

  if (loading)
    return (
      <div className="exam-overlay">
        <div
          className="exam-card"
          style={{ justifyContent: "center", alignItems: "center" }}
        >
          Đang tải dữ liệu...
        </div>
      </div>
    );

  return (
    <div className="exam-overlay">
      <div className="exam-card">
        <header className="exam-header">
          <div className="header-left">
            <h2 className="main-title">Chi tiết bệnh án</h2>
            <p className="sub-info">
              Bệnh nhân: {appointment.patient?.fullName} | ID: #
              {appointment.patientId}
            </p>
          </div>
          {/* Nút Close phải nằm trong header và dùng đúng class */}
          <button className="btn-close" onClick={onClose} type="button">
            <X size={24} />
          </button>
        </header>

        <div className="exam-body">
          <div className="exam-section">
            <h3>
              <FileText size={18} /> Kết quả chẩn đoán
            </h3>
            <div className="input-group">
              <label>Chẩn đoán bệnh</label>
              <div className="readonly-box">{record?.diagnosis || "N/A"}</div>
            </div>
            <div className="input-group">
              <label>Kết luận & Lời khuyên</label>
              <div className="readonly-box">
                {record?.conclusion || "Chưa có kết luận"}
              </div>
            </div>
          </div>

          <div className="exam-section">
            <h3>
              <Pill size={18} /> Đơn thuốc đã kê
            </h3>
            <table className="med-table">
              <thead>
                <tr>
                  <th>Tên thuốc</th>
                  <th>Số lượng</th>
                  <th>Cách dùng</th>
                </tr>
              </thead>
              <tbody>
                {prescriptions.length > 0 ? (
                  prescriptions.map((item, index) => (
                    <tr key={index}>
                      <td style={{ fontWeight: 700, color: "#28BF96" }}>
                        {item.medicine_name}
                        {item.medicine?.concentration
                          ? ` (${item.medicine.concentration})`
                          : ""}
                      </td>
                      <td>{item.dosage}</td>
                      <td>{item.usage}</td>
                    </tr>
                  ))
                ) : (
                  <tr>
                    <td colSpan={3} className="med-no-result">
                      Không có thuốc trong đơn.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
        </div>

        <div className="exam-footer">
          <button className="btn-export">
            <Download size={18} /> Xuất PDF
          </button>
          <button className="btn-cancel-exam" onClick={onClose}>
            Đóng
          </button>
        </div>
      </div>
    </div>
  );
};

export default MedicalRecordDetailModal;
-e \n[END OF FILE]\n
frontend/src/pages/doctor/Notifications.tsx
------------------------------------------
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import { Search, MoreHorizontal } from "lucide-react";
import "./Notifications.css";

import newRequestIcon from "../../assets/icons/new_request.svg";
import cancelledRequestIcon from "../../assets/icons/cancelled_request.svg";

const Notifications: React.FC = () => {
  const [notifications, setNotifications] = useState<any[]>([]);
  const [doctor, setDoctor] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [activeTab, setActiveTab] = useState("All");
  const [searchTerm, setSearchTerm] = useState("");

  const API_URL = "http://localhost:3000";

  const fetchData = async () => {
    try {
      const doctorId = localStorage.getItem("doctorId");
      const token = localStorage.getItem("token");
      const headers = { Authorization: `Bearer ${token}` };

      if (!doctorId) return;

      const [resNotifs, resDoctor] = await Promise.all([
        axios.get(`${API_URL}/api/notifications/user/${doctorId}`, { headers }),
        axios.get(`${API_URL}/api/doctors/${doctorId}`, { headers }),
      ]);

      setNotifications(resNotifs.data || []);
      setDoctor(resDoctor.data);
    } catch (error) {
      console.error("Error fetching notifications:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  // CHỨC NĂNG ĐÁNH DẤU TẤT CẢ ĐÃ ĐỌC (Dùng PATCH)
  const handleMarkAllAsRead = async () => {
    const unreadNotifs = notifications.filter((n) => !n.isRead);
    if (unreadNotifs.length === 0) return;

    const token = localStorage.getItem("token");
    const headers = { Authorization: `Bearer ${token}` };

    // Optimistic UI: Cập nhật giao diện trước để người dùng thấy thay đổi ngay
    const originalNotifs = [...notifications];
    setNotifications((prev) => prev.map((n) => ({ ...n, isRead: true })));

    try {
      // Gọi API PATCH đồng thời cho tất cả các ID chưa đọc
      await Promise.all(
        unreadNotifs.map((n) =>
          axios.patch(`${API_URL}/api/notifications/${n.id}/read`, {}, { headers })
        )
      );
      console.log("Đã cập nhật tất cả thông báo qua PATCH");
    } catch (error) {
      console.error("Lỗi khi PATCH thông báo:", error);
      // Rollback nếu có lỗi xảy ra
      setNotifications(originalNotifs);
      alert("Không thể cập nhật trạng thái thông báo.");
    }
  };

  const filteredNotifs = useMemo(() => {
    let list = notifications;
    if (activeTab === "Unread") list = list.filter((n) => !n.isRead);
    if (searchTerm.trim() !== "") {
      list = list.filter((n) =>
        n.content?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        n.title?.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    return list;
  }, [notifications, activeTab, searchTerm]);

  if (loading) return <div className="loading-state">Đang tải thông báo...</div>;

  return (
    <div className="notif-container">
      <header className="notif-header">
        <div>
          <h1>Thông báo của BS. <span className="highlight-green">{doctor?.fullName || "Bác sĩ"}</span></h1>
          <p>Bạn có {notifications.filter(n => !n.isRead).length} thông báo chưa đọc</p>
        </div>
        <button className="btn-mark-all" onClick={handleMarkAllAsRead}>
          Đánh dấu tất cả đã đọc
        </button>
      </header>

      <div className="notif-card">
        <div className="notif-toolbar">
          <div className="notif-tabs">
            {["All", "Unread"].map((tab) => (
              <button
                key={tab}
                className={`tab-item ${activeTab === tab ? "active" : ""}`}
                onClick={() => setActiveTab(tab)}
              >
                {tab === "All" ? "Tất cả" : "Chưa đọc"}
              </button>
            ))}
          </div>
        </div>

        {/* List với Padding và Gap để không bị dính cạnh */}
        <div className="notif-list" style={{ padding: '10px 24px 24px 24px', display: 'flex', flexDirection: 'column', gap: '12px' }}>
          {filteredNotifs.length > 0 ? (
            filteredNotifs.map((n) => {
              const isCancelled = n.content?.toLowerCase().includes("huỷ") || n.type === "cancel";
              const isUnread = !n.isRead;

              return (
                <div key={n.id} className={`notif-row ${isUnread ? "unread-row" : ""}`}>
                  <div className="notif-left">
                    <div className={`notif-icon-box ${isCancelled ? "bg-rose-light" : "bg-mint-light"}`}>
                      <img src={isCancelled ? cancelledRequestIcon : newRequestIcon} alt="icon" className="notif-svg-icon" />
                    </div>
                    <div className="notif-content">
                      <h4 className="notif-title" style={{ fontWeight: 'bold', display: 'flex', alignItems: 'center', margin: 0, gap: '8px' }}>
                        {n.title}
                        {isUnread && (
                          <span className={`unread-dot ${isCancelled ? "dot-red" : "dot-mint"}`}></span>
                        )}
                      </h4>
                      <p className="notif-msg" style={{ margin: '4px 0' }}>{n.content}</p>
                      {n.patientName && <span className="patient-tag">Bệnh nhân: {n.patientName}</span>}
                    </div>
                  </div>

                  <div className="notif-right">
                    <span className="notif-time">
                      {new Date(n.createdAt).toLocaleString("vi-VN", {
                        hour: "2-digit",
                        minute: "2-digit",
                        day: "2-digit",
                        month: "2-digit",
                      })}
                    </span>
                  </div>
                </div>
              );
            })
          ) : (
            <div className="no-notif-box">Không có thông báo nào.</div>
          )}
        </div>
      </div>
    </div>
  );
};

export default Notifications;-e \n[END OF FILE]\n
frontend/src/pages/doctor/Appointments.css
------------------------------------------
@import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap");

/* --- BIẾN MÀU SẮC TỐI ƯU --- */
:root {
  --primary-color: #28bf96;
  --cal-grad-start: #c6f2e6;
  --cal-grad-end: #53ccab;
  --text-dark: #1e293b;
  --text-muted: #94a3b8;
}

.appt-container {
  padding: 40px;
  background-color: #fcfdfd;
  min-height: 100vh;
  font-family: "Plus Jakarta Sans", sans-serif;
}

/* --- HEADER & STATS --- */
.appt-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
}

.welcome-box .welcome-title {
  font-size: 32px;
  font-weight: 800;
  color: var(--text-dark);
  margin: 0;
}

.welcome-box .doctor-highlight {
  color: var(--primary-color);
}

.stats-gradient-box {
  display: flex;
  gap: 25px;
  padding: 15px 30px;
  background: linear-gradient(
    135deg,
    var(--cal-grad-start) 0%,
    var(--cal-grad-end) 100%
  );
  border-radius: 20px;
  align-items: center;
  border: 2px solid var(--primary-color);
  box-shadow: 0 8px 24px rgba(40, 191, 150, 0.12);
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.stat-value {
  font-size: 22px;
  font-weight: 800;
  color: #ffffff;
}
.stat-value small {
  font-size: 12px;
  color: var(--primary-color);
  margin-left: 2px;
}
.stat-label {
  font-size: 10px;
  color: var(--text-muted);
  font-weight: 700;
  text-transform: uppercase;
  margin-top: 4px;
}
.stat-divider {
  width: 1px;
  height: 35px;
  background: #f1f5f9;
}

/* --- CONTENT --- */
.appt-content {
  display: flex;
  gap: 40px;
  align-items: flex-start;
}
.calendar-sidebar {
  flex: 0 0 420px;
}

.gradient-theme-calendar {
  background: linear-gradient(
    135deg,
    var(--cal-grad-start) 0%,
    var(--cal-grad-end) 100%
  );
  padding: 30px;
  border-radius: 28px;
  border: 2px solid var(--primary-color);
  box-shadow: 0 15px 30px rgba(83, 204, 171, 0.2);
}

/* --- CALENDAR UI --- */
.custom-calendar-ui.react-calendar {
  width: 100%;
  background: transparent;
  border: none;
  color: white;
}

.custom-calendar-ui .react-calendar__navigation button {
  color: white;
  font-weight: 700;
  font-size: 18px;
}

.custom-calendar-ui .react-calendar__month-view__weekdays__weekday {
  color: white;
  font-weight: 700;
  text-decoration: none;
  opacity: 0.9;
}

.custom-calendar-ui .react-calendar__tile {
  color: white;
  padding: 18px 10px;
  font-weight: 600;
  font-size: 15px;
}

.custom-calendar-ui .react-calendar__tile--active {
  background: white !important;
  color: var(--cal-grad-end) !important;
  border-radius: 12px;
  font-weight: 800;
}

.custom-calendar-ui .react-calendar__tile--now {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
}

/* --- TABLE SECTION --- */
.table-section {
  flex: 1;
}
.table-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.search-box {
  display: flex;
  align-items: center;
  gap: 10px;
  background: white;
  padding: 10px 20px;
  border-radius: 12px;
  border: 1px solid #f1f5f9;
}

.search-box input {
  border: none;
  outline: none;
  font-size: 14px;
  width: 200px;
}

.appt-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 12px;
}

.appt-table th {
  text-align: left;
  padding: 0 20px;
  color: var(--text-muted);
  font-size: 12px;
  text-transform: uppercase;
}

.appt-table td {
  background: white;
  padding: 16px 20px;
  transition: transform 0.2s;
}

.appt-table tr:hover td {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.02);
}

.appt-table td:first-child {
  border-radius: 16px 0 0 16px;
}
.appt-table td:last-child {
  border-radius: 0 16px 16px 0;
}

/* PATIENT INFO */
.p-cell {
  display: flex;
  align-items: center;
  gap: 15px;
}
.p-avatar {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: #e6f9f4;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.patient-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.p-name {
  font-weight: 700;
  color: var(--text-dark);
  margin: 0;
}
.p-info {
  font-size: 12px;
  color: var(--text-muted);
  margin: 0;
}
.p-time {
  font-weight: 600;
  color: var(--text-dark);
}

/* STATUS PILLS THEO THIẾT KẾ */
.status-pill {
  padding: 6px 14px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 800;
  text-transform: capitalize;
}

.status-pill.completed {
  background: #d5fbf1;
  color: #11ad84;
}
.status-pill.waiting {
  background: #ffedcf;
  color: #fd8a6b;
}
.status-pill.cancelled {
  background: #ffdede;
  color: #f96840;
}

/* BUTTONS */
.p-actions {
  display: flex;
  gap: 10px;
}

.btn-exam {
  background: var(--primary-color);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
}

.btn-details {
  background: #f8fafc;
  color: #64748b;
  border: 1px solid #e2e8f0;
  padding: 8px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
}

@import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap");

.appt-container {
  padding: 40px;
  background-color: #fcfdfd;
  min-height: 100vh;
  font-family: "Plus Jakarta Sans", sans-serif;
}

/* --- STATS GRADIENT BOX --- */
.stats-gradient-box {
  display: flex;
  gap: 15px;
  padding: 10px;
  background: white;
  border-radius: 20px;
}

.stat-pill-box {
  padding: 12px 20px;
  border-radius: 16px;
  display: flex;
  flex-direction: column;
  min-width: 110px;
}

.stat-pill-box .stat-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  margin-bottom: 4px;
}
.stat-pill-box .stat-value {
  font-size: 18px;
  font-weight: 800;
}
.stat-pill-box .stat-value small {
  font-size: 11px;
  margin-left: 2px;
  opacity: 0.8;
}

/* Colors for Stats Box (Khớp yêu cầu) */
.st-waiting {
  background: #ffedcf;
  color: #fd8a6b;
}
.st-completed {
  background: #d5fbf1;
  color: #11ad84;
}
.st-cancelled {
  background: #ffdede;
  color: #f96840;
}
.st-pending {
  background: #e1f0ff;
  color: #0052cc;
} /* Pending: Chữ 0052CC, nền E1F0FF */

/* --- LAYOUT CARD CHO DANH SÁCH --- */
.table-section-card {
  flex: 1;
  background: white;
  border-radius: 24px;
  padding: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
  border: 1px solid #f1f5f9;
}

.table-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
.table-controls h2 {
  font-size: 20px;
  font-weight: 800;
  color: #1e293b;
  margin: 0;
}

.search-box {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #f8fafc;
  padding: 10px 15px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
}
.search-box input {
  background: transparent;
  border: none;
  outline: none;
  font-size: 14px;
  width: 180px;
}

/* TABLE STYLES (Chỉnh lại cho hợp với Card) */
.appt-table {
  width: 100%;
  border-collapse: collapse;
}
.appt-table th {
  text-align: left;
  padding: 15px 20px;
  color: #94a3b8;
  font-size: 12px;
  text-transform: uppercase;
  border-bottom: 1px solid #f1f5f9;
}
.appt-table td {
  padding: 15px 20px;
  border-bottom: 1px solid #f8fafc;
}
.appt-table tr:last-child td {
  border-bottom: none;
}

.p-avatar {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: #e6f9f4;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.patient-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.p-name {
  font-weight: 700;
  color: #1e293b;
  margin: 0;
  font-size: 14px;
}
.p-info {
  font-size: 12px;
  color: #94a3b8;
  margin: 0;
}

/* STATUS PILLS TRONG BẢNG */
.status-pill {
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 700;
  text-transform: capitalize;
}
.status-pill.completed {
  background: #d5fbf1;
  color: #11ad84;
}
.status-pill.waiting {
  background: #ffedcf;
  color: #fd8a6b;
}
.status-pill.cancelled {
  background: #ffdede;
  color: #f96840;
}
.status-pill.pending {
  background: #e1f0ff;
  color: #0052cc;
}

/* CALENDAR & HEADER REMAINS */
.calendar-sidebar {
  flex: 0 0 420px;
}
.gradient-theme-calendar {
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  padding: 30px;
  border-radius: 28px;
  border: 2px solid #28bf96;
  box-shadow: 0 15px 30px rgba(83, 204, 171, 0.2);
}
.custom-calendar-ui.react-calendar {
  width: 100%;
  border: none;
  background: transparent;
  color: white;
}
.custom-calendar-ui .react-calendar__tile--active {
  background: white !important;
  color: #53ccab !important;
  border-radius: 12px;
}

.btn-exam {
  background: #28bf96;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s;
}
.btn-exam:hover {
  background: #11ad84;
}
.btn-details {
  background: transparent;
  color: #64748b;
  border: 1px solid #e2e8f0;
  padding: 8px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  margin-left: 8px;
}

.border-highlight {
  border: 2px solid #28bf96 !important;
}

@import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap");

.appt-container {
  padding: 40px;
  background-color: #fcfdfd;
  min-height: 100vh;
  font-family: "Plus Jakarta Sans", sans-serif;
}

/* --- HEADER & WELCOME --- */
.appt-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
}
.welcome-box .welcome-title {
  font-size: 30px;
  font-weight: 800;
  color: #1e293b;
  margin: 0;
}
.welcome-box .doctor-highlight {
  color: #28bf96;
}
.welcome-box p {
  color: #94a3b8;
  font-size: 14px;
  margin-top: 4px;
}

/* --- STATS GRADIENT BOX (Yêu cầu mới) --- */
.stats-gradient-main {
  display: flex;
  gap: 12px;
  padding: 12px 24px;
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  border-radius: 20px;
  align-items: center;
  box-shadow: 0 10px 25px rgba(83, 204, 171, 0.25);
  border: 2px solid var(--primary-color);
}

.stat-pill-item {
  display: flex;
  flex-direction: column;
  min-width: 90px;
}
.stat-label-text {
  font-size: 10px;
  font-weight: 800;
  color: #484848;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.stat-number-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 4px;
}
.stat-main-val {
  font-size: 20px;
  font-weight: 800;
  color: #484848;
}

/* Pill nhỏ bao quanh % */
.stat-pct-tag {
  font-size: 10px;
  font-weight: 800;
  padding: 2px 8px;
  border-radius: 20px;
}
.pct-waiting {
  background: #ffedcf;
  color: #fd8a6b;
}
.pct-completed {
  background: #d5fbf1;
  color: #11ad84;
}
.pct-cancelled {
  background: #ffdede;
  color: #f96840;
}
.pct-pending {
  background: #e1f0ff;
  color: #0052cc;
}

.v-divider {
  width: 1px;
  height: 30px;
  background: rgba(72, 72, 72, 0.15);
}

/* --- MAIN LIST CARD --- */
.main-list-card {
  flex: 1;
  background: white;
  border-radius: 24px;
  padding: 30px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
  border: 1px solid #f1f5f9;
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}
.list-header h2 {
  font-size: 18px;
  font-weight: 800;
  color: #1e293b;
  margin: 0;
}

.search-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #f8fafc;
  padding: 10px 15px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
}
.search-wrapper input {
  background: transparent;
  border: none;
  outline: none;
  font-size: 13px;
  width: 200px;
}

/* TABLE MODERN */
.appt-table-modern {
  width: 100%;
  border-collapse: collapse;
}
.appt-table-modern th {
  text-align: left;
  padding: 12px 15px;
  color: #94a3b8;
  font-size: 11px;
  text-transform: uppercase;
  border-bottom: 1px solid #f1f5f9;
}
.appt-table-modern td {
  padding: 16px 15px;
  border-bottom: 1px solid #f8fafc;
}

.p-avatar-box {
  width: 42px;
  height: 42px;
  border-radius: 10px;
  background: #e6f9f4;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #28bf96;
}
.p-avatar-box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.p-name {
  font-weight: 700;
  color: #1e293b;
  margin: 0;
  font-size: 14px;
}
.p-info {
  font-size: 12px;
  color: #94a3b8;
  margin: 0;
}
.p-time-cell {
  font-weight: 700;
  color: #1e293b;
  font-size: 14px;
}

/* STATUS TAGS */
.status-tag {
  padding: 5px 12px;
  border-radius: 8px;
  font-size: 10px;
  font-weight: 800;
  text-transform: uppercase;
}
.status-tag.waiting {
  background: #ffedcf;
  color: #fd8a6b;
}
.status-tag.completed {
  background: #d5fbf1;
  color: #11ad84;
}
.status-tag.cancelled {
  background: #ffdede;
  color: #f96840;
}

/* BUTTONS */
.btn-start {
  background: #28bf96;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s;
  font-size: 12px;
  flex: 0 0 45%;
}
.btn-start:hover {
  background: #11ad84;
  transform: translateY(-1px);
}
.btn-view {
  background: white;
  color: #64748b;
  border: 1px solid #e2e8f0;
  padding: 8px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  margin-left: 8px;
  font-size: 12px;
}

/* CALENDAR SIDEBAR */
.calendar-sidebar {
  flex: 0 0 400px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.calendar-card-gradient {
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  padding: 50px;
  border-radius: 24px;
  border: 1px solid #28bf96;
  border: 3px solid var(--primary-color);
}
.custom-calendar-ui.react-calendar {
  width: 25vw;
  border: none;
  background: transparent;
  color: white;
  font-size: 1.2rem;
}
.custom-calendar-ui .react-calendar__navigation button {
  color: white;
  font-weight: 700;
}
.custom-calendar-ui .react-calendar__tile {
  color: white;
  font-weight: 600;
  padding: 20px 5px;
  transition: all 0.2s ease; /* Hiệu ứng mượt mà */
  border-radius: 12px; /* Bo góc sẵn để khi hover hiện khung hình vuông/tròn đẹp */
}
.custom-calendar-ui .react-calendar__tile--active {
  background: white !important;
  color: #53ccab !important;
  border-radius: 12px;
}

/* Màu cho những ngày thuộc tháng khác (ngày mờ) */
.custom-calendar-ui .react-calendar__month-view__days__day--neighboringMonth {
  color: rgba(
    255,
    255,
    255,
    0.4
  ) !important; /* Màu trắng mờ nếu nền calendar là gradient tối */
  font-weight: 400; /* Làm chữ mảnh hơn để phân biệt */
}

/* Đảm bảo khi hover vào những ngày tháng khác vẫn có hiệu ứng nhưng nhẹ nhàng hơn */
.custom-calendar-ui
  .react-calendar__month-view__days__day--neighboringMonth:enabled:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* Màu cho các ngày trong tháng hiện tại (để tương phản rõ hơn) */
.custom-calendar-ui .react-calendar__month-view__days__day {
  color: white; /* Giữ màu trắng rõ nét cho ngày trong tháng */
  font-size: 20px;
}
/* Điều chỉnh container chính */
.appt-content {
  display: flex;
  gap: 3vw; /* Khoảng cách linh hoạt theo chiều rộng màn hình */
  align-items: flex-start;
  width: 100%;
}

/* Sidebar chứa lịch */
.calendar-sidebar {
  flex: 0 0 35%; /* Lịch chiếm 35% chiều rộng */
  min-width: 320px; /* Không để lịch quá nhỏ trên màn hình bé */
}

/* Danh sách cuộc hẹn chính */
.main-list-card {
  flex: 1; /* Tự động chiếm hết phần không gian còn lại */
  background: white;
  padding: clamp(15px, 2vw, 30px); /* Padding linh hoạt */
  border-radius: 24px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
  min-width: 0; /* Quan trọng để table không bị tràn */
  overflow: hidden; /* Giữ nội dung trong bo góc */
}

.appt-table-modern {
  width: 100%;
  border-collapse: collapse;
}

.appt-table-modern th,
.appt-table-modern td {
  padding: clamp(10px, 1.2vw, 20px); /* Co giãn khoảng cách trong ô */
  text-align: left;
}

/* Tên bệnh nhân co giãn font chữ */
.p-name {
  font-weight: 700;
  color: var(--text-dark);
  margin: 0;
  font-size: clamp(0.9rem, 1.1vw, 1.1rem); /* Font tự scale */
}

.p-info {
  font-size: clamp(0.7rem, 0.9vw, 0.85rem);
  color: var(--text-muted);
}

/* Avatar co giãn nhẹ */
.p-avatar-box {
  width: clamp(35px, 3.5vw, 45px);
  height: clamp(35px, 3.5vw, 45px);
  border-radius: 12px;
  overflow: hidden;
}

.appt-table-modern {
  width: 100%;
  border-collapse: collapse;
}

.appt-table-modern th,
.appt-table-modern td {
  padding: clamp(10px, 1.2vw, 20px); /* Co giãn khoảng cách trong ô */
  text-align: left;
}

/* Tên bệnh nhân co giãn font chữ */
.p-name {
  font-weight: 700;
  color: var(--text-dark);
  margin: 0;
  font-size: clamp(0.9rem, 1.1vw, 1.1rem); /* Font tự scale */
}

.p-info {
  font-size: clamp(0.7rem, 0.9vw, 0.85rem);
  color: var(--text-muted);
}

/* Avatar co giãn nhẹ */
.p-avatar-box {
  width: clamp(35px, 3.5vw, 45px);
  height: clamp(35px, 3.5vw, 45px);
  border-radius: 12px;
  overflow: hidden;
}
/* --- CALENDAR SIDEBAR & SCALE --- */
.calendar-sidebar {
  flex: 0 0 30%;
  min-width: 350px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.calendar-card-gradient {
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  padding: 30px;
  border-radius: 24px;
  border: 3px solid var(--primary-color);
  display: flex;
  justify-content: center; /* Căn giữa card theo chiều ngang */
}

/* --- TRỌNG TÂM: CĂN GIỮA TUYỆT ĐỐI --- */

.custom-calendar-ui.react-calendar {
  width: 100% !important;
  border: none !important;
  background: transparent !important;
  color: white !important;
  font-size: 1.1rem;
}

/* 1. Căn giữa tiêu đề Tháng/Năm */
.custom-calendar-ui .react-calendar__navigation {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  margin-bottom: 20px;
}

.custom-calendar-ui .react-calendar__navigation button {
  color: white !important;
  font-weight: 700 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background: none !important;
}

/* 2. Căn giữa các chữ cái Thứ (M, T, W...) */
.custom-calendar-ui .react-calendar__month-view__weekdays {
  text-align: center !important;
  text-transform: uppercase;
  font-weight: 700;
  margin-bottom: 10px;
}

.custom-calendar-ui .react-calendar__month-view__weekdays__weekday {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  padding: 10px 0 !important;
}

.custom-calendar-ui .react-calendar__month-view__weekdays__weekday abbr {
  text-decoration: none !important;
  border: none !important;
}

/* 3. Căn giữa các con số Ngày */
.custom-calendar-ui .react-calendar__tile {
  max-width: 100% !important;
  padding: 15px 0 !important; /* Tăng padding dọc để ô cao hơn */
  background: none;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important; /* Căn giữa ngang */
  justify-content: center !important; /* Căn giữa dọc */
  text-align: center !important;
  color: white !important;
  font-weight: 600;
  position: relative;
}

/* Ép thẻ nội dung bên trong nút ngày ra giữa */
.custom-calendar-ui .react-calendar__tile abbr {
  display: block !important;
  width: 100% !important;
  text-align: center !important;
}

/* Hiệu ứng Hover & Active */
.custom-calendar-ui .react-calendar__tile:enabled:hover {
  background: rgba(255, 255, 255, 0.2) !important;
  border-radius: 12px;
}

.custom-calendar-ui .react-calendar__tile--active {
  background: white !important;
  color: #53ccab !important;
  border-radius: 12px;
}

/* --- CĂN GIỮA VÀ ĐỔI MÀU NGÀY NGOÀI THÁNG --- */

/* Màu cho những ngày thuộc tháng trước hoặc tháng sau (ngày mờ) */
.custom-calendar-ui .react-calendar__month-view__days__day--neighboringMonth {
  color: rgba(
    255,
    255,
    255,
    0.3
  ) !important; /* Làm mờ hẳn đi (độ trong suốt 30%) */
  font-weight: 400 !important; /* Chỉnh chữ mỏng hơn để phân biệt với ngày trong tháng */
}

/* Đảm bảo các ngày mờ này vẫn được căn giữa như các ngày khác */
.custom-calendar-ui .react-calendar__month-view__days__day--neighboringMonth {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* Hiệu ứng khi hover vào những ngày mờ (nếu bạn vẫn muốn cho chọn) */
.custom-calendar-ui
  .react-calendar__month-view__days__day--neighboringMonth:enabled:hover {
  background: rgba(255, 255, 255, 0.1) !important;
  color: rgba(255, 255, 255, 0.6) !important;
}

/* --- ĐIỀU CHỈNH LẠI CĂN GIỮA TỔNG THỂ (ĐỂ CHẮC CHẮN) --- */
.custom-calendar-ui .react-calendar__tile {
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  text-align: center !important;
}

.custom-calendar-ui .react-calendar__tile abbr {
  display: block !important;
  width: 100% !important;
  text-align: center !important;
}

/* Tên bệnh nhân */
.p-name {
  font-weight: 700;
  color: var(--text-dark);
  margin: 0;
  /* Min: 14px, Scalable: 1.1vw, Max: 18px */
  font-size: clamp(0.875rem, 1.1vw, 1.125rem);
}

/* Thông tin phụ (Gender, Age) */
.p-info {
  color: var(--text-muted);
  font-size: clamp(0.75rem, 0.9vw, 0.875rem);
}

/* Status Tag */
.status-tag {
  /* Padding co giãn theo màn hình */
  padding: clamp(4px, 0.5vw, 6px) clamp(10px, 1vw, 16px);
  border-radius: 20px;
  font-weight: 600;
  text-transform: capitalize;
  font-size: clamp(0.7rem, 0.8vw, 0.8rem);
  display: inline-block;
}

.p-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.btn-start,
.btn-view {
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;

  /* Scale padding và font size */
  padding: clamp(8px, 0.8vw, 12px) clamp(16px, 1.5vw, 24px);
  font-size: clamp(0.75rem, 0.9vw, 0.9rem);

  /* Giới hạn độ dài tối đa để nút không bị thô */
  max-width: 160px;
  white-space: nowrap;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-start {
  background-color: var(--primary-color);
  color: white;
  box-shadow: 0 4px 12px rgba(40, 191, 150, 0.2);
}

.btn-view {
  background-color: #f1f5f9;
  color: #64748b;
}

.p-time-cell {
  font-weight: 700;
  color: var(--text-dark);
  font-size: clamp(0.85rem, 1vw, 1rem);
}

/* Container cho bộ lọc dưới lịch */
.status-filter-card {
    background: white;
    border-radius: 24px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
  }
  
  .filter-title {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .filter-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .filter-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border: 1px solid #f1f5f9;
    background: white;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    color: #475569;
    transition: all 0.2s ease;
    text-align: left;
  }
  
  .filter-btn:hover {
    background: #f8fafc;
    border-color: var(--primary-color);
  }
  
  .filter-btn.active {
    background: #eefcf8;
    border-color: var(--primary-color);
    color: var(--primary-color);
  }
  
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }
  
  .empty-state {
    text-align: center;
    padding: 40px;
    color: var(--text-muted);
    font-style: italic;
  }
-e \n[END OF FILE]\n
frontend/src/pages/doctor/MedicalExam.css
------------------------------------------
.exam-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(40, 191, 150, 0.45);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999; backdrop-filter: blur(4px);
}

.exam-card {
    background: white; width: 95%; max-width: 950px; height: 90vh;
    border-radius: 24px; display: flex; flex-direction: column;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.exam-header {
    padding: 15px 30px; border-bottom: 1px solid #f1f5f9;
    display: flex; justify-content: space-between; align-items: center;
}

.exam-body { padding: 30px; overflow-y: auto; flex: 1; }
.main-title { font-size: 24px; color: #1e293b; margin: 0; font-weight: 800; }
.sub-info { font-size: 13px; color: #28BF96; margin-top: 5px; font-weight: 600; }

.section-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 16px; padding: 20px; margin: 20px 0; }
.patient-info-row { display: flex; gap: 20px; align-items: center; }

.p-avatar-large {
    width: 65px; height: 65px; background: white; border: 2px solid #28BF96;
    border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #28BF96;
}

.p-contact-grid { flex: 1; display: grid; grid-template-columns: 1fr 1fr; font-size: 14px; gap: 10px; border-left: 1px solid #e2e8f0; padding-left: 25px; }
.p-contact-grid span { font-weight: 700; color: #28BF96; margin-right: 5px; }

.grid-2-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
.input-group label { display: flex; align-items: center; gap: 8px; font-weight: 700; font-size: 15px; margin-bottom: 12px; }
.input-group textarea {
    width: 100%; height: 100px; border: 1px solid #e2e8f0; border-radius: 14px;
    padding: 15px; outline: none; transition: 0.2s; resize: none; font-size: 14px;
}
.input-group textarea:focus { border-color: #28BF96; box-shadow: 0 0 0 4px rgba(40, 191, 150, 0.1); }

/* Prescription Search & Dropdown */
.section-header { position: relative; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }

.medicine-dropdown {
    position: absolute; right: 0; top: 48px; width: 320px; background: white;
    border: 1px solid #e2e8f0; box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
    z-index: 100; border-radius: 14px; overflow: hidden;
}

.med-search-wrapper {
    display: flex; align-items: center; gap: 10px; padding: 12px;
    background: #f8fafc; border-bottom: 1px solid #f1f5f9;
}
.med-search-wrapper input { border: none; background: transparent; outline: none; width: 100%; font-size: 13px; }
.med-search-wrapper svg { color: #94a3b8; }

.med-list-items { max-height: 220px; overflow-y: auto; }
.med-item { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; cursor: pointer; font-size: 13px; }
.med-item:hover { background: #f0fdfa; color: #28BF96; }
.med-no-result { padding: 20px; text-align: center; color: #94a3b8; font-size: 13px; }

/* Table */
.med-table { width: 100%; border-collapse: collapse; }
.med-table th { text-align: left; padding: 12px; color: #64748b; border-bottom: 2px solid #f1f5f9; font-size: 12px; }
.med-table td { padding: 12px; border-bottom: 1px solid #f8fafc; }
.table-input { width: 100%; border: none; border-bottom: 1px solid #e2e8f0; padding: 5px 0; outline: none; background: transparent; }
.btn-icon-delete { background: #fee2e2; color: #ef4444; border: none; padding: 7px; border-radius: 8px; cursor: pointer; }

/* Footer */
.exam-footer { padding: 20px 30px; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between; }
.btn-complete-exam { background: #28BF96; color: white; border: none; padding: 10px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; }
.btn-cancel-exam { background: #f1f5f9; color: #64748b; border: none; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 600; }
.add-med-btn { background: #28BF96; color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; }
.exam-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(40, 191, 150, 0.45);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999; backdrop-filter: blur(4px);
}

.exam-card {
    background: white; width: 95%; max-width: 950px; height: 90vh;
    border-radius: 24px; display: flex; flex-direction: column;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.exam-header {
    padding: 15px 30px; border-bottom: 1px solid #f1f5f9;
    display: flex; justify-content: space-between; align-items: center;
}

/* NÚT X ĐÓNG MODAL - KHÔNG NỀN, KHÔNG VIỀN */
.btn-close-transparent {
    background: transparent;
    border: none;
    color: #94a3b8;
    cursor: pointer;
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
    outline: none;
}

.btn-close-transparent:hover {
    color: #ef4444;
}

.exam-body { padding: 30px; overflow-y: auto; flex: 1; }
.main-title { font-size: 24px; color: #1e293b; margin: 0; font-weight: 800; }

/* PATIENT SUMMARY CARD - CẤU TRÚC GRID ĐỂ HIỂN THỊ THÔNG TIN */
.patient-summary-card {
    background: #f8fafc;
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid #e2e8f0;
}

.p-main-info {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}

.p-avatar-large {
    width: 70px;
    height: 70px;
    background: white;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #e2e8f0;
    flex-shrink: 0;
}

.p-avatar-large img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 15px;
}

.p-details h3 {
    margin: 0 0 10px 0;
    color: #1e293b;
    font-size: 1.2rem;
    font-weight: 700;
}

.p-grid-info {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px 60px;
    font-size: 13px;
    color: #64748b;
}

.p-grid-info .full-width {
    grid-column: span 3;
}

.p-grid-info strong {
    color: #1e293b;
}

/* Examination Layout */
.exam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }
.section-title { font-size: 16px; font-weight: 700; color: #1e293b; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
.exam-textarea { width: 100%; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; font-size: 14px; outline: none; transition: 0.2s; height: 160px; resize: none; background: #fafafa; }
.exam-textarea:focus { border-color: #28BF96; box-shadow: 0 0 0 4px rgba(40, 191, 150, 0.12); background: white; }
.exam-textarea.small { height: 72px; margin-bottom: 15px; }

/* Prescription & Medicine Selection */
.prescription-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.med-search-container { position: relative; }
.btn-add-med { background: #28BF96; color: white; border: none; padding: 8px 16px; border-radius: 10px; font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer; }
.med-dropdown-card { position: absolute; top: 100%; right: 0; width: 300px; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; z-index: 100; margin-top: 10px; overflow: hidden; }
.med-search-box { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f1f5f9; gap: 8px; }
.med-search-box input { border: none; outline: none; width: 100%; font-size: 13px; }
.med-list-items { max-height: 220px; overflow-y: auto; }
.med-item { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; cursor: pointer; font-size: 13px; }
.med-item:hover { background: #f0fdfa; color: #28BF96; }
.med-no-result { padding: 20px; text-align: center; color: #94a3b8; font-size: 13px; }

/* Table */
.med-table { width: 100%; border-collapse: collapse; }
.med-table th { text-align: left; padding: 12px; color: #64748b; border-bottom: 2px solid #f1f5f9; font-size: 12px; }
.med-table td { padding: 12px; border-bottom: 1px solid #f8fafc; }
.table-input { width: 100%; border: none; border-bottom: 1px solid #e2e8f0; padding: 5px 0; outline: none; background: transparent; }
.btn-icon-delete { background: #fee2e2; color: #ef4444; border: none; padding: 7px; border-radius: 8px; cursor: pointer; }

/* Footer */
.exam-footer { padding: 20px 30px; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
.right-btns { display: flex; gap: 12px; align-items: center; }

.btn-export { background: #f1f5f9; color: #475569; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }

/* NÚT CANCEL NẰM TRÁI */
.btn-cancel-exam { background: white; color: #64748b; border: 1px solid #e2e8f0; padding: 10px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; }
.btn-cancel-exam:hover { background: #f1f5f9; }

/* NÚT COMPLETE NẰM PHẢI */
.btn-complete-exam { background: #28BF96; color: white; border: none; padding: 10px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
.exam-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(40, 191, 150, 0.45);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999; backdrop-filter: blur(4px);
}

.exam-card {
    background: white; width: 95%; max-width: 950px; height: 90vh;
    border-radius: 24px; display: flex; flex-direction: column;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.exam-header {
    padding: 15px 30px; border-bottom: 1px solid #f1f5f9;
    display: flex; justify-content: space-between; align-items: center;
}

.btn-close-transparent {
    background: transparent; border: none; color: #94a3b8;
    cursor: pointer; padding: 4px; display: flex; align-items: center;
    justify-content: center; transition: color 0.2s; outline: none;
}
.btn-close-transparent:hover { color: #ef4444; }

.exam-body { padding: 30px; overflow-y: auto; flex: 1; }
.main-title { font-size: 24px; color: #1e293b; margin: 0; font-weight: 800; }

/* PATIENT SUMMARY CARD */
.patient-summary-card {
    background: #f8fafc; border-radius: 16px; padding: 20px;
    margin-bottom: 25px; border: 1px solid #e2e8f0;
}
.p-main-info { display: flex; gap: 20px; align-items: flex-start; }
.p-avatar-large {
    width: 70px; height: 70px; background: white; border-radius: 15px;
    display: flex; align-items: center; justify-content: center;
    border: 1px solid #e2e8f0; flex-shrink: 0;
}
.p-avatar-large img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; }
.p-details h3 { margin: 0 0 10px 0; color: #1e293b; font-size: 1.2rem; font-weight: 700; }
.p-grid-info { display: grid; grid-template-columns: repeat(3, 1fr); gap: 13px 70px; font-size: 13px; color: #64748b; margin-top: 10px; }
.p-grid-info .full-width { grid-column: span 3; }
.p-grid-info strong { color: #1e293b; }

/* DIAGNOSIS SECTION - HIỂN THỊ DẠNG CỘT (HOẶC HÀNG) TÙY Ý */
.exam-section { margin-bottom: 30px; }
.section-title { font-size: 16px; font-weight: 700; color: #1e293b; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
.diagnosis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

.exam-textarea { width: 100%; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; font-size: 14px; outline: none; transition: 0.2s; background: #fafafa; }
.exam-textarea:focus { border-color: #28BF96; box-shadow: 0 0 0 4px rgba(40, 191, 150, 0.12); background: white; }
.exam-textarea.small { height: 100px; resize: none; }

/* Prescription & Medicine */
.prescription-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.med-search-container { position: relative; }
.btn-add-med { background: #28BF96; color: white; border: none; padding: 8px 16px; border-radius: 10px; font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer; }
.med-dropdown-card { position: absolute; top: 100%; right: 0; width: 300px; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; z-index: 100; margin-top: 10px; overflow: hidden; }
.med-search-box { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f1f5f9; gap: 8px; }
.med-search-box input { border: none; outline: none; width: 100%; font-size: 13px; }
.med-list-items { max-height: 220px; overflow-y: auto; }
.med-item { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; cursor: pointer; font-size: 13px; }
.med-item:hover { background: #f0fdfa; color: #28BF96; }
.med-no-result { padding: 20px; text-align: center; color: #94a3b8; font-size: 13px; }

/* Table */
.med-table { width: 100%; border-collapse: collapse; }
.med-table th { text-align: left; padding: 12px; color: #64748b; border-bottom: 2px solid #f1f5f9; font-size: 12px; }
.med-table td { padding: 12px; border-bottom: 1px solid #f8fafc; }
.table-input { width: 100%; border: none; border-bottom: 1px solid #e2e8f0; padding: 5px 0; outline: none; background: transparent; }
.btn-icon-delete { background: #fee2e2; color: #ef4444; border: none; padding: 7px; border-radius: 8px; cursor: pointer; }

/* Footer */
.exam-footer { padding: 20px 30px; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
.right-btns { display: flex; gap: 12px; align-items: center; }
.btn-export { background: #f1f5f9; color: #475569; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
.btn-cancel-exam { background: white; color: #64748b; border: 1px solid #e2e8f0; padding: 10px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; }
.btn-complete-exam { background: #28BF96; color: white; border: none; padding: 10px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
.readonly-box {
    padding: 15px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    min-height: 50px;
    color: #334155;
    line-height: 1.6;
    font-size: 14px;
}

.info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
    background: #f0fdfa;
    padding: 15px;
    border-radius: 16px;
}

.info-item label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: #64748b;
    margin-bottom: 5px;
    text-transform: uppercase;
}

.info-item .val-text {
    font-weight: 700;
    color: #1e293b;
}

.exam-header {
    padding: 15px 30px;
    border-bottom: 1px solid #f1f5f9;
    display: flex;
    justify-content: space-between; /* Đẩy tiêu đề sang trái, nút X sang phải */
    align-items: center;
}

.btn-close {
    background: #f1f5f9; /* Màu nền xám nhạt cho nút */
    border: none;
    color: #64748b;
    padding: 8px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

.btn-close:hover {
    background: #fee2e2; /* Đổi sang đỏ nhạt khi di chuột vào */
    color: #ef4444;
}-e \n[END OF FILE]\n
frontend/src/pages/doctor/Profile.tsx
------------------------------------------
import React, { useState, useEffect } from "react";
import axios from "axios";
import {
  Button,
  Input,
  DatePicker,
  Select,
  Space,
  Typography,
  Card,
  Spin,
  message,
} from "antd";
import {
  EditOutlined,
  LogoutOutlined,
  CheckCircleFilled,
  UserOutlined,
  CameraOutlined,
  StarFilled,
} from "@ant-design/icons";
import dayjs from "dayjs";
import "./Profile.css";

const { Title, Text } = Typography;

const DoctorProfile: React.FC = () => {
  const [doctor, setDoctor] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [saving, setSaving] = useState<boolean>(false);

  useEffect(() => {
    const fetchProfile = async () => {
      try {
        setLoading(true);
        const doctorId = localStorage.getItem("doctorId");
        const token = localStorage.getItem("token");
        const headers = { Authorization: `Bearer ${token}` };

        if (doctorId) {
          const res = await axios.get(
            `http://localhost:3000/api/doctors/${doctorId}`,
            { headers }
          );
          // Kiểm tra xem dữ liệu có nằm trong bọc res.data.data không
          const actualData = res.data.data ? res.data.data : res.data;
          setDoctor(actualData);
        }
      } catch (err) {
        console.error("Lỗi fetch dữ liệu:", err);
        message.error("Lỗi tải thông tin cá nhân");
      } finally {
        setLoading(false);
      }
    };
    fetchProfile();
  }, []);

  const handleSave = async () => {
    try {
      setSaving(true);
      const token = localStorage.getItem("token");
      const doctorId = localStorage.getItem("doctorId");

      // Tạo object sạch để gửi lên Backend
      const updateData = {
        fullName: doctor.fullName,
        gender: doctor.gender,
        dateOfBirth: doctor.dateOfBirth,
        phone: doctor.phone, // Đảm bảo trong state doctor có phone
        address: doctor.address,
        description: doctor.description,
        // Chuyển đổi năm kinh nghiệm về dạng số nguyên (bỏ chữ " Years")
        experienceYear: Number(
          String(doctor.experienceYear).replace(/\D/g, "")
        ),
      };

      await axios.patch(
        `http://localhost:3000/api/doctors/${doctorId}`,
        updateData,
        { headers: { Authorization: `Bearer ${token}` } }
      );

      message.success("Cập nhật thông tin thành công!");
    } catch (err: any) {
      console.error("Lỗi cập nhật:", err.response?.data);
      const errorMsg = err.response?.data?.message;
      message.error(
        Array.isArray(errorMsg)
          ? errorMsg[0]
          : errorMsg || "Không thể lưu thay đổi"
      );
    } finally {
      setSaving(false);
    }
  };

  if (loading)
    return (
      <div className="loading-container">
        <Spin size="large" tip="Đang tải..." />
      </div>
    );
  if (!doctor) return <div>Không tìm thấy dữ liệu bác sĩ.</div>;

  // XỬ LÝ ĐƯỜNG DẪN ẢNH CẨN THẬN
  // Nếu doctor.user.avatar là "doctor_7.jpg" -> link sẽ là http://localhost:3000/avatar/doctor_7.jpg
  // Nếu doctor.user.avatar là "/avatar/doctor_7.jpg" -> link sẽ bị thừa một chữ /avatar
  const avatarName = doctor.user?.avatar;
  const avatarUrl = avatarName
    ? avatarName.startsWith("http")
      ? avatarName
      : `http://localhost:3000/avatar/${avatarName.replace(/^\/avatar\//, "")}`
    : "https://via.placeholder.com/400x500?text=No+Avatar";

  return (
    <div className="profile-page-container">
      <div className="profile-header-text">
        <Title level={2}>Personal details</Title>
        <Text type="secondary">
          Quản lý thông tin cá nhân và chuyên môn của bạn.
        </Text>
      </div>

      <div className="profile-content-layout">
        <div className="profile-left-card">
          <Card className="doctor-card" bordered={false}>
            <div className="image-wrapper">
              <img
                src={avatarUrl}
                alt="Doctor"
                className="main-avatar"
                onError={(e) => {
                  (e.target as HTMLImageElement).src =
                    "https://via.placeholder.com/400x500?text=Error+Image";
                }}
              />
            </div>
            <div className="doctor-info-summary">
              <Title level={4}>
                Dr. {doctor.fullName}{" "}
                <CheckCircleFilled style={{ color: "#4cc9b0" }} />
              </Title>
              <Text className="dept-tag">
                {doctor.department?.name?.toUpperCase() || "N/A"}
              </Text>
              <p className="specialist-desc">{doctor.description}</p>
            </div>
            <div className="stats-footer">
              <Space>
                <UserOutlined /> 312 Patients
              </Space>
              <Space>
                <StarFilled style={{ color: "#fadb14" }} /> 5.0
              </Space>
            </div>
          </Card>
        </div>

        <div className="profile-right-form">
          <Card className="form-card" bordered={false}>
            <div className="form-grid">
              <div className="form-row">
                <span className="label">Full name:</span>
                <Input
                  value={doctor.fullName}
                  onChange={(e) =>
                    setDoctor({ ...doctor, fullName: e.target.value })
                  }
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Department:</span>
                <Input
                  value={doctor.department?.name}
                  disabled
                  className="custom-input readonly-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Gender:</span>
                <Select
                  value={doctor.gender?.toLowerCase() || "other"}
                  className="custom-select"
                  onChange={(val) => setDoctor({ ...doctor, gender: val })}
                >
                  <Select.Option value="female">Female</Select.Option>
                  <Select.Option value="male">Male</Select.Option>
                  <Select.Option value="other">Other</Select.Option>
                </Select>
              </div>

              <div className="form-row">
                <span className="label">Location:</span>
                <Input
                  value={doctor.address}
                  onChange={(e) =>
                    setDoctor({ ...doctor, address: e.target.value })
                  }
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Email:</span>
                <Input
                  value={doctor.user?.email}
                  disabled
                  className="custom-input readonly-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Date of birth:</span>
                <DatePicker
                  value={doctor.dateOfBirth ? dayjs(doctor.dateOfBirth) : null}
                  onChange={(date) =>
                    setDoctor({
                      ...doctor,
                      dateOfBirth: date?.format("YYYY-MM-DD"),
                    })
                  }
                  format="DD - MM - YYYY"
                  className="custom-input w-100"
                />
              </div>

              <div className="form-row">
                <span className="label">Years of experience:</span>
                <Input
                  value={`${doctor.experienceYear} Years`}
                  onChange={(e) =>
                    setDoctor({
                      ...doctor,
                      experienceYear: e.target.value.replace(/\D/g, ""),
                    })
                  }
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>
            </div>
          </Card>

          <div className="profile-actions">
            <Button
              icon={<LogoutOutlined />}
              className="logout-btn"
              onClick={() => {
                localStorage.clear();
                window.location.href = "/login";
              }}
            >
              Logout
            </Button>
            <Button
              type="primary"
              className="save-btn"
              onClick={handleSave} // Gắn hàm lưu
              loading={saving} // Hiển thị loading khi đang lưu
            >
              Save changes
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default DoctorProfile;
-e \n[END OF FILE]\n
frontend/src/pages/doctor/Request.tsx
------------------------------------------
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import Calendar from "react-calendar";
import "react-calendar/dist/Calendar.css";
import { Search, User, Check, X } from "lucide-react";
import "./Request.css";

const DoctorBookingRequest: React.FC = () => {
  const [appointments, setAppointments] = useState<any[]>([]);
  const [doctor, setDoctor] = useState<any>(null); // State lưu thông tin bác sĩ giống Dashboard
  const [loading, setLoading] = useState<boolean>(true);
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [searchTerm, setSearchTerm] = useState("");

  const fetchData = async () => {
    try {
      setLoading(true);
      const doctorId = localStorage.getItem("doctorId");
      const token = localStorage.getItem("token");

      // 1. Lấy dữ liệu bác sĩ
      if (doctorId) {
        const docResponse = await axios.get(
          `http://localhost:3000/api/doctors/${doctorId}`,
          {
            headers: { Authorization: `Bearer ${token}` },
          }
        );
        setDoctor(docResponse.data);
      }

      // 2. Lấy dữ liệu danh sách yêu cầu đặt lịch (Pending)
      const apptResponse = await axios.get(
        "http://localhost:3000/api/appointments",
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );

      if (apptResponse.data) {
        const processed = apptResponse.data.filter((apt: any) => {
          const isMyAppointment =
            String(apt.doctor?.userId) === String(doctorId);
          const isPending = apt.status?.toLowerCase() === "pending";
          return isMyAppointment && isPending;
        });
        setAppointments(processed);
      }
    } catch (error) {
      console.error("Lỗi fetch dữ liệu booking requests:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  // --- CHỨC NĂNG CẬP NHẬT TRẠNG THÁI (MỚI THÊM) ---
  const handleUpdateStatus = async (id: number, newStatus: string) => {
    try {
      const token = localStorage.getItem("token");
      const isConfirmed = window.confirm(
        `Are you sure you want to ${newStatus} this request?`
      );

      if (isConfirmed) {
        await axios.patch(
          `http://localhost:3000/api/appointments/${id}`,
          { status: newStatus },
          { headers: { Authorization: `Bearer ${token}` } }
        );
        fetchData(); // Tải lại dữ liệu sau khi cập nhật thành công
      }
    } catch (error) {
      console.error("Update failed:", error);
      alert("Failed to update status.");
    }
  };

  // Xử lý tên bác sĩ hiển thị
  const displayDoctorName = doctor?.full_name || doctor?.fullName || "Doctor";

  const filteredData = useMemo(() => {
    const dStr = selectedDate.toLocaleDateString("en-CA"); // Định dạng YYYY-MM-DD

    // 1. Lọc theo ngày, trạng thái 'pending' và tên bệnh nhân
    const filtered = appointments.filter(
      (apt) =>
        apt.appointment_date === dStr &&
        apt.status?.toLowerCase() === "pending" &&
        apt.patient?.fullName?.toLowerCase().includes(searchTerm.toLowerCase())
    );

    // 2. Sắp xếp theo giờ hẹn (appointment_time) từ sáng đến chiều
    return filtered.sort((a, b) => {
      // So sánh chuỗi thời gian (HH:mm). Ví dụ: "08:00" < "14:30"
      if (a.appointment_time < b.appointment_time) return -1;
      if (a.appointment_time > b.appointment_time) return 1;
      return 0;
    });
  }, [appointments, selectedDate, searchTerm]);

  if (loading)
    return (
      <div className="loader-container">
        <div className="spinner"></div>
      </div>
    );

  return (
    <div className="booking-container">
      <header className="booking-header">
        <div className="welcome-box">
          <h1 className="welcome-heading">
            Booking Request{" "}
            <span className="highlight-text">Dr. {displayDoctorName}</span>
          </h1>
          <p>You have {appointments.length} new booking requests to review.</p>
        </div>
      </header>

      <div className="booking-content">
        <aside className="calendar-aside">
          <div className="custom-calendar-card">
            <div className="corner-decoration top-left"></div>
            <div className="corner-decoration bottom-right"></div>
            <Calendar
              onChange={(val: any) => setSelectedDate(val)}
              value={selectedDate}
              formatMonthYear={(locale, date) =>
                date.toLocaleDateString("en-US", {
                  month: "long",
                  year: "numeric",
                })
              }
            />
          </div>
        </aside>

        {/* GIỮ NGUYÊN HOÀN TOÀN CẤU TRÚC THẺ VÀ CLASS Ở ĐÂY */}
        <section className="request-list-section">
          <div className="list-header">
            <h2>Requests for {selectedDate.toLocaleDateString("en-GB")}</h2>
            <div className="booking-search">
              <Search size={18} />
              <input
                type="text"
                placeholder="Search patient..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
          </div>

          <table className="booking-table">
            <thead>
              <tr>
                <th>Patient</th>
                <th>Time</th>
                <th style={{ textAlign: "center" }}>Status Action</th>
                <th style={{ textAlign: "right" }}>More</th>
              </tr>
            </thead>
            <tbody>
              {filteredData.length > 0 ? (
                filteredData.map((apt) => (
                  <tr key={apt.id}>
                    <td>
                      <div className="p-cell">
                        <div className="p-avatar-wrapper">
                          {apt.patient?.user?.avatar ? (
                            <img
                              src={`http://localhost:3000${apt.patient.user.avatar}`}
                              alt="avatar"
                              className="patient-avatar-img"
                            />
                          ) : (
                            <User size={20} className="avatar-placeholder" />
                          )}
                        </div>
                        <div>
                          <p className="p-name">{apt.patient?.fullName}</p>
                          <p className="p-info">
                            {apt.patient?.gender || "N/A"} -{" "}
                            {apt.patient?.age || "20"} Years
                          </p>
                        </div>
                      </div>
                    </td>
                    <td className="p-time">{apt.appointment_time}</td>
                    <td>
                      <div className="status-action-btns">
                        {/* Gán onClick vào nút Confirm */}
                        <button
                          className="btn-status-confirm"
                          title="Confirm"
                          onClick={() =>
                            handleUpdateStatus(apt.id, "confirmed")
                          }
                        >
                          <Check size={16} /> Confirm
                        </button>
                        {/* Gán onClick vào nút Decline */}
                        <button
                          className="btn-status-cancelled"
                          title="Decline"
                          onClick={() =>
                            handleUpdateStatus(apt.id, "cancelled")
                          }
                        >
                          <X size={16} /> Decline
                        </button>
                      </div>
                    </td>
                    <td className="booking-actions-end">
                      <button className="btn-details-link">Details</button>
                    </td>
                  </tr>
                ))
              ) : (
                <tr>
                  <td colSpan={4} className="no-data-white">
                    No pending requests for this date.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </section>
      </div>
    </div>
  );
};

export default DoctorBookingRequest;
-e \n[END OF FILE]\n
frontend/src/pages/doctor/History.tsx
------------------------------------------
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import Calendar from "react-calendar";
import "react-calendar/dist/Calendar.css";
import { Search, User, Download } from "lucide-react";
import "./History.css";

const AppointmentHistory: React.FC = () => {
  const [appointments, setAppointments] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [searchTerm, setSearchTerm] = useState("");
  const [doctor, setDoctor] = useState<any>(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const loggedInDoctorId = localStorage.getItem("doctorId");
        const token = localStorage.getItem("token");
        const config = { headers: { Authorization: `Bearer ${token}` } };

        const [resAppt, resRecords, resDoctor] = await Promise.all([
          axios.get("http://localhost:3000/api/appointments", config),
          axios.get("http://localhost:3000/api/medical-records", config),
          // 2. Thêm API lấy thông tin bác sĩ giống Appointment
          axios.get(
            `http://localhost:3000/api/doctors/${loggedInDoctorId}`,
            config
          ),
        ]);

        setDoctor(resDoctor.data);

        if (resAppt.data && resRecords.data) {
          const myHistoryApts = resAppt.data.filter((apt: any) => {
            const isMyAppointment =
              String(apt.doctor?.userId || apt.doctorId) ===
              String(loggedInDoctorId);
            const isCompleted = apt.status?.toLowerCase() === "completed";
            return isMyAppointment && isCompleted;
          });

          const mergedData = myHistoryApts.map((apt: any) => {
            const record = resRecords.data.find(
              (rec: any) => String(rec.appointmentId) === String(apt.id)
            );

            return {
              ...apt,
              // Chỉ giữ lại diagnosis
              diagnosis: record ? record.diagnosis : "No diagnosis available",
            };
          });

          setAppointments(mergedData);
        }
      } catch (error) {
        console.error("Lỗi lấy dữ liệu lịch sử:", error);
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, []);

  const filteredData = useMemo(() => {
    const dStr = selectedDate.toLocaleDateString("en-CA"); // Định dạng YYYY-MM-DD

    // 1. Lọc theo ngày và từ khóa tìm kiếm
    const filtered = appointments.filter(
      (apt: any) =>
        apt.appointment_date === dStr &&
        apt.patient?.fullName?.toLowerCase().includes(searchTerm.toLowerCase())
    );

    // 2. Sắp xếp theo giờ hẹn từ sáng đến chiều
    return filtered.sort((a, b) => {
      // So sánh chuỗi thời gian "HH:mm"
      if (a.appointment_time < b.appointment_time) return -1;
      if (a.appointment_time > b.appointment_time) return 1;
      return 0;
    });
  }, [appointments, selectedDate, searchTerm]);
  if (loading)
    return (
      <div className="loader-container">
        <div className="spinner"></div>
      </div>
    );

  return (
    <div className="history-container">
      <header className="history-header">
        <div className="welcome-box">
          <h1>
            Appointment history{" "}
            <span className="highlight-green">Dr. {doctor?.fullName}</span>
          </h1>
          <p>
            Viewing medical records for{" "}
            {selectedDate.toLocaleDateString("en-US", {
              day: "numeric",
              month: "long",
              year: "numeric",
            })}
          </p>
        </div>
      </header>

      <div className="history-content">
        <aside className="history-sidebar">
          <div className="calendar-card-white">
            <Calendar
              onChange={(val: any) => setSelectedDate(val)}
              value={selectedDate}
              prev2Label={null}
              next2Label={null}
              formatMonthYear={(locale, date) =>
                date.toLocaleDateString("en-US", {
                  month: "long",
                  year: "numeric",
                })
              }
            />
          </div>
        </aside>

        <section className="history-list-section">
          <div className="list-white-box">
            <div className="list-header">
              <h2>Examined Patients</h2>
              <div className="history-search">
                <Search size={18} color="#999" />
                <input
                  type="text"
                  placeholder="Search patient..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
              </div>
            </div>

            <table className="history-table">
              <thead>
                <tr>
                  <th>Patient Name</th>
                  <th>Appointment</th>
                  <th>Diagnosis</th>
                  <th style={{ textAlign: "right" }}>Action</th>
                </tr>
              </thead>
              <tbody>
                {filteredData.length > 0 ? (
                  filteredData.map((apt) => (
                    <tr key={apt.id}>
                      <td>
                        <div className="p-cell">
                          <div className="p-avatar-circle">
                            {apt.patient?.user?.avatar ? (
                              <img
                                src={`http://localhost:3000${apt.patient.user.avatar}`}
                                alt="avatar"
                              />
                            ) : (
                              <User size={20} color="#53CCAB" />
                            )}
                          </div>
                          <div>
                            <p className="p-name">{apt.patient?.fullName}</p>
                            <p className="p-info">
                              {apt.patient?.gender || "Patient"} - Completed
                            </p>
                          </div>
                        </div>
                      </td>
                      <td className="p-time">{apt.appointment_time}</td>
                      {/* ĐÃ XOÁ PHẦN SYMPTOMS Ở ĐÂY */}
                      <td className="p-diagnosis">
                        <span className="diagnosis-text">{apt.diagnosis}</span>
                      </td>
                      <td>
                        <div className="history-actions-end">
                          <button className="btn-view-records">
                            View Records
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))
                ) : (
                  <tr>
                    <td colSpan={4} className="no-data">
                      No history records found for this date.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>

            <div className="history-footer">
              <div className="pagination">
                <span className="page-nav">&lt;</span>
                <span className="active-page">1</span>
                <span className="page-nav">&gt;</span>
              </div>
              <button className="btn-export">
                <Download size={16} /> Export CSV
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  );
};

export default AppointmentHistory;
-e \n[END OF FILE]\n
frontend/src/pages/doctor/Request.css
------------------------------------------
/* --- LAYOUT CHUNG --- */
.booking-container {
  padding: 40px;
  background-color: #fcfdfd;
  min-height: 100vh;
  font-family: "Plus Jakarta Sans", sans-serif;
}

/* Thêm class cha phía trước để tăng độ ưu tiên */
.welcome-box .welcome-heading {
    color: #1e293b !important; /* Thêm !important để ép trình duyệt nhận màu này */
    font-weight: 800;
    font-size: clamp(1.8rem, 2.5vw, 2.4rem);
    margin: 0;
}

/* Đảm bảo phần highlight (tên bác sĩ) vẫn có màu xanh */
.welcome-box .welcome-heading .highlight-text {
    color: #53CCAB !important;
}

.highlight-text {
  color: #222222;
}
.booking-header {
  margin-bottom: 30px;
}

.booking-content {
  display: flex;
  gap: 40px;
  align-items: flex-start;
}

/* --- SIDEBAR LỊCH --- */
.calendar-aside {
  flex: 0 0 40%;
}

.custom-calendar-card {
  position: relative;
  background: transparent;
  padding: 30px;
  border: 1px solid #e2e8f0;
  border-radius: 16px;
}

.corner-decoration {
  position: absolute;
  width: 40px;
  height: 40px;
  border: 4px solid #6bd4b7;
}
.top-left {
  top: -2px;
  left: -2px;
  border-right: none;
  border-bottom: none;
  border-top-left-radius: 16px;
}
.bottom-right {
  bottom: -2px;
  right: -2px;
  border-left: none;
  border-top: none;
  border-bottom-right-radius: 16px;
}

/* --- CUSTOM REACT-CALENDAR --- */
.custom-calendar-card .react-calendar {
  background: transparent !important;
  border: none !important;
  width: 100% !important;
  font-size: 18px;
}
.custom-calendar-card .react-calendar__month-view__weekdays__weekday abbr {
  text-decoration: none !important;
  color: #6bd4b7 !important;
  font-weight: 700;
  text-transform: uppercase;
}
.custom-calendar-card .react-calendar__tile {
  color: #4a4a4a !important;
  font-weight: 600;
  padding: 15px 0 !important;
}
.custom-calendar-card .react-calendar__tile--active {
  background: #6bd4b7 !important;
  color: rgb(77, 48, 48) !important;
  border-radius: 8px;
}

/* --- DANH SÁCH GRADIENT (Bên phải) --- */
.request-list-section {
  flex: 1;
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  border-radius: 30px;
  padding: 40px;
  color: white;
  box-shadow: 0 10px 30px rgba(83, 204, 171, 0.2);
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.booking-search {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  padding: 10px 20px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
  border: 1px solid rgba(255, 255, 255, 0.3);
}
.booking-search input {
  background: transparent;
  border: none;
  color: white;
  outline: none;
}
.booking-search input::placeholder {
  color: rgba(255, 255, 255, 0.7);
}

/* --- TABLE --- */
.booking-table {
  width: 100%;
  border-collapse: collapse;
}
.booking-table th {
  text-align: left;
  padding: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  font-size: 14px;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.9);
}
.booking-table td {
  padding: 20px 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  vertical-align: middle;
}

/* --- PATIENT CELL & AVATAR ĐỒNG BỘ --- */
.p-cell {
  display: flex;
  align-items: center;
  gap: 15px;
}

.p-avatar-wrapper {
  width: 50px;
  height: 50px;
  border-radius: 50%; /* Làm avatar tròn */
  overflow: hidden;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0; /* Tránh bị méo khi thu nhỏ */
}

.patient-avatar-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.avatar-placeholder {
  color: #53ccab;
}

.p-name {
  font-weight: 700;
  font-size: 16px;
  margin: 0;
  color: white;
}
.p-info {
  font-size: 12px;
  opacity: 0.9;
  margin: 0;
  color: white;
}
.p-time {
  font-weight: 600;
  color: white;
}

/* --- CỘT STATUS (2 NÚT) --- */
.status-action-btns {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.btn-status-confirm {
  background-color: #28bf96 !important;
  color: white !important;
  border: none;
  padding: 8px 18px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-status-cancelled {
  background-color: #ff7676 !important;
  color: white !important;
  border: none;
  padding: 8px 18px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-status-confirm:hover,
.btn-status-cancelled:hover {
  filter: brightness(1.1);
  transform: translateY(-1px);
}

/* --- CỘT MORE ACTION --- */
.booking-actions-end {
  display: flex;
  justify-content: flex-end;
}

.btn-details-link {
  background: white !important;
  color: #4a4a4a !important;
  border: none;
  padding: 8px 20px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.2s;
}

.btn-details-link:hover {
  background: #f0fdfa !important;
  transform: scale(1.05);
}

.no-data-white {
  text-align: center;
  padding: 40px;
  color: white;
  opacity: 0.8;
  font-weight: 600;
}
/* --- LAYOUT CHUNG --- */
.booking-container {
  padding: 40px;
  background-color: #fcfdfd;
  min-height: 100vh;
  font-family: "Plus Jakarta Sans", sans-serif;
}

.highlight-text {
  color: #53ccab;
}
.booking-header {
  margin-bottom: 30px;
}

.booking-content {
  display: flex;
  gap: 40px;
  align-items: flex-start;
}

/* --- SIDEBAR LỊCH --- */
.calendar-aside {
  flex: 0 0 30%;
}

.custom-calendar-card {
  position: relative;
  background: #ffffff;
  padding: 25px;
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
}

.corner-decoration {
  position: absolute;
  width: 40px;
  height: 40px;
  border: 4px solid #53ccab;
  z-index: 1;
}
.top-left {
  top: -2px;
  left: -2px;
  border-right: none;
  border-bottom: none;
  border-top-left-radius: 16px;
}
.bottom-right {
  bottom: -2px;
  right: -2px;
  border-left: none;
  border-top: none;
  border-bottom-right-radius: 16px;
}

/* --- CUSTOM REACT-CALENDAR (SỬA LỖI MÀU) --- */
.custom-calendar-card .react-calendar {
  background: transparent !important;
  border: none !important;
  width: 100% !important;
  font-family: inherit;
}

/* Tiêu đề tháng và nút điều hướng */
.custom-calendar-card .react-calendar__navigation {
  display: flex;
  height: 50px;
  margin-bottom: 15px;
}

.custom-calendar-card .react-calendar__navigation button {
  color: #1e293b !important; /* Màu xám đen đậm - Rất rõ ràng */
  min-width: 44px;
  background: none;
  font-size: 18px;
  font-weight: 800;
}

.custom-calendar-card .react-calendar__navigation button:enabled:hover,
.custom-calendar-card .react-calendar__navigation button:enabled:focus {
  background-color: #f1f5f9 !important;
  color: #53ccab !important;
  border-radius: 8px;
}

/* Tên các thứ trong tuần */
.custom-calendar-card .react-calendar__month-view__weekdays__weekday abbr {
  text-decoration: none !important;
  color: #53ccab !important;
  font-weight: 700;
  font-size: 14px;
}

/* Các ô ngày */
.custom-calendar-card .react-calendar__tile {
  color: #475569 !important;
  font-weight: 600;
  padding: 12px 0 !important;
  border-radius: 8px;
}

/* Ngày thuộc tháng khác (neighboring months) - LÀM MỜ ĐI */
.custom-calendar-card .react-calendar__month-view__days__day--neighboringMonth {
  color: #cbd5e1 !important; /* Màu xám rất nhạt */
  font-weight: 400 !important;
}

/* Ngày đang chọn */
.custom-calendar-card .react-calendar__tile--active {
  background: #53ccab !important;
  color: white !important; /* Chữ trắng trên nền xanh */
  box-shadow: 0 4px 10px rgba(83, 204, 171, 0.4);
}

/* --- DANH SÁCH GRADIENT (Bên phải) --- */
.request-list-section {
  flex: 1;
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  border-radius: 30px;
  padding: 35px;
  color: white;
  box-shadow: 0 10px 30px rgba(83, 204, 171, 0.2);
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.booking-search {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  padding: 8px 15px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(255, 255, 255, 0.3);
}
.booking-search input {
  background: transparent;
  border: none;
  color: white;
  outline: none;
  width: 150px;
}
.booking-search input::placeholder {
  color: rgba(255, 255, 255, 0.7);
}

/* --- TABLE --- */
.booking-table {
  width: 100%;
  border-collapse: collapse;
}
.booking-table th {
  text-align: left;
  padding: 12px 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  font-size: 13px;
  letter-spacing: 0.5px;
  color: rgba(255, 255, 255, 0.9);
}
.booking-table td {
  padding: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.p-cell {
  display: flex;
  align-items: center;
  gap: 12px;
}
.p-avatar-wrapper {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  overflow: hidden;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
}
.patient-avatar-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.p-name {
  font-weight: 700;
  font-size: 15px;
  margin: 0;
  color: white;
}
.p-info {
  font-size: 12px;
  opacity: 0.85;
  margin: 0;
  color: white;
}
.p-time {
  font-weight: 700;
  color: white;
  font-size: 15px;
}

/* --- BUTTONS --- */
.status-action-btns {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.btn-details-link {
  background: white !important;
  color: #4a4a4a !important;
  border: none;
  padding: 8px 18px;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
}

.loader-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #53ccab;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

@import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap");

/* --- LAYOUT CHUNG --- */
.booking-container {
  padding: clamp(1rem, 3vw, 2.5rem);
  background-color: #fcfdfd;
  min-height: 100vh;
  font-family: "Plus Jakarta Sans", sans-serif;
  box-sizing: border-box;
}

.highlight-text {
  color: #53ccab;
}
.booking-header {
  margin-bottom: clamp(1.5rem, 4vw, 2.5rem);
}

.booking-content {
  display: flex;
  gap: clamp(1.5rem, 3vw, 2.5rem);
  align-items: flex-start;
}

/* --- SIDEBAR LỊCH (SCALE THEO MÀN HÌNH) --- */
.calendar-aside {
  flex: 0 0 30%; /* Giữ tỉ lệ đồng bộ với Appointment */
  min-width: 300px;
}

.custom-calendar-card {
  position: relative;
  background: #ffffff;
  padding: clamp(1rem, 2vw, 2rem);
  border: 1px solid #e2e8f0;
  border-radius: 1.5rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
}

.corner-decoration {
  position: absolute;
  width: clamp(30px, 5vw, 45px);
  height: clamp(30px, 5vw, 45px);
  border: 4px solid #53ccab;
  z-index: 1;
}
.top-left {
  top: -2px;
  left: -2px;
  border-right: none;
  border-bottom: none;
  border-top-left-radius: 1.5rem;
}
.bottom-right {
  bottom: -2px;
  right: -2px;
  border-left: none;
  border-top: none;
  border-bottom-right-radius: 1.5rem;
}

/* --- CUSTOM REACT-CALENDAR (SCALE Ô VÀ CHỮ) --- */
.custom-calendar-card .react-calendar {
  background: transparent !important;
  border: none !important;
  width: 100% !important;
  font-family: inherit;
  font-size: clamp(0.85rem, 1.1vw, 1.1rem) !important;
}

.custom-calendar-card .react-calendar__navigation {
  display: flex;
  height: 50px;
  margin-bottom: 1rem;
}

.custom-calendar-card .react-calendar__navigation button {
  color: #1e293b !important;
  min-width: 44px;
  background: none;
  font-size: clamp(1rem, 1.3vw, 1.25rem) !important;
  font-weight: 800;
}

.custom-calendar-card .react-calendar__navigation button:enabled:hover {
  background-color: #f1f5f9 !important;
  border-radius: 0.5rem;
}

.custom-calendar-card .react-calendar__month-view__weekdays__weekday abbr {
  text-decoration: none !important;
  color: #53ccab !important;
  font-weight: 700;
  font-size: 0.85rem;
}

/* Scale chiều cao ô ngày theo chiều cao màn hình (vh) */
.custom-calendar-card .react-calendar__tile {
  color: #475569 !important;
  font-weight: 600;
  padding: clamp(0.8rem, 1.8vh, 1.4rem) 0 !important;
  border-radius: 0.75rem;
}

.custom-calendar-card .react-calendar__month-view__days__day--neighboringMonth {
  color: #cbd5e1 !important;
  font-weight: 400 !important;
}

.custom-calendar-card .react-calendar__tile--active {
  background: #53ccab !important;
  color: white !important;
  box-shadow: 0 4px 10px rgba(83, 204, 171, 0.4);
}

/* --- DANH SÁCH GRADIENT (Bên phải) --- */
.request-list-section {
  flex: 1;
  background: linear-gradient(135deg, #c6f2e6 0%, #53ccab 100%);
  border-radius: 2rem;
  padding: clamp(1.5rem, 2.5vw, 2.5rem);
  color: white;
  box-shadow: 0 10px 30px rgba(83, 204, 171, 0.2);
  overflow-x: auto;
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.list-header h2 {
  font-size: clamp(1.1rem, 1.5vw, 1.4rem);
  margin: 0;
}

.booking-search {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  padding: 0.6rem 1.2rem;
  border-radius: 0.8rem;
  display: flex;
  align-items: center;
  gap: 0.6rem;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.booking-search input {
  background: transparent;
  border: none;
  color: white;
  outline: none;
  width: clamp(120px, 10vw, 180px);
  font-size: 0.9rem;
}

/* --- TABLE RESPONSIVE --- */
.booking-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 600px;
}

.booking-table th {
  text-align: left;
  padding: 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  font-size: 0.75rem;
  letter-spacing: 0.5px;
  color: rgba(255, 255, 255, 0.9);
}

.p-cell {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.p-avatar-wrapper {
  width: clamp(40px, 4vw, 48px);
  height: clamp(40px, 4vw, 48px);
  border-radius: 50%;
  overflow: hidden;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.p-name {
  font-weight: 700;
  font-size: clamp(0.85rem, 1.1vw, 1rem);
  margin: 0;
}
.p-info {
  font-size: 0.75rem;
  opacity: 0.85;
}
.p-time {
  font-weight: 700;
  font-size: 0.9rem;
}

/* --- BUTTONS SCALE --- */
.status-action-btns {
  display: flex;
  gap: 0.5rem;
}

.btn-status-confirm,
.btn-status-cancelled,
.btn-details-link {
  padding: 0.6rem clamp(0.8rem, 1.2vw, 1.2rem);
  border-radius: 0.6rem;
  font-size: 0.8rem;
  font-weight: 700;
  cursor: pointer;
  white-space: nowrap;
}

/* --- RESPONSIVE BREAKPOINTS --- */
@media (max-width: 1100px) {
  .booking-content {
    flex-direction: column; /* Lịch nhảy lên trên bảng */
    align-items: center;
  }
  .calendar-aside {
    width: 100%;
    max-width: 400px;
  }
  .request-list-section {
    width: 100%;
  }
}

@media (max-width: 600px) {
  .booking-container {
    padding: 1rem;
  }
  .status-action-btns {
    flex-direction: column;
  }
}

-e \n[END OF FILE]\n
frontend/src/pages/doctor/History.css
------------------------------------------
.history-container {
    padding: 40px;
    background-color: #fcfdfd;
    min-height: 100vh;
  }
  
  .highlight-green { color: #53CCAB; border-bottom: 2px solid #53CCAB; }
  
  .history-content {
    display: flex;
    gap: 30px;
    margin-top: 40px;
  }
  
  /* SIDEBAR */
  .history-sidebar { flex: 0 0 320px; display: flex; flex-direction: column; gap: 20px; }
  
  .calendar-card-white, .filter-card-white {
    background: white;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    border: 1px solid #f0f0f0;
  }
  
  .filter-card-white h3 { font-size: 16px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
  .filter-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
  .filter-group label { font-size: 14px; color: #666; display: flex; align-items: center; gap: 10px; cursor: pointer; }
  
  /* LIST SECTION */
  .history-list-section { flex: 1; }
  .list-white-box {
    background: white;
    padding: 30px;
    border-radius: 25px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.04);
  }
  
  .history-search {
    background: #f5f7f9;
    padding: 8px 15px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    width: 300px;
  }
  .history-search input { border: none; background: transparent; outline: none; width: 100%; }
  
  /* TABLE */
  .history-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  .history-table th { text-align: left; padding: 15px; color: #8e96a3; font-weight: 600; border-bottom: 1px solid #f0f0f0; }
  .history-table td { padding: 20px 15px; border-bottom: 1px solid #f9f9f9; }
  
  .p-cell { display: flex; align-items: center; gap: 12px; }
  .p-avatar-circle {
    width: 45px; height: 45px;
    border-radius: 50%;
    border: 1px solid #53CCAB;
    overflow: hidden;
    display: flex; align-items: center; justify-content: center;
  }
  .p-avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
  
  .p-name { font-weight: 700; color: #333; margin: 0; }
  .p-info { font-size: 12px; color: #999; margin: 0; }
  .p-diagnosis { color: #666; font-size: 14px; font-style: italic; }
  
  /* ACTIONS */
  .btn-view-records {
    background: transparent;
    color: #53CCAB;
    border: 1px solid #53CCAB;
    padding: 6px 15px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }
  .btn-view-records:hover { background: #53CCAB; color: white; }
  
  /* FOOTER & EXPORT */
  .history-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 25px;
  }
  .pagination { display: flex; gap: 15px; align-items: center; color: #999; }
  .active-page {
    background: #53CCAB;
    color: white;
    width: 30px; height: 30px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%;
  }
  
  .btn-export {
    background: #fff9e6;
    color: #f4b400;
    border: 1px solid #ffeeba;
    padding: 8px 20px;
    border-radius: 10px;
    display: flex; align-items: center; gap: 8px;
    font-weight: 600;
    cursor: pointer;
  }

  /* --- 1. SỬA MÀU CHỮ TRONG LỊCH (CALENDAR) --- */
.calendar-card-white .react-calendar {
    background: white !important;
    border: none !important;
    font-family: 'Plus Jakarta Sans', sans-serif;
  }
  
  /* Màu các thứ trong tuần (S, M, T...) */
  .calendar-card-white .react-calendar__month-view__weekdays__weekday abbr {
    text-decoration: none !important;
    color: #53CCAB !important; /* Màu xanh thương hiệu */
    font-weight: 700;
  }
  
  /* Màu các con số ngày - ĐÃ SỬA THÀNH MÀU ĐẬM */
  .calendar-card-white .react-calendar__tile {
    color: #333333 !important; /* Màu xám đậm dễ nhìn */
    font-weight: 600;
    padding: 12px 0 !important;
  }
  
  /* Ngày của tháng trước/sau (làm mờ nhẹ nhưng vẫn nhìn rõ) */
  .calendar-card-white .react-calendar__month-view__days__day--neighboringMonth {
    color: #b0b0b0 !important;
  }
  
  /* --- 2. SỬA MÀU CHỮ CỘT APPOINTMENT (THỜI GIAN) --- */
  .history-table td.p-time {
    color: #4A4A4A !important; /* Màu xám đậm thay vì màu trắng */
    font-weight: 700;
    font-size: 15px;
  }
  
  /* Đảm bảo chữ trong toàn bộ bảng là màu đậm */
  .history-table td {
    color: #333333;
  }
  
  /* --- 3. ĐIỀU CHỈNH CỘT DIAGNOSIS (CHẨN ĐOÁN) --- */
  .p-diagnosis {
    color: #666666 !important;
    font-size: 14px;
    font-style: italic;
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; /* Nếu chẩn đoán quá dài sẽ hiện dấu ... */
  }
  
  /* --- 4. TRẠNG THÁI NGÀY ĐƯỢC CHỌN --- */
  .calendar-card-white .react-calendar__tile--active {
    background: #53CCAB !important;
    color: white !important; /* Chỉ khi chọn mới hiện chữ trắng trên nền xanh */
    border-radius: 8px;
  }

  /* --- SỬA MÀU TÊN THÁNG/NĂM VÀ CÁC MŨI TÊN --- */

/* 1. Tên tháng/năm chính giữa (ví dụ: October 2026) */
.calendar-card-white .react-calendar__navigation__label__textContent {
    color: #333333 !important;
    font-weight: 700;
    font-size: 18px;
  }
  
  /* 2. Các nút mũi tên (<, >, <<, >>) */
  .calendar-card-white .react-calendar__navigation button {
    color: #53CCAB !important; /* Màu xanh cho mũi tên để tạo điểm nhấn */
    font-size: 22px;
    min-width: 44px;
    background: none;
  }
  
  .calendar-card-white .react-calendar__navigation button:enabled:hover,
  .calendar-card-white .react-calendar__navigation button:enabled:focus {
    background-color: #f0fdfa !important;
    border-radius: 8px;
  }
  
  /* 3. Đảm bảo tên các thứ (Mon, Tue...) luôn đậm */
  .calendar-card-white .react-calendar__month-view__weekdays__weekday abbr {
    color: #53CCAB !important;
    text-decoration: none !important;
    font-weight: 800;
  }
  
  /* 4. Màu số ngày trong lịch (đã sửa) */
  .calendar-card-white .react-calendar__tile {
    color: #4A4A4A !important;
    font-weight: 600;
  }
  
  /* --- SỬA MÀU CỘT APPOINTMENT TIME --- */
  .p-time {
    color: #333333 !important; /* Chuyển từ trắng sang xám đậm */
    font-weight: 700;
  }
  
  /* --- SỬA CÁC ICON TRONG BẢNG (NẾU CÓ) --- */
  .history-table .lucide {
    color: #666666 !important; /* Màu cho các icon search, user... */
  }
  
  /* Header bảng (Patient name, Appointment...) */
  .history-table th {
    color: #8e96a3 !important;
    background-color: #fcfdfd;
  }

  /* --- CĂN CHỈNH NGÀY NGOÀI THÁNG TRONG LỊCH TRẮNG --- */

/* 1. Làm mờ các ngày thuộc tháng trước và tháng sau */
.calendar-card-white .react-calendar__month-view__days__day--neighboringMonth {
    color: #cbd5e1 !important; /* Màu xám nhạt */
    font-weight: 400 !important; /* Chữ mảnh hơn để tạo sự khác biệt */
}

/* 2. Đảm bảo các ngày này không có hiệu ứng hover quá đậm */
.calendar-card-white .react-calendar__month-view__days__day--neighboringMonth:enabled:hover {
    background-color: #f8fafc !important;
    color: #94a3b8 !important;
}

/* 3. Giữ nguyên màu đậm cho các ngày TRONG tháng hiện tại để đối lập */
.calendar-card-white .react-calendar__tile:not(.react-calendar__month-view__days__day--neighboringMonth) {
    color: #1e293b !important;
    font-weight: 600;
}
/* Tìm và sửa đoạn này trong History.css */
.calendar-card-white .react-calendar__tile--active {
    background: #28BF96 !important; /* Màu nền xanh thương hiệu */
    color: white !important;        /* Chữ trắng */
    border-radius: 10px;
}

/* Đảm bảo nội dung bên trong (thẻ abbr) cũng nhận màu trắng */
.calendar-card-white .react-calendar__tile--active abbr {
    color: white !important;
}-e \n[END OF FILE]\n
frontend/src/pages/doctor/Notifications.css
------------------------------------------
.notif-container {
    padding: 40px;
    background-color: #fcfdfd;
    min-height: 100vh;
  }
  
  .notif-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
  }
  
  .notif-header h1 { font-size: 28px; font-weight: 800; color: #333; }
  .highlight-green { color: #53CCAB; }
  .notif-header p { color: #8e96a3; margin-top: 5px; }
  
  .btn-mark-all {
    background: #53CCAB;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
  }
  
  .notif-card {
    background: white;
    border-radius: 20px;
    border: 1px solid #eee;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.02);
  }
  
  .notif-toolbar {
    display: flex;
    justify-content: space-between;
    padding: 20px 30px;
    border-bottom: 1px solid #f5f5f5;
  }
  
  .notif-tabs { display: flex; gap: 30px; }
  .tab-item {
    background: none;
    border: none;
    font-weight: 600;
    color: #8e96a3;
    cursor: pointer;
    padding-bottom: 5px;
    position: relative;
  }
  .tab-item.active { color: #333; }
  .tab-item.active::after {
    content: "";
    position: absolute;
    bottom: -21px; left: 0; width: 100%; height: 3px;
    background: #333;
  }
  
  .notif-search-box {
    background: #f5f7f9;
    border-radius: 20px;
    padding: 8px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    width: 300px;
  }
  .notif-search-box input { border: none; background: none; outline: none; width: 100%; }
  
  /* Notif Item */
  .notif-item {
    display: flex;
    justify-content: space-between;
    padding: 25px 30px;
    border-bottom: 1px solid #f5f5f5;
    transition: 0.2s;
  }
  .notif-item:hover { background-color: #f9fbfb; }
  
  .notif-left { display: flex; gap: 20px; align-items: center; }
  
  .notif-icon-box {
    width: 50px; height: 50px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
  }
  .bg-mint { background: #e6f7f3; }
  .bg-rose { background: #ffebeb; }
  .bg-blue { background: #ebf3ff; }
  
  .notif-content h4 { font-size: 16px; margin: 0; color: #333; display: flex; align-items: center; gap: 8px; }
  .unread-dot { width: 8px; height: 8px; background: #53CCAB; border-radius: 50%; }
  .notif-content p { margin: 5px 0 0; color: #8e96a3; font-size: 14px; }
  
  .notif-right { text-align: right; display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end; }
  .notif-time { font-size: 13px; color: #b0b0b0; }
  .btn-more { background: none; border: none; color: #b0b0b0; cursor: pointer; }
  
  .btn-view-older {
    width: 100%; padding: 20px; background: none; border: none;
    color: #53CCAB; font-weight: 600; cursor: pointer; text-align: center;
  }

  /* Màu nền cho Icon Box theo thiết kế */
.bg-mint-light {
    background-color: #E2FFF7; /* Xanh mint nhạt */
  }
  
  .bg-rose-light {
    background-color: #FFE9E9; /* Hồng nhạt */
  }
  
  .bg-blue-light {
    background-color: #EBF3FF; /* Xanh dương nhạt */
  }
  
  .bg-gray-light {
    background-color: #F5F5F5;
  }
  
  /* Định dạng Icon SVG */
  .notif-icon-box {
    width: 48px;
    height: 48px;
    border-radius: 10px; /* Bo góc nhẹ như ảnh */
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .notif-svg-icon {
    width: 24px;
    height: 24px;
  }
  
  /* Hiệu ứng dòng chưa đọc */
  .unread-row {
    background-color: #F8FAFC; /* Nền xanh cực nhẹ cho dòng chưa đọc */
  }
  
  .unread-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    background-color: #2DD4BF; /* Màu mint đậm */
    border-radius: 50%;
    margin-left: 6px;
  }
  
  /* Nút View older ở cuối */
  .view-older-box {
    padding: 20px;
    text-align: center;
    border-top: 1px solid #eee;
  }
  
  .btn-view-older {
    color: #53CCAB;
    font-weight: 600;
    background: none;
    border: none;
    cursor: pointer;
  }
  .notif-icon-box {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    overflow: hidden; /* Đảm bảo icon không tràn ra ngoài */
  }
  
  .notif-svg-icon {
    width: 24px;   /* Ép kích thước cố định */
    height: 24px;
    display: block;
    object-fit: contain; /* Giữ tỷ lệ icon */
  }
  
  /* Thêm màu sắc cho box nếu cần */
  .bg-mint-light { background-color: #e2fff7; }
  .bg-rose-light { background-color: #ffe9e9; }
  .bg-gray-light { background-color: #f5f5f5; }
  /* Thêm class này vào cuối file CSS của bạn */
.unread-dot.dot-red {
    background-color: #FF4D4F; /* Màu đỏ thông báo */
  }-e \n[END OF FILE]\n
frontend/src/pages/doctor/Profile.css
------------------------------------------
.profile-page-container {
    padding: 40px;
    background-color: #fcfcfc;
    min-height: 100vh;
}

.profile-header-text {
    margin-bottom: 30px;
}

.profile-content-layout {
    display: flex;
    gap: 30px;
    align-items: flex-start;
}

/* LEFT CARD */
.profile-left-card {
    flex: 1;
    max-width: 350px;
}

.doctor-card {
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.image-wrapper {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
}

.main-avatar {
    width: 100%;
    height: 320px;
    object-fit: cover;
}

.change-photo-btn {
    position: absolute;
    bottom: 15px;
    right: 15px;
    border-radius: 8px;
    font-size: 12px;
}

.doctor-info-summary {
    padding: 15px 0;
}

.specialist-desc {
    font-size: 12px;
    display: block;
    line-height: 1.4;
}

.stats-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

/* RIGHT FORM */
.profile-right-form {
    flex: 2;
}

.form-card {
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    padding: 10px;
}

.form-row {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.form-row .label {
    width: 180px;
    font-size: 15px;
    color: #555;
}

.custom-input, .custom-select {
    flex: 1;
    background-color: #f5f7f9 !important;
    border: none !important;
    border-radius: 10px !important;
    padding: 8px 15px !important;
}

.custom-select .ant-select-selector {
    background-color: #f5f7f9 !important;
    border: none !important;
}

/* ACTIONS */
.profile-actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 30px;
}

.logout-btn {
    border-color: #ffccc7;
    color: #f5222d;
    border-radius: 8px;
}

.save-btn {
    background-color: #4cc9b0 !important;
    border-color: #4cc9b0 !important;
    border-radius: 8px;
    min-width: 150px;
}

.save-btn:hover {
    background-color: #3ba892 !important;
}

.profile-page-container {
    padding: 30px 50px;
    background-color: #f8fafc;
    min-height: 100vh;
}

.loading-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 80vh;
}

.profile-header-text { margin-bottom: 25px; }

.profile-content-layout {
    display: flex;
    gap: 40px;
}

/* LEFT SIDE CARD */
.profile-left-card { flex: 0 0 350px; }

.doctor-card {
    border-radius: 24px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.03);
    padding: 10px;
}

.image-wrapper {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    height: 380px;
}

.main-avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.change-photo-btn {
    position: absolute;
    bottom: 15px;
    right: 15px;
    border-radius: 10px;
    font-size: 13px;
    height: 38px;
    border: none;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.doctor-info-summary {
    padding: 20px 5px;
    text-align: left;
}

.dr-name-title { margin-bottom: 4px !important; }

.verified-icon { color: #4cc9b0; margin-left: 5px; }

.dept-tag {
    color: #4cc9b0;
    font-weight: 600;
    font-size: 12px;
    letter-spacing: 0.5px;
}

.specialist-desc {
    font-size: 13px;
    color: #64748b;
    margin-top: 10px;
    line-height: 1.6;
}

.stats-footer {
    display: flex;
    justify-content: space-between;
    padding-top: 15px;
    border-top: 1px solid #f1f5f9;
}

/* RIGHT SIDE FORM */
.profile-right-form { flex: 1; }

.form-card {
    border-radius: 24px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.03);
    padding: 20px;
}

.form-row {
    display: flex;
    align-items: center;
    margin-bottom: 18px;
}

.form-row .label {
    width: 160px;
    font-weight: 500;
    color: #475569;
}

.custom-input, .custom-select {
    flex: 1;
    background-color: #f1f5f9 !important;
    border: none !important;
    border-radius: 12px !important;
    height: 45px !important;
    display: flex;
    align-items: center;
}

.custom-select .ant-select-selector {
    background-color: transparent !important;
    border: none !important;
    height: 45px !important;
    padding-top: 7px !important;
}

.readonly-input {
    color: #94a3b8 !important;
    cursor: not-allowed;
}

.edit-pen { color: #94a3b8; cursor: pointer; }

/* ACTIONS */
.profile-actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 25px;
}

.logout-btn {
    border: 1px solid #fecaca;
    color: #ef4444;
    border-radius: 12px;
    height: 45px;
    padding: 0 25px;
}

.save-btn {
    background-color: #4cc9b0 !important;
    border: none !important;
    border-radius: 12px;
    height: 45px;
    padding: 0 40px;
    font-weight: 600;
}

.save-btn:hover { background-color: #3ba892 !important; }-e \n[END OF FILE]\n
frontend/src/pages/doctor/Appointments.tsx
------------------------------------------
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import Calendar from "react-calendar";
import "react-calendar/dist/Calendar.css";
import { Search, User } from "lucide-react";
import "./Appointments.css";
import MedicalExamModal from "./MedicalExamModal";
import MedicalRecordDetailModal from "./MedicalRecorđetailModal";

const DoctorAppointment: React.FC = () => {
  const [appointments, setAppointments] = useState<any[]>([]);
  const [doctor, setDoctor] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedApptForExam, setSelectedApptForExam] = useState<any>(null);
  const [selectedApptForDetails, setSelectedApptForDetails] =
    useState<any>(null);

  const fetchData = async () => {
    try {
      setLoading(true);
      const doctorId = localStorage.getItem("doctorId");
      const token = localStorage.getItem("token");

      if (doctorId) {
        const [docRes, apptRes] = await Promise.all([
          axios.get(`http://localhost:3000/api/doctors/${doctorId}`, {
            headers: { Authorization: `Bearer ${token}` },
          }),
          axios.get("http://localhost:3000/api/appointments", {
            headers: { Authorization: `Bearer ${token}` },
          }),
        ]);
        setDoctor(docRes.data);

        const processed = apptRes.data
          .filter((apt: any) => String(apt.doctor?.userId) === String(doctorId))
          .map((apt: any) => ({
            ...apt,
            displayStatus:
              apt.status?.toLowerCase() === "confirmed"
                ? "waiting"
                : apt.status?.toLowerCase(),
          }));
        setAppointments(processed);
      }
    } catch (error) {
      console.error("Data fetch error", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  const stats = useMemo(() => {
    const total = appointments.length || 0;
    const getCount = (s: string) =>
      appointments.filter((a) => a.displayStatus === s).length;
    const getPct = (val: number) =>
      total > 0 ? Math.round((val / total) * 100) : 0;

    return {
      waiting: getCount("waiting"),
      completed: getCount("completed"),
      cancelled: getCount("cancelled"),
      pending: getCount("pending"),
      total,
    };
  }, [appointments]);

  const filteredData = useMemo(() => {
    const dStr = selectedDate.toLocaleDateString("en-CA");

    // 1. Lọc dữ liệu theo ngày và từ khóa tìm kiếm
    const filtered = appointments.filter(
      (a) =>
        a.appointment_date === dStr &&
        a.patient?.fullName?.toLowerCase().includes(searchTerm.toLowerCase()) &&
        a.displayStatus !== "pending"
    );

    // 2. Sắp xếp theo giờ hẹn (từ sáng đến chiều)
    return filtered.sort((a, b) => {
      // Giả sử appointment_time là chuỗi dạng "HH:mm" hoặc "HH:mm:ss"
      // So sánh chuỗi trực tiếp hoạt động tốt cho định dạng 24h
      if (a.appointment_time < b.appointment_time) return -1;
      if (a.appointment_time > b.appointment_time) return 1;
      return 0;
    });
  }, [appointments, searchTerm, selectedDate]);
  if (loading)
    return (
      <div className="loader">
        <div className="spinner"></div>
      </div>
    );

  return (
    <div className="appt-container">
      {selectedApptForExam && (
        <MedicalExamModal
          appointment={selectedApptForExam}
          onClose={(upd) => {
            setSelectedApptForExam(null);
            if (upd) fetchData();
          }}
        />
      )}

      <header className="appt-header">
        <div className="welcome-box">
          <h1 className="welcome-title">
            <span className="doctor-highlight">Dr. {doctor?.fullName}'s</span>{" "}
            Appointment
          </h1>
          <p>Manage your daily patients and schedule efficiently.</p>
        </div>

        {/* STATS BOX VỚI NỀN GRADIENT VÀ % CÓ MÀU RIÊNG */}
        <div className="stats-gradient-main">
          <StatPill
            label="Waiting"
            value={stats.waiting}
            total={stats.total}
            type="waiting"
          />
          <div className="v-divider" />
          <StatPill
            label="Completed"
            value={stats.completed}
            total={stats.total}
            type="completed"
          />
          <div className="v-divider" />
          <StatPill
            label="Cancelled"
            value={stats.cancelled}
            total={stats.total}
            type="cancelled"
          />
          <div className="v-divider" />
          <StatPill
            label="Pending"
            value={stats.pending}
            total={stats.total}
            type="pending"
          />
        </div>
      </header>

      <div className="appt-content">
        <aside className="calendar-sidebar">
          <div className="calendar-card-gradient">
            <Calendar
              onChange={(v: any) => setSelectedDate(v)}
              value={selectedDate}
              className="custom-calendar-ui"
            />
          </div>
        </aside>

        <section className="main-list-card">
          <div className="list-header">
            <h2>Schedule: {selectedDate.toLocaleDateString("en-GB")}</h2>
            <div className="search-wrapper">
              <Search size={18} color="#94a3b8" />
              <input
                placeholder="Search patient..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
          </div>

          <table className="appt-table-modern">
            <thead>
              <tr>
                <th>Patient</th>
                <th>Time</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {filteredData.map((apt) => (
                <tr key={apt.id}>
                  <td>
                    <div className="p-cell">
                      <div className="p-avatar-box">
                        {apt.patient?.user?.avatar ? (
                          <img
                            src={`http://localhost:3000${apt.patient.user.avatar}`}
                            alt=""
                          />
                        ) : (
                          <User size={18} />
                        )}
                      </div>
                      <div>
                        <p className="p-name">{apt.patient?.fullName}</p>
                        <p className="p-info">
                          {apt.patient?.gender} • {apt.patient?.age || 28} Years
                        </p>
                      </div>
                    </div>
                  </td>
                  <td className="p-time-cell">{apt.appointment_time}</td>
                  <td>
                    <span className={`status-tag ${apt.displayStatus}`}>
                      {apt.displayStatus}
                    </span>
                  </td>
                  <td>
                    <div className="p-actions">
                      {apt.displayStatus === "waiting" && (
                        <button
                          className="btn-start"
                          onClick={() => setSelectedApptForExam(apt)}
                        >
                          Start Exam
                        </button>
                      )}
                      <button
                        className="btn-view"
                        onClick={() => setSelectedApptForDetails(apt)}
                      >
                        Details
                      </button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </section>
      </div>
      {selectedApptForDetails && (
        <MedicalRecordDetailModal
          appointment={selectedApptForDetails}
          onClose={() => setSelectedApptForDetails(null)}
        />
      )}
    </div>
  );
};

// Component con cho Stat Pill
const StatPill = ({ label, value, total, type }: any) => {
  const pct = total > 0 ? Math.round((value / total) * 100) : 0;
  return (
    <div className="stat-pill-item">
      <span className="stat-label-text">{label}</span>
      <div className="stat-number-row">
        <span className="stat-main-val">{value}</span>
        <span className={`stat-pct-tag pct-${type}`}>{pct}%</span>
      </div>
    </div>
  );
};

export default DoctorAppointment;
-e \n[END OF FILE]\n
frontend/src/pages/Login.css
------------------------------------------
/* 1. Reset và chuẩn hóa */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Inter", sans-serif; /* Font sạch giống mẫu */
}

.page-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100vw;
  height: 100vh;
  background-color: #090b0c;
  overflow: hidden;
  padding: 20px;
}

/* 2. Card trung tâm */
.login-card {
  display: flex;
  width: 90vw;
  max-width: 2000px;
  height: 80vh; /* Chiếm 80% chiều cao màn hình */
  min-height: 650px;
  max-height: 80vh;
  background-color: #141619;
  border-radius: 24px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.03);
  /* box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6); */
}

/* 3. Phần Form bên trái */
.login-left {
  flex: 45; /* Form rộng hơn ảnh một chút để thoáng */
  padding: clamp(30px, 5vh, 80px);
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.content-box {
  width: 100%;
  max-width: 700px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  /* Khoảng cách lớn giữa các khối nội dung chính */
  gap: clamp(25px, 4.5vh, 45px);
}

/* 4. Logo và Tiêu đề */
.logo {
  /* 1. Sử dụng chiều rộng làm gốc để scale theo bề ngang màn hình */
  width: 40vw; /* Logo chiếm 15% chiều rộng màn hình */
  min-width: 120px; /* Không để logo quá nhỏ trên mobile */
  max-width: 400px; /* Không để logo quá to trên màn hình lớn */

  /* 2. Giữ tỉ lệ ảnh */
  height: auto;
  object-fit: contain;

  /* 3. Căn chỉnh */
  align-self: flex-start;
  object-fit: contain;
  align-self: flex-start;
  margin-bottom: -40px;
  /* margin-top: -30px; */
}

.welcome-text h1 {
  color: #ffffff;
  font-size: clamp(26px, 4vh, 38px);
  font-weight: 550;
  margin-bottom: 8px;
}

.welcome-text p {
  color: #abb2bf;
  font-size: clamp(14px, 1.8vh, 16px);
  opacity: 0.8;
}

/* 5. Cụm Ô nhập liệu (Inputs) */
.input-group {
  display: flex;
  flex-direction: column;
  gap: 12px; /* Khoảng cách từ label xuống ô nhập */
}

.input-group label {
  color: #abb2bf;
  font-size: 18px;
  font-weight: 500;
  margin-top: 30px;
}

.input-field {
  display: flex;
  align-items: center;
  background-color: #1a1d21;
  border: 1px solid #363a3d; /* Viền mỏng tinh tế giống mẫu */
  border-radius: 12px;
  padding: clamp(8px, 1.2vh, 14px) 20px;
  transition: all 0.3s ease;
}

.input-field:focus-within {
  border-color: #24ae8f;
  box-shadow: 0 0 0 1px #24ae8f;
}

/* Style riêng cho ô Password đang active trong hình */
.password-active {
  border-color: #24ae8f;
}

.input-field img {
  width: 20px;
  height: 20px;
  margin-right: 15px;
  opacity: 0.5;
}

.input-field input {
  flex: 1;
  background: transparent;
  border: none;
  color: white;
  outline: none;
  font-size: 16px;
}

/* 6. Nút bấm và Divider */
.btn-login {
  width: 100%;
  padding: clamp(10px, 1.5vh, 15px);
  background-color: #24ae8f;
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 400;
  cursor: pointer;
  margin-top: 50px;
  margin-bottom: 20px;
}

.divider {
  text-align: center;
  color: #abb2bf;
  font-size: 14px;
  position: relative;
}

.btn-signup {
  width: 100%;
  padding: clamp(10px, 1.5vh, 15px);
  background-color: #ffffff;
  color: #24ae8f;
  border: 3px solid #24ae8f;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 400;
  cursor: pointer;
  margin-top: 20px;
}

/* 7. Phần ảnh bên phải (Tràn viền) */
.login-right {
  flex: 55;
  height: 100%;
  padding: 0; /* Xóa padding để ảnh chiếm hết chiều cao */
}

.banner-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  /* Giữ bo góc cho phía bên phải của card */
  border-radius: 24px;
}

/* 8. Responsive Mobile */
@media (max-width: 900px) {
  .login-card {
    flex-direction: column;
    height: auto;
    width: 95vw;
    margin: 20px 0;
  }
  .login-right {
    display: none;
  }
  .login-left {
    padding: 40px 20px;
  }
}
-e \n[END OF FILE]\n
frontend/src/pages/SignUp.tsx
------------------------------------------
import React, { useState } from "react";
import {
  Form,
  Input,
  Button,
  DatePicker,
  Select,
  Card,
  Typography,
  message,
  Steps,
  Upload, // Thêm Upload
} from "antd";
import {
  UserOutlined,
  MailOutlined,
  LockOutlined,
  PhoneOutlined,
  HomeOutlined,
  IdcardOutlined,
  UploadOutlined, // Thêm icon
} from "@ant-design/icons";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import "./SignUp.css";

const { Title, Text } = Typography;

const SignUp: React.FC = () => {
  const [currentStep, setCurrentStep] = useState(0);
  const [loading, setLoading] = useState(false);
  const [fileList, setFileList] = useState<any[]>([]); // Quản lý file ảnh
  const [form] = Form.useForm();
  const navigate = useNavigate();

  const handleSignUp = async (values: any) => {
    setLoading(true);
    try {
      // BƯỚC 1: Tạo tài khoản User
      const registerRes = await axios.post(
        "http://localhost:3000/api/auth/register",
        {
          email: values.email,
          username: values.username,
          password: values.password,
          fullName: values.fullName,
        }
      );

      const userId =
        registerRes.data.id ||
        registerRes.data.userId ||
        registerRes.data.data?.id;

      if (!userId)
        throw new Error("Không lấy được ID người dùng sau khi đăng ký");

      // BƯỚC 2: Tạo hồ sơ Patient
      await axios.post("http://localhost:3000/api/patients", {
        userId: String(userId),
        fullName: values.fullName,
        gender: values.gender,
        dateOfBirth: values.dateOfBirth.format("YYYY-MM-DD"),
        phone: values.phone,
        address: values.address,
        healthInsuranceNumber: values.healthInsuranceNumber,
      });

      // BƯỚC 3: Upload Avatar (Nếu người dùng có chọn ảnh)
      if (fileList.length > 0) {
        const formData = new FormData();
        formData.append("file", fileList[0].originFileObj); // "file" phải khớp với tên trong Backend

        await axios.post(
          `http://localhost:3000/api/users/upload-avatar/${userId}`,
          formData,
          {
            headers: { "Content-Type": "multipart/form-data" },
          }
        );
      }

      message.success("Đăng ký tài khoản và tải ảnh đại diện thành công!");
      navigate("/login");
    } catch (error: any) {
      console.error("Lỗi đăng ký:", error.response?.data);
      message.error(
        error.response?.data?.message || "Đăng ký thất bại, vui lòng thử lại."
      );
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="signup-container">
      <Card className="signup-card shadow-lg">
        <div className="signup-header">
          <Title level={2}>Đăng ký tài khoản</Title>
          <Text type="secondary">Tham gia MediBook để quản lý sức khỏe của bạn</Text>
        </div>

        <Steps
          current={currentStep}
          className="signup-steps"
          items={[{ title: "Tài khoản" }, { title: "Thông tin" }]}
        />

        <Form
          form={form}
          layout="vertical"
          onFinish={handleSignUp}
          initialValues={{ gender: "man" }}
        >
          {/* STEP 0: THÔNG TIN AUTH */}
          <div style={{ display: currentStep === 0 ? "block" : "none" }}>
            <Form.Item
              name="fullName"
              label="Họ và tên"
              rules={[{ required: true, message: "Vui lòng nhập họ tên" }]}
            >
              <Input prefix={<UserOutlined />} placeholder="Nguyễn Văn A" />
            </Form.Item>
            <Form.Item
              name="email"
              label="Email"
              rules={[{ required: true, type: "email" }]}
            >
              <Input prefix={<MailOutlined />} placeholder="test@gmail.com" />
            </Form.Item>
            <Form.Item
              name="username"
              label="Tên đăng nhập"
              rules={[{ required: true, min: 4 }]}
            >
              <Input prefix={<UserOutlined />} placeholder="testuser123" />
            </Form.Item>
            <Form.Item
              name="password"
              label="Mật khẩu"
              rules={[{ required: true, min: 6 }]}
            >
              <Input.Password prefix={<LockOutlined />} placeholder="******" />
            </Form.Item>
            <Button type="primary" block onClick={() => setCurrentStep(1)}>
              Tiếp theo
            </Button>
          </div>

          {/* STEP 1: THÔNG TIN PATIENT & AVATAR */}
          <div style={{ display: currentStep === 1 ? "block" : "none" }}>
            
            {/* PHẦN UPLOAD ẢNH */}
            <Form.Item label="Ảnh đại diện">
              <Upload
                listType="picture-card"
                fileList={fileList}
                onChange={({ fileList }) => setFileList(fileList)}
                beforeUpload={() => false} // Chặn tự động upload của AntD
                maxCount={1}
              >
                {fileList.length < 1 && (
                  <div>
                    <UploadOutlined />
                    <div style={{ marginTop: 8 }}>Tải ảnh</div>
                  </div>
                )}
              </Upload>
            </Form.Item>

            <div className="form-grid">
              <Form.Item name="gender" label="Giới tính" rules={[{ required: true }]}>
                <Select>
                  <Select.Option value="man">Nam</Select.Option>
                  <Select.Option value="woman">Nữ</Select.Option>
                  <Select.Option value="other">Khác</Select.Option>
                </Select>
              </Form.Item>
              <Form.Item
                name="dateOfBirth"
                label="Ngày sinh"
                rules={[{ required: true }]}
              >
                <DatePicker className="w-100" format="DD/MM/YYYY" />
              </Form.Item>
            </div>
            
            <Form.Item name="phone" label="Số điện thoại" rules={[{ required: true }]}>
              <Input prefix={<PhoneOutlined />} placeholder="0901234567" />
            </Form.Item>
            <Form.Item name="address" label="Địa chỉ">
              <Input prefix={<HomeOutlined />} placeholder="123 Đường ABC..." />
            </Form.Item>
            <Form.Item name="healthInsuranceNumber" label="Số BHYT">
              <Input prefix={<IdcardOutlined />} placeholder="BH123456789" />
            </Form.Item>

            <div className="signup-buttons">
              <Button onClick={() => setCurrentStep(0)}>Quay lại</Button>
              <Button
                type="primary"
                htmlType="submit"
                loading={loading}
                style={{ background: "#4cc9b0", borderColor: "#4cc9b0" }}
              >
                Đăng ký ngay
              </Button>
            </div>
          </div>
        </Form>
      </Card>
    </div>
  );
};

export default SignUp;-e \n[END OF FILE]\n
frontend/src/pages/patient/CreateAppointmentModal.css
------------------------------------------
.create-appt-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(15, 23, 42, 0.6);
    display: flex; justify-content: center; align-items: center;
    z-index: 10000; backdrop-filter: blur(8px);
}

.create-appt-card {
    background: white; width: 700px; border-radius: 30px;
    padding: 40px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
}

.modal-wizard-header h2 { font-size: 28px; font-weight: 800; color: #1e293b; margin: 0; }
.modal-wizard-header p { color: #64748b; margin-top: 5px; }

/* Step Indicator */
.step-indicator-bar {
    display: flex; justify-content: space-between; margin: 30px 0;
    position: relative;
}

.step-dot {
    display: flex; flex-direction: column; align-items: center; gap: 8px;
    z-index: 2; position: relative;
}

.dot-inner {
    width: 35px; height: 35px; border-radius: 50%;
    background: #f1f5f9; color: #94a3b8;
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; transition: 0.3s;
}

.step-dot.active .dot-inner { background: #28bf96; color: white; }
.step-dot span { font-size: 12px; font-weight: 600; color: #94a3b8; }
.step-dot.active span { color: #28bf96; }

/* Doctor Grid */
.doctor-wizard-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
}

.doc-wizard-card {
    display: flex; gap: 15px; padding: 15px; border: 2px solid #f1f5f9;
    border-radius: 16px; cursor: pointer; transition: 0.2s;
}

.doc-wizard-card:hover, .doc-wizard-card.selected {
    border-color: #28bf96; background: #f0fdfa;
}

.doc-avatar {
    width: 50px; height: 50px; border-radius: 12px; background: #e2e8f0;
    overflow: hidden; display: flex; align-items: center; justify-content: center;
}

.doc-meta h4 { margin: 0; font-size: 16px; }
.doc-meta p { font-size: 13px; color: #64748b; margin: 2px 0; }

/* Time Grid */
.time-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px;
}

.time-grid button {
    padding: 10px; border: 1px solid #e2e8f0; border-radius: 10px;
    background: white; cursor: pointer; font-weight: 600;
}

.time-grid button.active {
    background: #28bf96; color: white; border-color: #28bf96;
}

/* Summary */
.appointment-summary {
    margin-top: 25px; background: #f8fafc; padding: 15px;
    border-radius: 15px; display: flex; align-items: center; gap: 15px;
    border-left: 5px solid #28bf96;
}

.wizard-footer {
    display: flex; justify-content: space-between; margin-top: 40px;
}

.btn-back { background: none; border: none; color: #64748b; font-weight: 600; cursor: pointer; display: flex; align-items: center; }
.btn-send { 
    background: #28bf96; color: white; border: none; 
    padding: 12px 25px; border-radius: 12px; font-weight: 700;
    display: flex; align-items: center; gap: 10px; cursor: pointer;
}

/* Dept Grid Style */
.dept-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 20px;
}

.dept-item {
    padding: 15px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-weight: 600;
    color: #475569;
    cursor: pointer;
    transition: all 0.2s;
}

.dept-item:hover {
    border-color: #28bf96;
    background: #f0fdfa;
}

.dept-item.selected {
    border-color: #28bf96;
    background: #28bf96;
    color: white;
}

.no-data-msg {
    grid-column: span 2;
    text-align: center;
    padding: 40px;
    color: #94a3b8;
    background: #f8fafc;
    border-radius: 16px;
    border: 2px dashed #e2e8f0;
}

.loading-spinner {
    text-align: center;
    padding: 50px;
    font-weight: 600;
    color: #28bf96;
}

/* Các style khác giữ nguyên từ file CSS bạn đã có */

.time-grid button:disabled {
    background: #f1f5f9;
    color: #cbd5e1;
    cursor: not-allowed;
    border: 1px dashed #cbd5e1;
}

.time-grid button.busy {
    position: relative;
    text-decoration: line-through;
}

/* Trạng thái nút bị bận */
.time-grid button.busy-btn {
    background-color: #f1f5f9 !important;
    color: #cbd5e1 !important;
    border: 1px dashed #cbd5e1 !important;
    cursor: not-allowed;
    text-decoration: line-through;
}

/* Hiệu ứng xoay cho icon loading */
.spinner {
    animation: spin 1s linear infinite;
    display: inline-block;
    margin-right: 8px;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.loading-state {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 200px;
    font-weight: 600;
    color: #28bf96;
}

/* Style cho nút giờ bị bận */
.time-grid button.busy-btn {
    background-color: #f1f5f9 !important;
    color: #94a3b8 !important;
    border: 1px dashed #cbd5e1 !important;
    cursor: not-allowed;
    text-decoration: line-through; /* Gạch ngang để báo hiệu đã đầy */
}

.time-grid button.busy-btn:hover {
    background-color: #f1f5f9 !important;
    border-color: #cbd5e1 !important;
}

/* Hiệu ứng xoay cho icon đang kiểm tra lịch */
.spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
/* Nút thoát X */
.btn-close-modal-x {
    background: none;
    border: none;
    cursor: pointer;
    color: #94a3b8;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-close-modal-x:hover {
    background: #fee2e2;
    color: #ef4444;
}

/* Giao diện danh sách bác sĩ mới */
.doc-grid-v2 {
    display: grid;
    grid-template-columns: 1fr 1fr; /* Chia 2 cột */
    gap: 15px;
    margin-top: 15px;
}

.doc-card-v2 {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #ffffff;
    border: 2px solid #f1f5f9;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.doc-card-v2:hover {
    border-color: #28bf96;
    transform: translateY(-2px);
}

.doc-card-v2.selected {
    border-color: #28bf96;
    background: #f0fdfa;
}

/* Avatar tròn đồng bộ PatientAppointment */
.doc-avatar-container {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #e2f7f1; /* Màu xanh nhạt của bạn */
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.doc-details {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.doc-name {
    font-weight: 700;
    color: #1e293b;
    margin: 0;
}

.doc-specialty {
    font-size: 13px;
    color: #64748b;
    margin: 0;
}

.doc-exp {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    color: #28bf96;
    font-weight: 600;
    margin-top: 4px;
}

/* Fix lỗi hiển thị Step 1 */
.step-content {
    animation: fadeIn 0.3s ease;
    width: 100%;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Fix Header và Nút X */
.modal-wizard-header {
    position: relative; /* Gốc tọa độ cho nút X */
    padding-bottom: 20px;
}

.btn-close-modal-x {
    position: absolute;
    top: 0;
    right: 0;
    z-index: 10;
    background: #f1f5f9;
    border: none;
    cursor: pointer;
    color: #64748b;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.btn-close-modal-x:hover {
    background: #fee2e2;
    color: #ef4444;
}

/* Fix Avatar tròn */
.doc-avatar-container {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: #e2f7f1;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Cắt ảnh thừa thành hình tròn */
    position: relative;
    flex-shrink: 0;
}

.doc-img-fluid {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Quan trọng để ảnh không bị móp méo */
    position: absolute;
    top: 0;
    left: 0;
    z-index: 2;
}

.fallback-icon {
    position: relative;
    z-index: 1;
}

-e \n[END OF FILE]\n
frontend/src/pages/patient/PatientDashboard.css
------------------------------------------
.dashboard-page {
    background-color: #ffffff;
    min-height: 100vh;
    overflow-x: hidden;
  }
  
  .dashboard-content {
    max-width: 1300px;
    margin: 0 auto;
    padding: 60px 20px;
  }
  
  /* --- HERO SECTION --- */
  .hero-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 40px;
    position: relative;
  }
  
  .hero-left {
    flex: 1;
    max-width: 550px;
  }
  
  .hero-subtitle {
    font-size: 32px;
    color: #333;
    font-weight: 400;
    margin-bottom: 0;
  }
  
  .hero-title {
    font-size: 56px;
    color: #1a1a1a;
    font-weight: 800;
    margin-bottom: 20px;
  }
  
  .hero-description {
    font-size: 16px;
    line-height: 1.8;
    color: #777;
    margin-bottom: 40px;
  }
  
  .btn-get-services {
    background-color: #28BF96; /* Màu xanh Mint giống logo */
    color: white;
    border: none;
    padding: 15px 40px;
    border-radius: 8px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }
  
  .btn-get-services:hover {
    background-color: #1c9877;
    transform: translateY(-3px);
  }
  
  /* --- HERO RIGHT (IMAGE & CARDS) --- */
  .hero-right {
    flex: 1;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  /* Khối tròn xanh Mint phía sau bác sĩ */
  .circle-bg {
    position: absolute;
    width: 650px;
    height: 650px;
    background-color: #28BF96;
    border-radius: 50%;
    z-index: 1;
    right: 10px;
  }
  
  .doctor-img {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 900px;
    filter: drop-shadow(0 10px 30px rgba(0,0,0,0.1));
  }
  
  /* Style chung cho các thẻ Card đè lên */
  .stat-card {
    position: absolute;
    background: white;
    padding: 15px 25px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    z-index: 3;
  }
  
  /* Card 1520+ */
  .clients-card {
    left: -20px;
    top: 30%;
    display: flex;
    align-items: center;
    gap: 15px;
    min-width: 200px;
  }
  
  .stat-icon {
    background: #f0fdfa;
    padding: 10px;
    border-radius: 10px;
  }
  
  .stat-info h3 {
    font-size: 24px;
    margin: 0;
    color: #1a1a1a;
  }
  
  .stat-info p {
    font-size: 14px;
    margin: 0;
    color: #777;
  }
  
  /* Card Ưu đãi bên phải */
  .promo-card {
    right: -30px;
    bottom: 20%;
    min-width: 240px;
  }
  
  .promo-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .promo-card li {
    font-size: 14px;
    color: #444;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .promo-card li span {
    color: #24ae8f;
    font-weight: bold;
  }
  
  /* Họa tiết trang trí phụ (Tùy chọn) */
  .hero-banner::before {
    content: ":::";
    position: absolute;
    top: -20px;
    left: -40px;
    font-size: 40px;
    color: #4cc9b0;
    opacity: 0.3;
  }

  .dashboard-page {
    background-color: #F4F7F6; /* Màu nền hơi xám để làm nổi bật Card trắng */
    min-height: 100vh;
    padding-bottom: 50px;
  }
  
  .dashboard-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 40px 20px;
  }
  
  /* --- THIẾT KẾ CARD BAO QUANH --- */
  .hero-card {
    background-color: #ffffff;
    border-radius: 30px;
    padding: 60px 80px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
    overflow: hidden; /* Đảm bảo hình tròn xanh không tràn ra ngoài card */
  }
  
  .hero-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 50px;
    position: relative;
  }
  
  .hero-left {
    flex: 1;
    z-index: 5;
  }
  
  /* SỬA TẠI ĐÂY: Get Quick to bằng Medical Services nhưng không đậm */
  .hero-subtitle {
    font-size: 56px; /* Bằng với kích thước tiêu đề chính */
    color: #333;
    font-weight: 300; /* Làm chữ mỏng đi */
    margin-bottom: -10px; /* Kéo hai dòng lại gần nhau hơn */
    line-height: 1.1;
  }
  
  .hero-title {
    font-size: 56px;
    color: #1a1a1a;
    font-weight: 800;
    margin-bottom: 25px;
    line-height: 1.1;
  }
  
  .hero-description {
    font-size: 16px;
    line-height: 1.8;
    color: #777;
    margin-bottom: 40px;
    max-width: 500px;
  }
  
  .btn-get-services {
    background-color: #28BF96;
    color: white;
    border: none;
    padding: 16px 45px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn-get-services:hover {
    background-color: #1c9877;
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(40, 191, 150, 0.2);
  }
  
  /* --- HERO RIGHT (IMAGE & CIRCLE) --- */
  .hero-right {
    flex: 1;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .circle-bg {
    position: absolute;
    width: 580px;
    height: 580px;
    background-color: #28BF96;
    border-radius: 50%;
    z-index: 1;
    right: -20px;
  }
  
  .doctor-img {
    position: relative;
    z-index: 2;
    width: 110%; /* Tăng nhẹ kích thước ảnh */
    max-width: 800px;
    filter: drop-shadow(0 15px 40px rgba(0,0,0,0.12));
  }
  
  /* Stat Cards */
  .stat-card {
    position: absolute;
    background: white;
    padding: 18px 25px;
    border-radius: 15px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    z-index: 10;
  }
  
  .clients-card {
    left: -40px;
    top: 25%;
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .promo-card {
    right: -20px;
    bottom: 15%;
    min-width: 260px;
  }
  
  .promo-card li span {
    color: #28BF96;
  }

  /* Nền xám nhạt toàn trang giống Doctor */
.dashboard-page {
    background-color: #f4f7f6; 
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  /* Container tạo khoảng cách so với lề và header */
  .dashboard-main-container {
    padding: 30px 40px;
    flex: 1;
    display: flex;
    justify-content: center;
  }
  
  /* THIẾT KẾ CARD NỔI */
  .dashboard-card {
    background-color: #ffffff;
    width: 100%;
    max-width: 1400px;
    border-radius: 30px;
    /* Giữ padding các cạnh khác, nhưng đặt padding-bottom = 0 */
    padding: 60px 80px 0 80px; 
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
    position: relative;
    overflow: hidden; /* Quan trọng để ảnh không lòi ra ngoài bo góc ở đáy */
    display: flex;
    align-items: flex-end; /* Căn nội dung bám sát đáy card */
    max-height: 700px;
    margin-top: 3vh;
  }
  
  /* --- HERO SECTION --- */
  .hero-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 40px;
  }
  
  .hero-left {
    flex: 1;
    z-index: 10;
  }
  
  .hero-subtitle {
    font-size: 56px;
    color: #333;
    font-weight: 300; /* Mỏng nhẹ */
    margin-bottom: -5px;
    line-height: 1.1;
    margin-bottom: 20px;
  }
  
  .hero-title {
    font-size: 56px;
    color: #1a1a1a;
    font-weight: 800; /* Đậm */
    margin-bottom: 25px;
    line-height: 1.1;
  }
  
  .hero-description {
    font-size: 16px;
    color: #777;
    line-height: 1.8;
    margin-bottom: 35px;
    max-width: 480px;
  }
  
  .btn-get-services {
    background-color: #28BF96;
    color: white;
    border: none;
    padding: 16px 45px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s ease;
  }
  
  .btn-get-services:hover {
    background-color: #1c9877;
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(40, 191, 150, 0.2);
  }
  
  /* --- PHẦN ẢNH BÊN PHẢI --- */
  .hero-right {
    flex: 1.2;
    position: relative;
    display: flex;
    justify-content: center;
  }
  
  .circle-bg {
    position: absolute;
    width: 550px;
    height: 550px;
    background-color: #28BF96;
    border-radius: 50%;
    z-index: 1;
    top: 50%;
    transform: translateY(-50%);
    right: 0;
  }
  
  .doctor-img {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 750px; /* Tăng kích thước ảnh bác sĩ */
    filter: drop-shadow(0 20px 40px rgba(0,0,0,0.1));
  }
  
  /* Thẻ Card nhỏ đè lên */
  .stat-card {
    position: absolute;
    background: white;
    padding: 15px 22px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    z-index: 15;
  }
  
  .clients-card {
    left: -20px;
    top: 30%;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .promo-card {
    right: -10px;
    bottom: 20%;
    min-width: 250px;
  }
  
  .promo-card li span { color: #28BF96; font-weight: bold; }

  .hero-banner {
    display: flex;
    align-items: center; /* Chữ vẫn căn giữa theo chiều dọc */
    justify-content: space-between;
    gap: 40px;
    width: 100%;
  }

  .hero-right {
    flex: 1.2;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: flex-end; /* Ảnh bám sát đáy container */
    height: 100%;
  }
  
  .doctor-img {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 750px;
    display: block; /* Loại bỏ khoảng trống inline phía dưới */
    filter: drop-shadow(0 20px 40px rgba(0,0,0,0.1));
    margin-bottom: -5px; /* Đẩy nhẹ xuống để lấp đầy kẽ hở pixel nếu có */
  }
  
  /* Chỉnh lại vòng tròn xanh để nó không bị cắt mất một nửa */
  .circle-bg {
    position: absolute;
    width: 550px;
    height: 550px;
    background-color: #28BF96;
    border-radius: 50%;
    z-index: 1;
    bottom: -100px; /* Đẩy vòng tròn xuống thấp hơn một chút cho đẹp */
    right: 50px;
  }

  .hero-left {
    flex: 1;
    z-index: 10;
    padding-bottom: 60px; /* Tạo khoảng trống dưới nút bấm để cân bằng */
  }

  /* Gợn sóng màu xanh ở phía trên tiêu đề */
.hero-left::before {
    content: "";
    position: absolute;
    top: -20px;
    right: 15%;
    width: 80px;
    height: 20px;
    background-image: url("data:image/svg+xml,%3Csvg width='80' height='20' viewBox='0 0 80 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10C5 5 10 5 15 10C20 15 25 15 30 10C35 5 40 5 45 10C50 15 55 15 60 10C65 5 70 5 75 10' stroke='%2328BF96' stroke-width='2'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    opacity: 0.6;
  }
  
  /* Gợn sóng màu xám ở phía dưới nút bấm */
  .hero-left::after {
    content: "";
    position: absolute;
    bottom: 40px;
    left: -20px;
    width: 100px;
    height: 25px;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='25' viewBox='0 0 100 25' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 15C6 10 12 10 18 15C24 20 30 20 36 15C42 10 48 10 54 15C60 20 66 20 72 15C78 10 84 10 90 15' stroke='%23ccc' stroke-width='2'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    opacity: 0.5;
  }
  
  /* Chấm bi nhỏ ở phía dưới ảnh bác sĩ */
  .hero-right::after {
    content: " \2022 \2022 \2022 \2022 \n \2022 \2022 \2022 \2022 \n \2022 \2022 \2022 \2022 ";
    white-space: pre;
    position: absolute;
    bottom: 20px;
    right: 20px;
    font-size: 20px;
    color: #28BF96;
    opacity: 0.3;
    line-height: 0.8;
    z-index: 1;
  }
  
  /* --- ĐIỀU CHỈNH LẠI DASHBOARD CARD --- */
  .dashboard-card {
    background-color: #ffffff;
    width: 100%;
    max-width: 1400px;
    border-radius: 30px;
    padding: 40px 80px 0 80px; /* Giảm padding top một chút */
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
    position: relative;
    overflow: hidden; 
    display: flex;
    align-items: flex-end; 
  }
  
  .hero-banner {
    display: flex;
    align-items: flex-end; /* Ép mọi thứ xuống đáy */
    justify-content: space-between;
    gap: 40px;
    width: 100%;
  }
  
  .hero-left {
    flex: 1;
    z-index: 10;
    padding-bottom: 140px;
    position: relative; /* Để chứa các gợn sóng absolute */
  }

  -e \n[END OF FILE]\n
frontend/src/pages/patient/PatientAppointment.css
------------------------------------------
:root {
    --primary: #28bf96;
    --bg-soft: #f4f7f6;
    --text-main: #1e293b;
  }
  
  .patient-appt-page {
    background-color: var(--bg-soft);
    min-height: 100vh;
  }
  
  .appt-main-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px 40px;
  }
  
  /* Header */
  .appt-header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .welcome-title { font-size: 32px; font-weight: 800; color: var(--text-main); }
  .welcome-title .highlight { color: var(--primary); }
  
  .search-bar-wrapper {
    display: flex;
    align-items: center;
    background: white;
    padding: 10px 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    gap: 10px;
    width: 350px;
  }
  
  .search-bar-wrapper input {
    border: none;
    outline: none;
    width: 100%;
    font-weight: 500;
  }
  
  /* Layout Content */
  .appt-content-layout {
    display: flex;
    gap: 30px;
  }
  
  /* Sidebar Calendar (Style Request.css) */
  .calendar-sidebar { flex: 0 0 350px; }
  
  .custom-calendar-card {
    background: white;
    border-radius: 24px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
  }
  
  .patient-custom-calendar {
    width: 100% !important;
    border: none !important;
    font-family: inherit;
  }
  
  .react-calendar__tile--active {
    background: var(--primary) !important;
    border-radius: 8px;
  }
  
  /* List Section (Style Appointments.css) */
  .appt-list-section { flex: 1; }
  
  .list-card {
    background: white;
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
  }
  
  .list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
  }
  
  .count-tag {
    background: #f0fdfa;
    color: var(--primary);
    padding: 6px 15px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 14px;
  }
  
  /* Table Style */
  .patient-table { width: 100%; border-collapse: collapse; }
  .patient-table th {
    text-align: left;
    padding: 15px;
    color: #94a3b8;
    font-size: 13px;
    text-transform: uppercase;
    border-bottom: 1px solid #f1f5f9;
  }
  
  .patient-table td { padding: 20px 15px; border-bottom: 1px solid #f1f5f9; }
  
  .p-cell { display: flex; align-items: center; gap: 15px; }
  .p-avatar-wrapper {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    overflow: hidden;
    background: #e2e8f0;
  }
  .p-avatar-wrapper img { width: 100%; height: 100%; object-fit: cover; }
  .p-name { font-weight: 700; color: var(--text-main); margin: 0; }
  .p-info { font-size: 12px; color: #64748b; margin: 0; }
  
  .time-cell { display: flex; align-items: center; gap: 8px; font-weight: 700; color: var(--text-main); }
  
  .specialty-tag {
    background: #eff6ff;
    color: #3b82f6;
    padding: 4px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
  }
  
  /* Status Pill */
  .status-pill {
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 700;
    text-transform: capitalize;
  }
  .status-pill.confirmed { background: #dcfce7; color: #15803d; }
  .status-pill.pending { background: #fef9c3; color: #a16207; }
  .status-pill.cancelled { background: #fee2e2; color: #b91c1c; }
  
  .btn-details {
    background: #f1f5f9;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    color: #64748b;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
  }
  
  .btn-details:hover { background: #e2e8f0; color: var(--text-main); }
  
  .no-data { text-align: center; padding: 40px !important; color: #94a3b8; font-style: italic; }

  /* Nút Details mặc định */
.btn-details {
    background-color: #f1f5f9;
    color: #64748b;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .btn-details:hover {
    background-color: #e2e8f0;
  }
  
  /* Nút Cancel mới */
  .btn-cancel {
    display: flex;
    align-items: center;
    gap: 6px;
    background-color: #fff1f2; /* Màu đỏ nhạt */
    color: #e11d48; /* Chữ đỏ đậm */
    border: 1px solid #fecdd3;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .btn-cancel:hover {
    background-color: #e11d48;
    color: white;
    border-color: #e11d48;
  }


  
  /* Group container để căn chỉnh các nút */
  .action-buttons-group {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  /* --- Tùy chỉnh các ngày không thuộc tháng hiện tại --- */

/* Làm mờ các ngày ngoài tháng */
.react-calendar__month-view__days__day--neighboringMonth {
    color: #cbd5e1 !important; /* Màu xám nhạt (Slate 300) */
    opacity: 0.6;
}

/* Tùy chọn: Nếu bạn muốn ẩn hoàn toàn hoặc thay đổi nền của chúng */
/*
.react-calendar__month-view__days__day--neighboringMonth {
    background-color: #f8fafc !important; 
    pointer-events: none; (Vô hiệu hóa click vào các ngày này nếu muốn)
}
*/

/* Đảm bảo ngày trong tháng hiện tại vẫn có màu đậm */
.react-calendar__month-view__days__day {
    color: #1e293b; /* Màu chữ mặc định của bạn */
}

/* 1. Màu mặc định cho tất cả các ngày */
.react-calendar__month-view__days__day {
    color: var(--text-main) !important;
    font-weight: 600;
}

/* 2. Màu riêng cho các ngày "ngoài tháng" - Thư viện tự thêm class này */
.react-calendar__month-view__days__day--neighboringMonth {
    color: #cbd5e1 !important; /* Màu xám nhạt */
    opacity: 0.5; /* Làm mờ đi */
}

/* 3. Đảm bảo ngày đang chọn (Active) vẫn rõ nét */
.react-calendar__tile--active {
    background: var(--primary) !important;
    color: white !important;
    opacity: 1 !important;
}

/* Tận dụng lại style overlay nếu chưa có */
.exam-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.5); /* Làm tối nền */
    display: flex; 
    justify-content: center; 
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
}

.exam-card {
    background: white;
    border-radius: 20px;
    padding: 0;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

/* Style cho select và input trong modal */
.readonly-box {
    padding: 12px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    font-family: inherit;
}

/* Layout chính chia 2 cột */
.appt-content-layout {
    display: grid;
    grid-template-columns: 380px 1fr; /* Cột lịch rộng 380px, cột bảng tự giãn */
    gap: 30px;
}

/* Nền trắng cho Card Lịch */
.calendar-card {
    background: #ffffff !important;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
}

/* Nền trắng cho Card Danh sách */
.table-container {
    background: #ffffff !important;
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    min-height: 500px;
}

/* Sửa hiển thị ảnh Avatar */
.p-avatar-wrapper {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.p-avatar-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* --- TỔNG THỂ CARD LỊCH --- */
.calendar-card {
    background: #ffffff !important;
    padding: 20px;
    border-radius: 24px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    border: none !important; /* Loại bỏ viền ngoài nếu có */
}

/* Loại bỏ viền đen mặc định bên trong thư viện */
.react-calendar {
    width: 100% !important;
    border: none !important; /* Xóa viền đen bao quanh */
    font-family: inherit;
    background: transparent !important;
}

/* --- HEADER: THÁNG & NĂM --- */
.react-calendar__navigation {
    margin-bottom: 15px;
    height: 44px;
}

.react-calendar__navigation button {
    color: var(--text-main) !important;
    font-size: 16px;
    font-weight: 700;
    text-transform: capitalize;
    background: none !important;
}

.react-calendar__navigation button:enabled:hover,
.react-calendar__navigation button:enabled:focus {
    background-color: #f1f5f9 !important;
    border-radius: 10px;
}

/* --- THỨ TRONG TUẦN (Mon, Tue,...) --- */
.react-calendar__month-view__weekdays {
    text-align: center;
    text-transform: uppercase;
    font-weight: 700;
    font-size: 0.8rem;
    color: #94a3b8 !important; /* Màu xám nhạt hiện đại */
    padding-bottom: 10px;
}

.react-calendar__month-view__weekdays__weekday abbr {
    text-decoration: none !important; /* Bỏ gạch chân dưới chữ */
    border-bottom: none !important;
}

/* --- CÁC Ô NGÀY --- */
.react-calendar__tile {
    padding: 12px 8px !important;
    border-radius: 12px;
    transition: all 0.2s;
    font-weight: 600;
    color: var(--text-main);
    border: none !important; /* Đảm bảo không có viền đen khi click */
    outline: none !important;
}

/* Hiệu ứng khi hover vào ngày */
.react-calendar__tile:enabled:hover,
.react-calendar__tile:enabled:focus {
    background-color: #e2f7f1 !important;
    color: var(--primary) !important;
}

/* Ngày hiện tại */
.react-calendar__tile--now {
    background: #f1f5f9 !important;
    color: var(--primary) !important;
}

/* Ngày đang được chọn */
.react-calendar__tile--active {
    background: var(--primary) !important;
    color: white !important;
    box-shadow: 0 4px 12px rgba(40, 191, 150, 0.3);
}

/* Các ngày ngoài tháng (làm mờ) */
.react-calendar__month-view__days__day--neighboringMonth {
    color: #cbd5e1 !important;
    opacity: 0.4;
}

/* Loại bỏ viền focus chấm chấm của trình duyệt */
button:focus {
    outline: none !important;
}-e \n[END OF FILE]\n
frontend/src/pages/patient/ProfilePatient.tsx
------------------------------------------
import React, { useState, useEffect } from "react";
import axios from "axios";
import {
  Button,
  Input,
  DatePicker,
  Select,
  Typography,
  Card,
  Spin,
  message,
} from "antd";
import {
  EditOutlined,
  LogoutOutlined,
  CheckCircleFilled,
  UserOutlined,
  CameraOutlined,
} from "@ant-design/icons";
import dayjs from "dayjs";
import "../doctor/Profile.css"; // Dùng chung file CSS với Doctor để đồng bộ giao diện

const { Title, Text } = Typography;

const PatientProfile: React.FC = () => {
  const [patient, setPatient] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);

  const API_URL = "http://localhost:3000";

  // Hàm xử lý URL ảnh giống logic Doctor nhưng trỏ vào user.avatar
  const getAvatarUrl = (avatarPath: string | undefined) => {
    if (!avatarPath) return "https://www.w3schools.com/howto/img_avatar.png"; 
    if (avatarPath.startsWith("http")) return avatarPath; 
    return avatarPath.startsWith("/") ? `${API_URL}${avatarPath}` : `${API_URL}/${avatarPath}`;
  };

  useEffect(() => {
    const fetchProfile = async () => {
      try {
        setLoading(true);
        const userId = localStorage.getItem("userId");
        const token = localStorage.getItem("token");
        const headers = { Authorization: `Bearer ${token}` };

        if (userId) {
          const res = await axios.get(
            `${API_URL}/api/patients/user/${userId}`,
            { headers }
          );
          // Theo cấu trúc NestJS của bạn: trả về trực tiếp object hoặc bọc trong .data
          const actualData = res.data.data ? res.data.data : res.data;
          setPatient(actualData);
        }
      } catch (err) {
        console.error("Lỗi fetch dữ liệu:", err);
        message.error("Lỗi tải thông tin cá nhân");
      } finally {
        setLoading(false);
      }
    };
    fetchProfile();
  }, []);

  // Hàm cập nhật thông tin
  const handleSave = async () => {
    try {
      setLoading(true);
      const token = localStorage.getItem("token");
      
      // 1. Chỉ lấy những trường mà bảng Patient cho phép sửa
      // Loại bỏ 'user', 'id', 'userId', 'createdAt' để tránh lỗi ValidationPipe
      const { 
        fullName, 
        gender, 
        dateOfBirth, 
        phone, 
        address, 
        healthInsuranceNumber 
      } = patient;
  
      const updateData = { 
        fullName, 
        gender, 
        dateOfBirth, 
        phone, 
        address, 
        healthInsuranceNumber 
      };
  
      // 2. Gọi API Patch tới đúng ID của Patient
      await axios.patch(
        `${API_URL}/api/patients/${patient.id}`, 
        updateData, 
        { headers: { Authorization: `Bearer ${token}` } }
      );
  
      message.success("Cập nhật thông tin thành công!");
    } catch (err: any) {
      console.error("Lỗi cập nhật:", err.response?.data);
      const errorMsg = err.response?.data?.message;
      message.error(Array.isArray(errorMsg) ? errorMsg[0] : errorMsg || "Lỗi lưu dữ liệu");
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="loading-container" style={{ textAlign: "center", padding: "100px" }}>
        <Spin size="large" />
      </div>
    );
  }

  if (!patient) return <div>Không tìm thấy dữ liệu bệnh nhân.</div>;

  return (
    <div className="profile-page-container">
      <div className="profile-header-text">
        <Title level={2}>Hồ sơ cá nhân</Title>
        <Text type="secondary">Quản lý thông tin sức khỏe và cá nhân của bạn</Text>
      </div>

      <div className="profile-content-layout">
        {/* LEFT CARD: Avatar & Summary */}
        <div className="profile-left-card">
          <Card className="doctor-card">
            <div className="image-wrapper">
              <img
                // QUAN TRỌNG: Lấy avatar từ patient.user.avatar theo Entity của bạn
                src={getAvatarUrl(patient?.user?.avatar)}
                alt="Patient Avatar"
                className="main-avatar"
              />
              
            </div>

            <div className="doctor-info-summary" style={{ textAlign: "center" }}>
              <Title level={4} style={{ margin: "10px 0 5px" }}>
                {patient.fullName}{" "}
                <CheckCircleFilled style={{ color: "#52c41a", fontSize: "16px" }} />
              </Title>
              <Text type="secondary">Mã bệnh nhân: #{patient.id?.toString().substring(0, 8)}</Text>
            </div>
          </Card>
        </div>

        {/* RIGHT SIDE: Form Details */}
        <div className="profile-right-form">
          <Card title={<><UserOutlined /> Thông tin chi tiết</>} className="form-card">
            <div className="form-grid">
              <div className="form-row">
                <span className="label">Họ và tên:</span>
                <Input
                  value={patient.fullName}
                  onChange={(e) => setPatient({ ...patient, fullName: e.target.value })}
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Số điện thoại:</span>
                <Input
                  value={patient.phone}
                  onChange={(e) => setPatient({ ...patient, phone: e.target.value })}
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Email:</span>
                <Input
                  value={patient?.user?.email}
                  disabled
                  className="custom-input readonly-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Ngày sinh:</span>
                <DatePicker
                  value={patient.dateOfBirth ? dayjs(patient.dateOfBirth) : null}
                  onChange={(date) =>
                    setPatient({ ...patient, dateOfBirth: date ? date.toDate() : null })
                  }
                  format="DD - MM - YYYY"
                  style={{ width: "100%" }}
                  className="custom-input"
                />
              </div>

              <div className="form-row">
                <span className="label">Giới tính:</span>
                <Select
                  value={patient.gender}
                  onChange={(value) => setPatient({ ...patient, gender: value })}
                  style={{ width: "100%" }}
                  className="custom-select"
                  options={[
                    { value: "man", label: "Nam" },
                    { value: "woman", label: "Nữ" },
                    { value: "other", label: "Khác" },
                  ]}
                />
              </div>

              <div className="form-row">
                <span className="label">Địa chỉ:</span>
                <Input
                  value={patient.address}
                  onChange={(e) => setPatient({ ...patient, address: e.target.value })}
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>
              
              <div className="form-row">
                <span className="label">Số BHYT:</span>
                <Input
                  value={patient.healthInsuranceNumber}
                  onChange={(e) => setPatient({ ...patient, healthInsuranceNumber: e.target.value })}
                  suffix={<EditOutlined className="edit-pen" />}
                  className="custom-input"
                />
              </div>
            </div>
          </Card>

          <div
            className="profile-actions"
            style={{
              marginTop: "30px",
              display: "flex",
              gap: "15px",
              justifyContent: "flex-end",
            }}
          >
            <Button
              icon={<LogoutOutlined />}
              className="logout-btn"
              danger
              onClick={() => {
                localStorage.clear();
                window.location.href = "/login";
              }}
            >
              Đăng xuất
            </Button>
            <Button
              type="primary"
              className="save-btn"
              style={{ background: "#53CCAB", border: "none" }}
              onClick={handleSave}
            >
              Lưu thay đổi
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default PatientProfile;-e \n[END OF FILE]\n
frontend/src/pages/patient/CreateAppointmentModal.tsx
------------------------------------------
import React, { useState, useEffect, useMemo } from "react";
import axios from "axios";
import Calendar from "react-calendar";
import "react-calendar/dist/Calendar.css";
import {
  ChevronLeft,
  Send,
  User,
  CheckCircle2,
  Loader2,
  X,
  Award,
} from "lucide-react";
import "./CreateAppointmentModal.css";

interface Props {
  onClose: () => void;
  onSuccess: () => void;
}

const CreateAppointmentModal: React.FC<Props> = ({ onClose, onSuccess }) => {
  const [step, setStep] = useState(1);
  const [loading, setLoading] = useState(true);
  const [checkingSlots, setCheckingSlots] = useState(false);

  // Data State
  const [allDoctors, setAllDoctors] = useState<any[]>([]);
  const [departments, setDepartments] = useState<any[]>([]);
  const [busySlots, setBusySlots] = useState<string[]>([]); // Lưu các giờ đã bị đặt

  // Form State
  const [selectedDeptId, setSelectedDeptId] = useState<number | null>(null);
  const [selectedDoctor, setSelectedDoctor] = useState<any>(null);
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [selectedTime, setSelectedTime] = useState("");

  const API_URL = "http://localhost:3000";

  // 1. Khởi tạo dữ liệu ban đầu
  useEffect(() => {
    const initData = async () => {
      try {
        setLoading(true);
        const token = localStorage.getItem("token");
        const headers = { Authorization: `Bearer ${token}` };

        const [deptRes, docRes] = await Promise.all([
          axios.get(`${API_URL}/api/departments`, { headers }),
          axios.get(`${API_URL}/api/doctors/active`, { headers }),
        ]);

        setDepartments(deptRes.data);
        setAllDoctors(docRes.data);
      } catch (error) {
        console.error("Lỗi tải dữ liệu:", error);
      } finally {
        setLoading(false);
      }
    };
    initData();
  }, []);

  // 2. Logic kiểm tra khung giờ bận (Vô hiệu hóa nút ở Step 4)
  useEffect(() => {
    // ... (các import giữ nguyên)

    const fetchBusySlots = async () => {
      if (step === 4 && selectedDoctor && selectedDate) {
        try {
          setCheckingSlots(true);
          const token = localStorage.getItem("token");

          // Định dạng ngày chuẩn YYYY-MM-DD để so sánh với kiểu 'date' của Backend
          const dateStr = selectedDate.toLocaleDateString("en-CA");

          const res = await axios.get(`${API_URL}/api/appointments`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          console.log("Ngày đang kiểm tra:", dateStr);
          console.log("ID Bác sĩ đang chọn:", selectedDoctor.id);

          const busy = res.data
            .filter((apt: any) => {
              // 1. Ép kiểu cả 2 về String để tránh lệch bigint/number
              const isSameDoctor =
                String(apt.doctor_id || apt.doctorId) ===
                String(selectedDoctor.id);

              // 2. So sánh ngày (Backend trả về YYYY-MM-DD)
              const isSameDate = apt.appointment_date === dateStr;

              // 3. Chỉ tính các lịch chưa bị hủy
              const isActive = apt.status !== "cancelled";

              return isSameDoctor && isSameDate && isActive;
            })
            .map((apt: any) => {
              // 4. QUAN TRỌNG: Cắt bỏ phần giây (:00) nếu Backend trả về "08:00:00"
              // Nếu apt.appointment_time là "08:00:00" -> lấy "08:00"
              return apt.appointment_time.substring(0, 5);
            });

          console.log("Danh sách giờ bận sau khi xử lý:", busy);
          setBusySlots(busy);
        } catch (error) {
          console.error("Lỗi check lịch bận:", error);
        } finally {
          setCheckingSlots(false);
        }
      }
    };
    fetchBusySlots();
  }, [step, selectedDoctor, selectedDate]);

  const filteredDoctors = useMemo(() => {
    if (!selectedDeptId) return [];
    return allDoctors.filter(
      (doc) =>
        Number(doc.department_id || doc.department?.id) ===
        Number(selectedDeptId)
    );
  }, [allDoctors, selectedDeptId]);

  const timeSlots = useMemo(
    () => ({
      morning: ["07:00", "08:00", "09:00", "10:00", "11:00"],
      afternoon: ["13:30", "14:30", "15:30", "16:30"],
    }),
    []
  );

  const handleSendRequest = async () => {
    try {
      const userId = localStorage.getItem("userId");
      const token = localStorage.getItem("token");

      const patientRes = await axios.get(
        `${API_URL}/api/patients/user/${userId}`,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );

      const payload = {
        patient_id: patientRes.data.id,
        doctor_id: selectedDoctor.id,
        appointment_date: selectedDate.toLocaleDateString("en-CA"),
        appointment_time: selectedTime,
        status: "pending",
        note: `Đăng ký khám khoa ${selectedDoctor.department?.name || ""}`,
      };

      await axios.post(`${API_URL}/api/appointments`, payload, {
        headers: { Authorization: `Bearer ${token}` },
      });

      alert("Đặt lịch thành công!");
      onSuccess();
    } catch (error: any) {
      const msg = error.response?.data?.message;
      alert(Array.isArray(msg) ? msg.join("\n") : msg || "Có lỗi xảy ra.");
    }
  };

  return (
    <div className="create-appt-overlay">
      <div className="create-appt-card">
        <header className="modal-wizard-header">
          <h2>Book an Appointment </h2>
          <div className="step-indicator-bar">
            {[1, 2, 3, 4].map((s) => (
              <div key={s} className={`step-dot ${step >= s ? "active" : ""}`}>
                <div className="dot-inner">{s}</div>
              </div>
            ))}
          </div>
          <button className="btn-close-modal-x" onClick={onClose} title="Đóng">
      <X size={20} />
    </button>
        </header>

        <div className="wizard-content">
          {loading ? (
            <div className="loading-state">
              <Loader2 className="spinner" /> Loading...
            </div>
          ) : (
            <>
              {step === 1 && (
                <div className="step-container">
                  <h3>1. Select Department</h3>
                  <div className="dept-grid">
                    {departments.map((dept) => (
                      <button
                        key={dept.id}
                        className={`dept-item ${
                          selectedDeptId === Number(dept.id) ? "selected" : ""
                        }`}
                        onClick={() => {
                          setSelectedDeptId(Number(dept.id));
                          setStep(2);
                        }}
                      >
                        {dept.name}
                      </button>
                    ))}
                  </div>
                </div>
              )}

              {step === 2 && (
                <div className="step-content">
                  <h3>Chọn bác sĩ</h3>
                  <div className="doc-grid-v2">
                    {filteredDoctors.length > 0 ? (
                      filteredDoctors.map((doc) => {
                        // LẤY ĐƯỜNG DẪN ẢNH: Kiểm tra trong doc.user.avatar hoặc doc.avatar
                        const avatarPath = doc.user?.avatar || doc.avatar;
                        const avatarUrl = avatarPath
                          ? `${API_URL}/avatar/${doc.user.avatar}`
                          : null;

                        return (
                          <div
                            key={doc.id}
                            className={`doc-card-v2 ${
                              selectedDoctor?.id === doc.id ? "selected" : ""
                            }`}
                            onClick={() => {
                              setSelectedDoctor(doc);
                              setStep(3);
                            }}
                          >
                            <div className="doc-avatar-container">
                              {avatarUrl ? (
                                <img
                                  src={avatarUrl}
                                  alt={doc.fullName}
                                  className="doc-img-fluid"
                                  onError={(e) => {
                                    (e.currentTarget as HTMLImageElement).src =
                                      ""; // Xóa src nếu lỗi để hiện icon
                                    (
                                      e.currentTarget as HTMLImageElement
                                    ).style.display = "none";
                                  }}
                                />
                              ) : null}
                              <User
                                size={24}
                                color="#28bf96"
                                className="fallback-icon"
                              />
                            </div>
                            <div className="doc-details">
                              <p className="doc-name">BS. {doc.fullName}</p>
                              <p className="doc-specialty">
                                {doc.specialty || "Chuyên khoa"}
                              </p>
                              <div className="doc-exp">
                                <Award size={14} />
                                <span>
                                  {doc.experience_years || 5}+ năm kinh nghiệm
                                </span>
                              </div>
                            </div>
                          </div>
                        );
                      })
                    ) : (
                      <div className="no-data-msg">
                        Không có bác sĩ cho chuyên khoa này.
                      </div>
                    )}
                  </div>
                </div>
              )}

              {step === 3 && (
                <div className="step-container">
                  <h3>3. Select Date</h3>
                  <div className="calendar-wizard-wrapper">
                    <Calendar
                      onChange={(d) => {
                        setSelectedDate(d as Date);
                        setStep(4);
                      }}
                      value={selectedDate}
                      minDate={new Date()}
                    />
                  </div>
                </div>
              )}

              {step === 4 && (
                <div className="step-container">
                  <h3
                    style={{
                      display: "flex",
                      alignItems: "center",
                      gap: "10px",
                    }}
                  >
                    4. Select Time{" "}
                    {checkingSlots && <Loader2 size={16} className="spinner" />}
                  </h3>
                  <div className="time-section">
                    {/* Trong Step 4 */}
                    <div className="time-grid">
                      {[...timeSlots.morning, ...timeSlots.afternoon].map(
                        (t) => {
                          // Kiểm tra xem giờ 't' (VD: "08:00") có nằm trong mảng busySlots không
                          const isBusy = busySlots.some((busyTime) =>
                            busyTime.startsWith(t)
                          );

                          return (
                            <button
                              key={t}
                              disabled={isBusy}
                              className={`${
                                selectedTime === t ? "active" : ""
                              } ${isBusy ? "busy-btn" : ""}`}
                              onClick={() => setSelectedTime(t)}
                            >
                              {t} {isBusy ? "(Full)" : ""}
                            </button>
                          );
                        }
                      )}
                    </div>
                  </div>
                  {selectedTime && (
                    <div className="appointment-summary">
                      <CheckCircle2 color="#28bf96" size={24} />
                      <div className="summary-text">
                        <strong>BS. {selectedDoctor?.fullName}</strong>
                        <p>
                          {selectedDate.toLocaleDateString("vi-VN")} lúc{" "}
                          {selectedTime}
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </>
          )}
        </div>

        <footer className="wizard-footer">
          <button
            className="btn-back"
            onClick={() => (step > 1 ? setStep(step - 1) : onClose())}
          >
            Back
          </button>
          {step === 4 && (
            <button
              className="btn-send"
              disabled={!selectedTime || checkingSlots}
              onClick={handleSendRequest}
            >
              Confirm Booking <Send size={18} />
            </button>
          )}
        </footer>
      </div>
    </div>
  );
};

export default CreateAppointmentModal;
-e \n[END OF FILE]\n
frontend/src/pages/patient/ProfilePatient.css
------------------------------------------
-e \n[END OF FILE]\n
frontend/src/pages/patient/PatientDashboard.tsx
------------------------------------------
import React from "react";
import PatientHeader from "../../components/PatientHeader";
import "./PatientDashboard.css";
import docBanner from "../../assets/images/doctor-banner-home.png";

const PatientDashboard: React.FC = () => {
  return (
    <div className="dashboard-page">
      
      {/* Container bao quanh để tạo khoảng cách với Header */}
      <main className="dashboard-main-container">
        
        {/* CHIẾC CARD NỔI TÁCH BIỆT VỚI NỀN */}
        <div className="dashboard-card">
          <section className="hero-banner">
            <div className="hero-left">
              <h2 className="hero-subtitle">Get Quick</h2>
              <h1 className="hero-title">Medical Services</h1>
              <p className="hero-description">
                Lorem ipsum is simply dummy text of the printing been industry's
                standard dummy text ever unknown to printer galley of type a make a
                type specimen book. It has survived not only five centuries leptorem
                ipsum dolor sit amet, consectetuer adipiscing elit
              </p>
              <button className="btn-get-services">Get Services</button>
            </div>

            <div className="hero-right">
              {/* Vòng tròn xanh Mint */}
              <div className="circle-bg"></div>
              
              {/* Ảnh bác sĩ */}
              <img src={docBanner} alt="Doctor" className="doctor-img" />

              {/* Thẻ 1520+ */}
              <div className="stat-card clients-card">
                <div className="stat-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#28BF96" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                </div>
                <div className="stat-info">
                  <h3>1520+</h3>
                  <p>Activate Clients</p>
                </div>
              </div>

              {/* Thẻ ưu đãi */}
              <div className="stat-card promo-card">
                <ul>
                  <li><span>✓</span> Get 20% off on every 1st month</li>
                  <li><span>✓</span> Expert Doctors</li>
                </ul>
              </div>
            </div>
          </section>
        </div>

      </main>
    </div>
  );
};

export default PatientDashboard;-e \n[END OF FILE]\n
frontend/src/pages/patient/PatientAppointment.tsx
------------------------------------------
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import Calendar from "react-calendar";
import "react-calendar/dist/Calendar.css";
import {
  Search,
  Clock,
  User,
  X,
  Eye,
  Calendar as CalendarIcon,
  Plus,
} from "lucide-react";
import PatientHeader from "../../components/PatientHeader";
import MedicalRecordDetailModal from "../doctor/MedicalRecorđetailModal";
import CreateAppointmentModal from "./CreateAppointmentModal";
import "./PatientAppointment.css";

const PatientAppointment: React.FC = () => {
  const [appointments, setAppointments] = useState<any[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedApptForDetails, setSelectedApptForDetails] =
    useState<any>(null);
  const [showCreateModal, setShowCreateModal] = useState(false);

  const API_URL = "http://localhost:3000";

  const fetchData = async () => {
    try {
      setLoading(true);
      const userId = localStorage.getItem("userId");
      const token = localStorage.getItem("token");
      if (!userId || !token) return;

      const patientRes = await axios.get(
        `${API_URL}/api/patients/user/${userId}`,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      const patientId = patientRes.data.id;

      const apptRes = await axios.get(`${API_URL}/api/appointments`, {
        headers: { Authorization: `Bearer ${token}` },
      });

      const myAppts = apptRes.data.filter(
        (a: any) => a.patientId === patientId
      );
      setAppointments(myAppts);
    } catch (error) {
      console.error("Lỗi lấy lịch hẹn:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  const handleCancel = async (id: string) => {
    if (!window.confirm("Bạn có chắc muốn hủy lịch hẹn này?")) return;
    try {
      await axios.patch(
        `${API_URL}/api/appointments/${id}`,
        { status: "cancelled" },
        {
          headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
        }
      );
      fetchData();
    } catch (error) {
      alert("Lỗi khi hủy lịch");
    }
  };

  // Logic lọc theo ngày, tìm kiếm và SẮP XẾP GIỜ TĂNG DẦN
  const filteredAppointments = useMemo(() => {
    const dateStr = selectedDate.toLocaleDateString("en-CA"); // Định dạng YYYY-MM-DD

    return appointments
      .filter((apt) => {
        const matchesDate = apt.appointment_date === dateStr;
        const matchesSearch =
          apt.doctor?.fullName
            ?.toLowerCase()
            .includes(searchTerm.toLowerCase()) ||
          apt.note?.toLowerCase().includes(searchTerm.toLowerCase());
        return matchesDate && matchesSearch;
      })
      .sort((a, b) => {
        // Sắp xếp thời gian (Ví dụ: 08:00 sẽ đứng trước 14:00)
        const timeA = a.appointment_time || "";
        const timeB = b.appointment_time || "";
        return timeA.localeCompare(timeB);
      });
  }, [appointments, selectedDate, searchTerm]);

  return (
    <div className="patient-appt-page">

      <main className="appt-main-container">
        {/* Tiêu đề và Thanh tìm kiếm */}
        <div className="appt-header-section">
          <h1 className="welcome-title">
            Lịch hẹn <span className="highlight">của tôi</span>
          </h1>
          <div style={{ display: "flex", gap: "15px" }}>
            <div className="search-bar-wrapper">
              <Search size={20} color="#94a3b8" />
              <input
                type="text"
                placeholder="Tìm bác sĩ..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
            <button
              className="btn-complete-exam"
              onClick={() => setShowCreateModal(true)}
            >
              <Plus size={18} /> Đặt lịch khám
            </button>
          </div>
        </div>

        {/* Layout chia 2 cột */}
        <div className="appt-content-layout">
          {/* CỘT TRÁI: CARD LỊCH */}
          <aside className="calendar-sidebar">
            <div className="calendar-card">
              <Calendar
                onChange={(val) => setSelectedDate(val as Date)}
                value={selectedDate}
                locale="vi-VN"
              />
            </div>

            {/* Thẻ hiển thị ngày đang chọn (Trang trí thêm) */}
            <div
              className="calendar-card"
              style={{ marginTop: "20px", padding: "15px" }}
            >
              <div
                style={{
                  display: "flex",
                  alignItems: "center",
                  gap: "10px",
                  color: "var(--primary)",
                }}
              >
                <CalendarIcon size={20} />
                <strong style={{ fontSize: "14px" }}>
                  {selectedDate.toLocaleDateString("vi-VN", {
                    weekday: "long",
                    day: "2-digit",
                    month: "2-digit",
                  })}
                </strong>
              </div>
            </div>
          </aside>

          {/* CỘT PHẢI: CARD DANH SÁCH */}
          <section className="appt-list-section">
            <div className="table-container">
              <table className="patient-table">
                <thead>
                  <tr>
                    <th>Bác sĩ</th>
                    <th>Thời gian</th>
                    <th>Trạng thái</th>
                    <th style={{ textAlign: "center" }}>Thao tác</th>
                  </tr>
                </thead>
                <tbody>
                  {loading ? (
                    <tr>
                      <td colSpan={4} className="no-data">
                        Đang tải...
                      </td>
                    </tr>
                  ) : filteredAppointments.length > 0 ? (
                    filteredAppointments.map((apt) => (
                      <tr key={apt.id}>
                        <td>
                          <div className="p-cell">
                            <div className="p-avatar-wrapper">
                              {apt.doctor?.user?.avatar ? (
                                <img
                                  src={`${API_URL}/avatar/${apt.doctor.user.avatar}`}
                                  alt="Avatar"
                                />
                              ) : (
                                <User size={20} color="#cbd5e1" />
                              )}
                            </div>
                            <div>
                              <p className="p-name">
                                BS. {apt.doctor?.fullName}
                              </p>
                              <p className="p-info">{apt.doctor?.specialty}</p>
                            </div>
                          </div>
                        </td>
                        <td>
                          <div className="time-cell">
                            <Clock size={16} />{" "}
                            {apt.appointment_time?.substring(0, 5)}
                          </div>
                        </td>
                        <td>
                          <span className={`status-pill ${apt.status}`}>
                            {apt.status === "pending"
                              ? "Chờ duyệt"
                              : apt.status}
                          </span>
                        </td>
                        <td>
                          <div className="action-buttons-group">
                            <button
                              className="btn-details"
                              onClick={() => setSelectedApptForDetails(apt)}
                            >
                              <Eye size={14} /> Chi tiết
                            </button>
                            {apt.status === "pending" && (
                              <button
                                className="btn-cancel"
                                onClick={() => handleCancel(apt.id)}
                              >
                                <X size={14} /> Hủy
                              </button>
                            )}
                          </div>
                        </td>
                      </tr>
                    ))
                  ) : (
                    <tr>
                      <td colSpan={4} className="no-data">
                        Không có lịch hẹn cho ngày này.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </section>
        </div>
      </main>

      {/* MODALS */}
      {showCreateModal && (
        <CreateAppointmentModal
          onClose={() => setShowCreateModal(false)}
          onSuccess={() => {
            setShowCreateModal(false);
            fetchData();
          }}
        />
      )}

      {selectedApptForDetails && (
        <MedicalRecordDetailModal
          appointment={selectedApptForDetails}
          onClose={() => setSelectedApptForDetails(null)}
        />
      )}
    </div>
  );
};

export default PatientAppointment;
-e \n[END OF FILE]\n
frontend/src/pages/patient/PatientNotification.tsx
------------------------------------------
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import { Search, MoreHorizontal } from "lucide-react";
import PatientHeader from "../../components/PatientHeader";
import "./PatientNotification.css";

// Icons
import newRequestIcon from "../../assets/icons/new_request.svg";
import cancelledRequestIcon from "../../assets/icons/cancelled_request.svg";

const PatientNotification: React.FC = () => {
  const [notifications, setNotifications] = useState<any[]>([]);
  const [patient, setPatient] = useState<any>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [activeTab, setActiveTab] = useState("All");
  const [searchTerm, setSearchTerm] = useState("");

  const API_URL = "http://localhost:3000";

  const fetchData = async () => {
    try {
      setLoading(true);
      const userId = localStorage.getItem("userId");
      const token = localStorage.getItem("token");
      const headers = { Authorization: `Bearer ${token}` };

      if (!userId) return;

      const [resNotifs, resPatient] = await Promise.all([
        axios.get(`${API_URL}/api/notifications/user/${userId}`, { headers }),
        axios.get(`${API_URL}/api/patients/user/${userId}`, { headers }),
      ]);

      setNotifications(resNotifs.data || []);
      setPatient(resPatient.data);
    } catch (error) {
      console.error("Error fetching notifications:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  // CHỨC NĂNG ĐÁNH DẤU TẤT CẢ ĐÃ ĐỌC CHO PATIENT
  const handleMarkAllAsRead = async () => {
    const unreadNotifs = notifications.filter((n) => !n.isRead);
    if (unreadNotifs.length === 0) return;

    const token = localStorage.getItem("token");
    const headers = { Authorization: `Bearer ${token}` };

    // Optimistic UI: Cập nhật giao diện ngay lập tức
    const originalNotifs = [...notifications];
    setNotifications((prev) => prev.map((n) => ({ ...n, isRead: true })));

    try {
      // Gọi API PATCH cho từng thông báo chưa đọc
      await Promise.all(
        unreadNotifs.map((n) =>
          axios.patch(`${API_URL}/api/notifications/${n.id}/read`, {}, { headers })
        )
      );
      console.log("Patient: Đã cập nhật tất cả thông báo thành đã đọc");
    } catch (error) {
      console.error("Lỗi khi cập nhật thông báo:", error);
      // Hoàn tác nếu lỗi
      setNotifications(originalNotifs);
      alert("Không thể cập nhật thông báo. Vui lòng thử lại sau.");
    }
  };

  const filteredNotifs = useMemo(() => {
    let list = notifications;
    if (activeTab === "Unread") list = list.filter((n) => !n.isRead);
    if (searchTerm.trim() !== "") {
      list = list.filter((n) =>
        n.content?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        n.title?.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    return list;
  }, [notifications, activeTab, searchTerm]);

  if (loading) return <div className="loading-state">Đang tải thông báo...</div>;

  return (
    <div className="patient-notif-layout">
      <div className="notif-container">
        <header className="notif-header">
          <div>
            <h1>Thông báo của <span className="highlight-green">{patient?.fullName || "Bệnh nhân"}</span></h1>
            <p>Bạn có {notifications.filter(n => !n.isRead).length} thông báo chưa đọc</p>
          </div>
          {/* NÚT BẤM GẮN HÀM XỬ LÝ */}
          <button className="btn-mark-all" onClick={handleMarkAllAsRead}>
            Đánh dấu tất cả đã đọc
          </button>
        </header>

        <div className="notif-card">
          <div className="notif-toolbar">
            <div className="notif-tabs">
              {["All", "Unread"].map((tab) => (
                <button
                  key={tab}
                  className={`tab-item ${activeTab === tab ? "active" : ""}`}
                  onClick={() => setActiveTab(tab)}
                >
                  {tab === "All" ? "Tất cả" : "Chưa đọc"}
                </button>
              ))}
            </div>
          </div>

          <div className="notif-list">
            {filteredNotifs.length > 0 ? (
              filteredNotifs.map((n) => {
                const isCancelled = n.content?.toLowerCase().includes("huỷ") || n.type === "cancel";
                const isUnread = !n.isRead;

                return (
                  <div key={n.id} className={`notif-row ${isUnread ? "unread-row" : ""}`}>
                    <div className="notif-left">
                      <div className={`notif-icon-box ${isCancelled ? "bg-rose-light" : "bg-mint-light"}`}>
                        <img
                          src={isCancelled ? cancelledRequestIcon : newRequestIcon}
                          alt="icon"
                          className="notif-svg-icon"
                        />
                      </div>
                      <div className="notif-content">
                        {/* TITLE VÀ DOT NGANG HÀNG */}
                        <h4 className="notif-title" style={{ 
                          fontWeight: 'bold', 
                          display: 'flex', 
                          alignItems: 'center', 
                          margin: 0,
                          gap: '8px' 
                        }}>
                          {n.title}
                          {isUnread && (
                            <span className={`unread-dot ${isCancelled ? "dot-red" : "dot-mint"}`}></span>
                          )}
                        </h4>
                        <p className="notif-msg" style={{ margin: '4px 0' }}>{n.content}</p>
                      </div>
                    </div>

                    <div className="notif-right">
                      <span className="notif-time">
                        {new Date(n.createdAt).toLocaleString("vi-VN", {
                          hour: "2-digit",
                          minute: "2-digit",
                          day: "2-digit",
                          month: "2-digit",
                        })}
                      </span>
                    </div>
                  </div>
                );
              })
            ) : (
              <div className="no-notif-box">Không có thông báo nào.</div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default PatientNotification;-e \n[END OF FILE]\n
frontend/src/pages/patient/PatientNotification.css
------------------------------------------
.notif-container {
    padding: 40px;
    background-color: #fcfdfd;
    min-height: 100vh;
  }
  
  .notif-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
  }
  
  .notif-header h1 { font-size: 28px; font-weight: 800; color: #333; }
  .highlight-green { color: #53CCAB; }
  .notif-header p { color: #8e96a3; margin-top: 5px; }
  
  .btn-mark-all {
    background: #53CCAB;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
  }
  
  .notif-card {
    background: white;
    border-radius: 20px;
    border: 1px solid #eee;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.02);
  }
  
  .notif-toolbar {
    display: flex;
    justify-content: space-between;
    padding: 20px 30px;
    border-bottom: 1px solid #f5f5f5;
  }
  
  .notif-tabs { display: flex; gap: 30px; }
  .tab-item {
    background: none;
    border: none;
    font-weight: 600;
    color: #8e96a3;
    cursor: pointer;
    padding-bottom: 5px;
    position: relative;
  }
  .tab-item.active { color: #333; }
  .tab-item.active::after {
    content: "";
    position: absolute;
    bottom: -21px; left: 0; width: 100%; height: 3px;
    background: #333;
  }
  
  .notif-search-box {
    background: #f5f7f9;
    border-radius: 20px;
    padding: 8px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    width: 300px;
  }
  .notif-search-box input { border: none; background: none; outline: none; width: 100%; }
  
  /* Notif Item */
  .notif-item {
    display: flex;
    justify-content: space-between;
    padding: 25px 30px;
    border-bottom: 1px solid #f5f5f5;
    transition: 0.2s;
  }
  .notif-item:hover { background-color: #f9fbfb; }
  
  .notif-left { display: flex; gap: 20px; align-items: center; }
  
  .notif-icon-box {
    width: 50px; height: 50px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
  }
  .bg-mint { background: #e6f7f3; }
  .bg-rose { background: #ffebeb; }
  .bg-blue { background: #ebf3ff; }
  
  .notif-content h4 { font-size: 16px; margin: 0; color: #333; display: flex; align-items: center; gap: 8px; }
  .unread-dot { width: 8px; height: 8px; background: #53CCAB; border-radius: 50%; }
  .notif-content p { margin: 5px 0 0; color: #8e96a3; font-size: 14px; }
  
  .notif-right { text-align: right; display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end; }
  .notif-time { font-size: 13px; color: #b0b0b0; }
  .btn-more { background: none; border: none; color: #b0b0b0; cursor: pointer; }
  
  .btn-view-older {
    width: 100%; padding: 20px; background: none; border: none;
    color: #53CCAB; font-weight: 600; cursor: pointer; text-align: center;
  }

  /* Màu nền cho Icon Box theo thiết kế */
.bg-mint-light {
    background-color: #E2FFF7; /* Xanh mint nhạt */
  }
  
  .bg-rose-light {
    background-color: #FFE9E9; /* Hồng nhạt */
  }
  
  .bg-blue-light {
    background-color: #EBF3FF; /* Xanh dương nhạt */
  }
  
  .bg-gray-light {
    background-color: #F5F5F5;
  }
  
  /* Định dạng Icon SVG */
  .notif-icon-box {
    width: 48px;
    height: 48px;
    border-radius: 10px; /* Bo góc nhẹ như ảnh */
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .notif-svg-icon {
    width: 24px;
    height: 24px;
  }
  
  /* Hiệu ứng dòng chưa đọc */
  .unread-row {
    background-color: #F8FAFC; /* Nền xanh cực nhẹ cho dòng chưa đọc */
  }
  
  .unread-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    background-color: #2DD4BF; /* Màu mint đậm */
    border-radius: 50%;
    margin-left: 6px;
  }
  
  /* Nút View older ở cuối */
  .view-older-box {
    padding: 20px;
    text-align: center;
    border-top: 1px solid #eee;
  }
  
  .btn-view-older {
    color: #53CCAB;
    font-weight: 600;
    background: none;
    border: none;
    cursor: pointer;
  }
  .notif-icon-box {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    overflow: hidden; /* Đảm bảo icon không tràn ra ngoài */
  }
  
  .notif-svg-icon {
    width: 24px;   /* Ép kích thước cố định */
    height: 24px;
    display: block;
    object-fit: contain; /* Giữ tỷ lệ icon */
  }
  
  /* Thêm màu sắc cho box nếu cần */
  .bg-mint-light { background-color: #e2fff7; }
  .bg-rose-light { background-color: #ffe9e9; }
  .bg-gray-light { background-color: #f5f5f5; }
  /* Thêm class này vào cuối file CSS của bạn */
.unread-dot.dot-red {
    background-color: #FF4D4F; /* Màu đỏ thông báo */
  }

  /* Copy toàn bộ nội dung Notifications.css vào đây */
/* ... */

/* Thêm hoặc sửa class này để hiển thị tên người gửi trong thông báo */
.patient-tag {
  display: inline-block;
  margin-top: 6px;
  font-size: 12px;
  background: #e2f7f1;
  color: #28bf96;
  padding: 2px 10px;
  border-radius: 20px;
  font-weight: 600;
}

/* Dấu chấm đỏ cho thông báo chưa đọc */
.unread-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  background-color: #ef4444; /* Màu đỏ */
  border-radius: 50%;
  margin-left: 8px;
  vertical-align: middle;
}

/* Màu nền cho icon box */
.bg-mint-light {
  background-color: #e2f7f1;
}

.bg-rose-light {
  background-color: #fee2e2; /* Màu đỏ nhạt cho thông báo huỷ */
}

.unread-row {
  background-color: #f8fafc; /* Nền tối hơn một chút cho dòng chưa đọc */
}

.unread-dot.dot-red {
  background-color: #ef4444; /* Màu đỏ cho thông báo huỷ */
}

.unread-dot.dot-mint {
  background-color: #2dd4bf; /* Màu xanh mint cho thông báo thường */
}

/* ... các phần trên giữ nguyên ... */

.notif-list {
  display: flex;
  flex-direction: column;
  /* THÊM KHOẢNG CÁCH VỚI CẠNH CARD */
  padding: 10px 20px 20px 20px; 
  gap: 12px; /* Tạo khoảng cách giữa các thông báo với nhau */
}

.notif-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  /* BO GÓC CHO TỪNG DÒNG ĐỂ ĐẸP HƠN KHI CÓ PADDING */
  border-radius: 12px; 
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.notif-row:hover {
  background-color: #f8fafc;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  border-color: #e2e8f0;
}

/* Tinh chỉnh dòng chưa đọc */
.unread-row {
  background-color: #f0fdfa; /* Màu xanh mint cực nhẹ cho unread */
  border-left: 4px solid #2dd4bf; /* Thanh chỉ thị màu xanh bên trái */
}

/* Nếu là thông báo huỷ và chưa đọc, có thể cho màu nền hơi hồng nhẹ */
.notif-row.unread-row:has(.dot-red) {
  background-color: #fff1f2;
  border-left-color: #ef4444;
}-e \n[END OF FILE]\n
frontend/src/pages/SignUp.css
------------------------------------------
.signup-container {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 20px;
  }
  
  .signup-card {
    width: 100%;
    max-width: 500px;
    border-radius: 15px;
    border: none;
  }
  
  .signup-header {
    text-align: center;
    margin-bottom: 30px;
  }
  
  .signup-steps {
    margin-bottom: 30px;
  }
  
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }
  
  .w-100 {
    width: 100%;
  }
  
  .signup-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }
  
  .signup-buttons button {
    flex: 1;
  }
  
  .ant-btn-primary {
    height: 40px;
    font-weight: 600;
  }
  
  /* Tùy chỉnh màu xanh Mint giống Header Doctor của bạn */
  .ant-steps-item-process .ant-steps-item-icon {
    background: #4cc9b0;
    border-color: #4cc9b0;
  }
  
  .ant-steps-item-finish .ant-steps-item-icon {
    border-color: #4cc9b0;
  }
  
  .ant-steps-item-finish .ant-steps-item-icon > .ant-steps-icon {
    color: #4cc9b0;
  }

  .ant-upload-select-picture-card {
    margin: 0 auto 20px auto !important; /* Căn giữa ô upload ảnh */
  }
  
  .signup-buttons button {
    height: 40px;
    border-radius: 8px;
  }-e \n[END OF FILE]\n
